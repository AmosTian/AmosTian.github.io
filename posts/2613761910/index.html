<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/favicon.png" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa:300,300italic,400,400italic,700,700italic|Ma Shan Zheng:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"amostian.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="在实际项目中，在部署上线前对服务进行盘点，然后根据用户数和并发数，对需要的服务器进行统计，然后采购服务器，最后实施部署。 github项目地址 $我的网盘\rightarrow 我的资源 \rightarrow 本科\rightarrow 毕设$"><meta property="og:type" content="article"><meta property="og:title" content="好客租房部署"><meta property="og:url" content="https://amostian.github.io/posts/2613761910/index.html"><meta property="og:site_name" content="AmosTian"><meta property="og:description" content="在实际项目中，在部署上线前对服务进行盘点，然后根据用户数和并发数，对需要的服务器进行统计，然后采购服务器，最后实施部署。 github项目地址 $我的网盘\rightarrow 我的资源 \rightarrow 本科\rightarrow 毕设$"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/%E6%AF%95%E8%AE%BE-%E6%9E%B6%E6%9E%84%E5%9B%BE.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210517185016131.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210517190808896.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210517191148683.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210517191931003.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210517211124420.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210518090317951.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210518090735787.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210518090854704.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210518095732635.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210518120310937.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210518121854995.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210518170608594.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210518170635935.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210519083733742.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210519083824299.png"><meta property="og:image" content="https://amostian.github.io/posts/2613761910/image-20210519084228346.png"><meta property="article:published_time" content="2022-04-04T03:52:50.000Z"><meta property="article:modified_time" content="2023-07-01T09:18:06.000Z"><meta property="article:author" content="AmosTian"><meta property="article:tag" content="开发"><meta property="article:tag" content="Java项目"><meta property="article:tag" content="毕设项目"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://amostian.github.io/posts/2613761910/%E6%AF%95%E8%AE%BE-%E6%9E%B6%E6%9E%84%E5%9B%BE.png"><link rel="canonical" href="https://amostian.github.io/posts/2613761910/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>好客租房部署 | AmosTian</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">AmosTian</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">68</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">84</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">235</span></a></li><li class="menu-item menu-item-essay"><a href="/categories/%E9%9A%8F%E7%AC%94/" rel="section"><i class="fa fa-fw fa-pied-piper"></i>随笔</a></li><li class="menu-item menu-item-dynamic-resume"><a href="/dynamic-resume/" rel="section"><i class="fa fa-fw fa-cog"></i>动态简历</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/AmosTian" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://amostian.github.io/posts/2613761910/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="AmosTian"><meta itemprop="description" content="知道的越多，不知道的越多"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="AmosTian"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">好客租房部署</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间 2022-04-04 11:52:50" itemprop="dateCreated datePublished" datetime="2022-04-04T11:52:50+08:00">2022-04-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间 2023-07-01 17:18:06" itemprop="dateModified" datetime="2023-07-01T17:18:06+08:00">2023-07-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a> </span>> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%BC%80%E5%8F%91/Java%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">Java项目</span></a> </span>> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%BC%80%E5%8F%91/Java%E9%A1%B9%E7%9B%AE/%E6%AF%95%E8%AE%BE%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">毕设项目</span></a></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数 </span><span title="本文字数">6.6k字 </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>31 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>在实际项目中，在部署上线前对服务进行盘点，然后根据用户数和并发数，对需要的服务器进行统计，然后采购服务器，最后实施部署。</p><p><a target="_blank" rel="noopener" href="https://github.com/AmosTian/graduate_project">github项目地址</a></p><p>$我的网盘\rightarrow 我的资源 \rightarrow 本科\rightarrow 毕设$</p><span id="more"></span><h1 id="部署架构"><a href="#部署架构" class="headerlink" title="部署架构"></a>部署架构</h1><p><img src="/posts/2613761910/毕设-架构图.png" alt="毕设-架构图"></p><h2 id="部署计划"><a href="#部署计划" class="headerlink" title="部署计划"></a>部署计划</h2><p>在实际项目中，在部署上线前对服务进行盘点，然后根据用户数和并发数，对需要的服务器进行统计，然后采购服务器，最后实施部署。</p><p>两台服务器：腾讯云（1核2G 50G）：82.157.25.57，阿里云（2核4G 40G）8.140.130.91</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看cpu状态</span></span><br><span class="line">top</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看CPU</span></span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看内存</span></span><br><span class="line">free -m</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看磁盘容量</span></span><br><span class="line">df -h</span><br></pre></td></tr></table></figure><p>jdk1.8.0_151</p><h1 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h1><p><img src="/posts/2613761910/集群方案.png" alt="mysql"></p><h2 id="规划"><a href="#规划" class="headerlink" title="规划"></a>规划</h2><div class="table-container"><table><thead><tr><th>服务</th><th>角色</th><th>端口</th><th>服务器</th><th>容器名</th></tr></thead><tbody><tr><td>MySQL-node01</td><td>pxc</td><td>13306</td><td>8.140.130.91</td><td>pxc_node1</td></tr><tr><td>MySQL-node02</td><td>pxc</td><td>13307</td><td>8.140.130.91</td><td>pxc_node2</td></tr><tr><td>MySQL-node03</td><td>pxc</td><td>13308</td><td>8.140.130.91</td><td>pxc_node3</td></tr><tr><td>MySQL-node04</td><td>pxc</td><td>13309</td><td>8.140.130.91</td><td>pxc_node4</td></tr><tr><td>MySQL-node05</td><td>master</td><td>13310</td><td>82.157.25.57</td><td>ms_node1</td></tr><tr><td>MySQL-node06</td><td>slave</td><td>13311</td><td>82.157.25.57</td><td>ms_node2</td></tr><tr><td>MyCat-node01</td><td>mycat</td><td>11986，18068，19068</td><td>82.157.25.57</td><td>mycat_node01</td></tr><tr><td>MyCat-node02</td><td>mycat</td><td>11987，18069，19069</td><td>8.140.130.91</td><td>mycat_node02</td></tr><tr><td>HAProxy</td><td>haproxy</td><td>4001，4002</td><td>82.157.25.57</td><td>haproxy</td></tr></tbody></table></div><h2 id="部署PXC集群——阿里云"><a href="#部署PXC集群——阿里云" class="headerlink" title="部署PXC集群——阿里云"></a>部署PXC集群——阿里云</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建数据卷（存储路径：/var/lib/docker/volumes）</span></span><br><span class="line">docker volume create haoke-v1</span><br><span class="line">docker volume create haoke-v2</span><br><span class="line">docker volume create haoke-v3</span><br><span class="line">docker volume create haoke-v4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull percona/percona-xtradb-cluster:5.7</span><br><span class="line">docker tag percona/percona-xtradb-cluster:5.7 pxc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建网络</span></span><br><span class="line">docker network create --subnet=172.30.0.0/24 pxc-network</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网络信息</span></span><br><span class="line">docker network ls</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群1，第一节点</span></span><br><span class="line">docker create -p 13306:3306 -v haoke-v1:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=pxc --name=pxc_node1 --net=pxc-network --ip=172.30.0.2 pxc</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第二节点（增加了CLUSTER_JOIN参数）</span></span><br><span class="line">docker create -p 13307:3306 -v haoke-v2:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=pxc --name=pxc_node2 -e CLUSTER_JOIN=pxc_node1 --net=pxc-network --ip=172.30.0.3 pxc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群2</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第一节点</span></span><br><span class="line">docker create -p 13308:3306 -v haoke-v3:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=pxc --name=pxc_node3 --net=pxc-network --ip=172.30.0.4 pxc</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第二节点（增加了CLUSTER_JOIN参数）</span></span><br><span class="line">docker create -p 13309:3306 -v haoke-v4:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=pxc --name=pxc_node4 -e CLUSTER_JOIN=pxc_node3 --net=pxc-network --ip=172.30.0.5 pxc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群节点</span></span><br><span class="line">show status like &#x27;wsrep_cluster%&#x27;;</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210517185016131.png" alt="image-20210517185016131"></p><h3 id="宕机重启配置"><a href="#宕机重启配置" class="headerlink" title="宕机重启配置"></a>宕机重启配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] WSREP: It may not be safe to bootstrap the cluster from this node. It was not the last one to leave the cluster and may not contain all the updates. To force cluster bootstrap with this node, edit the grastate.dat file manually and set safe_to_bootstrap to 1 .</span><br></pre></td></tr></table></figure><p>手动编辑grastate.dat文件，并将safe_to_bootstrap参数设置为1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># GALERA saved state</span><br><span class="line">version: 2.1</span><br><span class="line">uuid:    a4a9e18a-b7e4-11eb-98b8-0b4f06fa70b2</span><br><span class="line">seqno:   -1</span><br><span class="line">safe_to_bootstrap: 0</span><br></pre></td></tr></table></figure><h2 id="部署MS集群——腾讯云"><a href="#部署MS集群——腾讯云" class="headerlink" title="部署MS集群——腾讯云"></a>部署MS集群——腾讯云</h2><h3 id="master"><a href="#master" class="headerlink" title="master"></a>master</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建数据卷（存储路径：/var/lib/docker/volumes）</span></span><br><span class="line">docker volume create haoke-v5</span><br><span class="line">docker volume create haoke-v6</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master</span></span><br><span class="line">mkdir /data/mysql/haoke-master01/conf -p</span><br><span class="line">cd /data/mysql/haoke-master01/conf</span><br><span class="line">vim my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入如下内容</span></span><br><span class="line">[mysqld]</span><br><span class="line">log-bin=mysql-bin #开启二进制日志</span><br><span class="line">server-id=1 #服务id，不可重复</span><br><span class="line">sql_mode=&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line">binlog_format=MIXED</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name ms_node1 -v haoke-v5:/var/lib/mysql -v /data/mysql/haoke/master01/conf:/etc/my.cnf.d -p 13310:3306 -e MYSQL_ROOT_PASSWORD=root percona:5.7.23</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line">docker start ms_node1 &amp;&amp; docker logs -f ms_node1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建同步账户以及授权</span></span><br><span class="line">create user &#x27;haoke&#x27;@&#x27;%&#x27; identified by &#x27;haoke&#x27;;</span><br><span class="line">grant replication slave on *.* to &#x27;haoke&#x27;@&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看master状态</span></span><br><span class="line">show master status;</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210517190808896.png" alt></p><p><img src="/posts/2613761910/image-20210517191148683.png" alt="image-20210517191148683"></p><h3 id="slave"><a href="#slave" class="headerlink" title="slave"></a>slave</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">slave</span></span><br><span class="line">mkdir /data/mysql/haoke-slave01/conf -p</span><br><span class="line">cd /data/mysql/haoke-slave01/conf</span><br><span class="line">vim my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入如下内容</span></span><br><span class="line">---</span><br><span class="line">[mysqld]</span><br><span class="line">server-id=2 #服务id，不可重复</span><br><span class="line">sql_mode=&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line">---</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name ms_node2 -v haoke-v6:/var/lib/mysql -v /data/mysql/haoke-slave01/conf:/etc/my.cnf.d -p 13311:3306 -e MYSQL_ROOT_PASSWORD=root percona:5.7.23</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line">docker start ms_node2 &amp;&amp; docker logs -f ms_node2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置master相关信息</span></span><br><span class="line">---</span><br><span class="line">CHANGE MASTER TO</span><br><span class="line">    master_host=&#x27;82.157.25.57&#x27;,</span><br><span class="line">    master_user=&#x27;haoke&#x27;,</span><br><span class="line">    master_password=&#x27;haoke&#x27;,</span><br><span class="line">    master_port=13310,</span><br><span class="line">    master_log_file=&#x27;mysql-bin.000001&#x27;,</span><br><span class="line">    master_log_pos=154;</span><br><span class="line">---</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动同步</span></span><br><span class="line">start slave;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看master状态</span></span><br><span class="line">show slave status;</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210517191931003.png" alt="image-20210517191931003"></p><h2 id="部署MyCat"><a href="#部署MyCat" class="headerlink" title="部署MyCat"></a>部署MyCat</h2><p><a target="_blank" rel="noopener" href="http://dl.mycat.org.cn/1.6.7.6/20210303094759/">Mycat-server-1.6.7.6-release-20210303094759</a></p><p>解压</p><h3 id="mycat01——腾讯云"><a href="#mycat01——腾讯云" class="headerlink" title="mycat01——腾讯云"></a>mycat01——腾讯云</h3><h4 id="server-xml"><a href="#server-xml" class="headerlink" title="server.xml"></a>server.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:server <span class="keyword">SYSTEM</span> <span class="string">&quot;server.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:server</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;nonePasswordLogin&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useHandshakeV10&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useSqlStat&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useGlobleTableCheck&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sequnceHandlerType&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;subqueryRelationshipCheck&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;processorBufferPoolType&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;handleDistributedTransactions&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useOffHeapForMerge&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memoryPageSize&quot;</span>&gt;</span>64k<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;spillsFileBufferSize&quot;</span>&gt;</span>1k<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useStreamOutput&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;systemReserveMemorySize&quot;</span>&gt;</span>384m<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useZKSwitch&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置服务端口以及管理端口--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;serverPort&quot;</span>&gt;</span>18068<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;managerPort&quot;</span>&gt;</span>19068<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这里是设置 Mycat 用户mycat 和虚拟逻辑库--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;mycat&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>mycat<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>haoke<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:server</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="schema-xml"><a href="#schema-xml" class="headerlink" title="schema.xml"></a>schema.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置数据表--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;haoke&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_house_resources&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;mod-long&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_ad&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置分片关系--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;cluster1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;haoke&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;cluster2&quot;</span> <span class="attr">database</span>=<span class="string">&quot;haoke&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;cluster3&quot;</span> <span class="attr">database</span>=<span class="string">&quot;haoke&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置连接信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;cluster1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">writeType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;W1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;8.140.130.91:13306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;W1R1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;8.140.130.91:13307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;cluster2&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">writeType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;W2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;8.140.130.91:13308&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;W2R1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;8.140.130.91:13309&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;cluster3&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">writeType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;W3&quot;</span> <span class="attr">url</span>=<span class="string">&quot;82.157.25.57:13310&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;W3R1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;82.157.25.57:13311&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="rule-xml"><a href="#rule-xml" class="headerlink" title="rule.xml"></a>rule.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">&quot;mod-long&quot;</span> <span class="attr">class</span>=<span class="string">&quot;io.mycat.route.function.PartitionByMod&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="wrapper-conf"><a href="#wrapper-conf" class="headerlink" title="wrapper.conf"></a>wrapper.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置jmx端口</span></span><br><span class="line">wrapper.java.additional.6=-Dcom.sun.management.jmxremote.port=11986</span><br></pre></td></tr></table></figure><h4 id="启动测试"><a href="#启动测试" class="headerlink" title="启动测试"></a>启动测试</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd bin</span><br><span class="line"></span><br><span class="line">./mycat console</span><br><span class="line">./startup_nowrap.sh &amp;&amp; tail -f ../logs/mycat.log</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_ad` (</span><br><span class="line">    `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">    `type` int(10) DEFAULT NULL COMMENT &#x27;广告类型&#x27;,</span><br><span class="line">    `title` varchar(100) DEFAULT NULL COMMENT &#x27;描述&#x27;,</span><br><span class="line">    `url` varchar(200) DEFAULT NULL COMMENT &#x27;图片URL地址&#x27;,</span><br><span class="line">    `created` datetime DEFAULT NULL,</span><br><span class="line">    `updated` datetime DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COMMENT=&#x27;广告表&#x27;;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `tb_house_resources` (</span><br><span class="line">    `id` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">    `title` varchar(100) DEFAULT NULL COMMENT &#x27;房源标题&#x27;,</span><br><span class="line">    `estate_id` varchar(255) DEFAULT NULL COMMENT &#x27;楼盘id&#x27;,</span><br><span class="line">    `building_num` varchar(5) DEFAULT NULL COMMENT &#x27;楼号（栋）&#x27;,</span><br><span class="line">    `building_unit` varchar(5) DEFAULT NULL COMMENT &#x27;单元号&#x27;,</span><br><span class="line">    `building_floor_num` varchar(5) DEFAULT NULL COMMENT &#x27;门牌号&#x27;,</span><br><span class="line">    `rent` int(10) DEFAULT NULL COMMENT &#x27;租金&#x27;,</span><br><span class="line">    `rent_method` tinyint(1) DEFAULT NULL COMMENT &#x27;租赁方式，1-整租，2-合租&#x27;,</span><br><span class="line">    `payment_method` tinyint(1) DEFAULT NULL COMMENT &#x27;支付方式，1-付一押一，2-付三押一，3-付六押一，4-年付押一，5-其它&#x27;,</span><br><span class="line">    `house_type` varchar(255) DEFAULT NULL COMMENT &#x27;户型，如：2室1厅1卫&#x27;,</span><br><span class="line">    `covered_area` varchar(10) DEFAULT NULL COMMENT &#x27;建筑面积&#x27;,</span><br><span class="line">    `use_area` varchar(10) DEFAULT NULL COMMENT &#x27;使用面积&#x27;,</span><br><span class="line">    `floor` varchar(10) DEFAULT NULL COMMENT &#x27;楼层，如：8/26&#x27;,</span><br><span class="line">    `orientation` varchar(2) DEFAULT NULL COMMENT &#x27;朝向：东、南、西、北&#x27;,</span><br><span class="line">    `decoration` tinyint(1) DEFAULT NULL COMMENT &#x27;装修，1-精装，2-简装，3-毛坯&#x27;,</span><br><span class="line">    `facilities` varchar(50) DEFAULT NULL COMMENT &#x27;配套设施， 如：1,2,3&#x27;,</span><br><span class="line">    `pic` varchar(1000) DEFAULT NULL COMMENT &#x27;图片，最多5张&#x27;,</span><br><span class="line">    `house_desc` varchar(200) DEFAULT NULL COMMENT &#x27;描述&#x27;,</span><br><span class="line">    `contact` varchar(10) DEFAULT NULL COMMENT &#x27;联系人&#x27;,</span><br><span class="line">    `mobile` varchar(11) DEFAULT NULL COMMENT &#x27;手机号&#x27;,</span><br><span class="line">    `time` tinyint(1) DEFAULT NULL COMMENT &#x27;看房时间，1-上午，2-中午，3-下午，4-晚上，5-全天&#x27;,</span><br><span class="line">    `property_cost` varchar(10) DEFAULT NULL COMMENT &#x27;物业费&#x27;,</span><br><span class="line">    `created` datetime DEFAULT NULL,</span><br><span class="line">    `updated` datetime DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8 COMMENT=&#x27;房源表&#x27;;</span><br></pre></td></tr></table></figure><h3 id="mycat02——阿里云"><a href="#mycat02——阿里云" class="headerlink" title="mycat02——阿里云"></a>mycat02——阿里云</h3><h4 id="server-xml-1"><a href="#server-xml-1" class="headerlink" title="server.xml"></a>server.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:server <span class="keyword">SYSTEM</span> <span class="string">&quot;server.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:server</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;nonePasswordLogin&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useHandshakeV10&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useSqlStat&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useGlobleTableCheck&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sequnceHandlerType&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;subqueryRelationshipCheck&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;processorBufferPoolType&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;handleDistributedTransactions&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useOffHeapForMerge&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memoryPageSize&quot;</span>&gt;</span>64k<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;spillsFileBufferSize&quot;</span>&gt;</span>1k<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useStreamOutput&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;systemReserveMemorySize&quot;</span>&gt;</span>384m<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useZKSwitch&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置服务端口以及管理端口--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;serverPort&quot;</span>&gt;</span>18069<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;managerPort&quot;</span>&gt;</span>19069<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这里是设置 Mycat 用户mycat 和虚拟逻辑库--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;mycat&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>mycat<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>haoke<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:server</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="schema-xml-1"><a href="#schema-xml-1" class="headerlink" title="schema.xml"></a>schema.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置数据表--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;haoke&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_house_resources&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;mod-long&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_ad&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn3&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置分片关系--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;cluster1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;haoke&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;cluster2&quot;</span> <span class="attr">database</span>=<span class="string">&quot;haoke&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;cluster3&quot;</span> <span class="attr">database</span>=<span class="string">&quot;haoke&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置连接信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;cluster1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">writeType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;W1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;8.140.130.91:13306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;W1R1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;8.140.130.91:13307&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;cluster2&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">writeType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;W2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;8.140.130.91:13308&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;W2R1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;8.140.130.91:13309&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;cluster3&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">writeType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;W3&quot;</span> <span class="attr">url</span>=<span class="string">&quot;82.157.25.57:13310&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;W3R1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;82.157.25.57:13311&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="rule-xml-1"><a href="#rule-xml-1" class="headerlink" title="rule.xml"></a>rule.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">name</span>=<span class="string">&quot;mod-long&quot;</span> <span class="attr">class</span>=<span class="string">&quot;io.mycat.route.function.PartitionByMod&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">function</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="wrapper-conf-1"><a href="#wrapper-conf-1" class="headerlink" title="wrapper.conf"></a>wrapper.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim wrapper.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置jmx端口</span></span><br><span class="line">wrapper.java.additional.6=-Dcom.sun.management.jmxremote.port=11987</span><br></pre></td></tr></table></figure><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd bin</span><br><span class="line"></span><br><span class="line">./mycat console</span><br><span class="line">./startup_nowrap.sh &amp;&amp; tail -f ../logs/mycat.log</span><br></pre></td></tr></table></figure><h3 id="创建表及测试"><a href="#创建表及测试" class="headerlink" title="创建表及测试"></a>创建表及测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `tb_ad` (`id`, `type`, `title`, `url`, `created`, `updated`) </span><br><span class="line">VALUES (&#x27;1&#x27;,&#x27;1&#x27;, &#x27;UniCity万科天空之城&#x27;, &#x27;https://haoke-1257323542.cos.ap-beijing.myqcloud.com/ad-swipes/5.jpg&#x27;, &#x27;2021-05-17 11:28:49&#x27;,&#x27;2021-05-17 11:28:51&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `tb_ad` (`id`, `type`, `title`, `url`, `created`, `updated`) </span><br><span class="line">VALUES (&#x27;2&#x27;,&#x27;1&#x27;, &#x27;天和尚海庭前&#x27;, &#x27;https://haoke-1257323542.cos.ap-beijing.myqcloud.com/ad-swipes/2.jpg&#x27;, &#x27;2021-05-17 11:29:27&#x27;,&#x27;2021-05-17 11:29:29&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `tb_ad` (`id`, `type`, `title`, `url`, `created`, `updated`) </span><br><span class="line">VALUES (&#x27;3&#x27;,&#x27;1&#x27;, &#x27;[奉贤 南桥] 光语著&#x27;, &#x27;https://haoke-1257323542.cos.ap-beijing.myqcloud.com/ad-swipes/3.jpg&#x27;, &#x27;2021-05-17 11:30:04&#x27;,&#x27;2021-05-17 11:30:06&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `tb_ad` (`id`, `type`, `title`, `url`, `created`, `updated`) </span><br><span class="line">VALUES (&#x27;4&#x27;,&#x27;1&#x27;, &#x27;[上海周边 嘉兴] 融创海逸长洲&#x27;, &#x27;https://haoke-1257323542.cos.ap-beijing.myqcloud.com/ad-swipes/4.jpg&#x27;, &#x27;2021-05-17 11:30:49&#x27;,&#x27;2021-05-17 11:30:53&#x27;);</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210517211124420.png" alt></p><h2 id="创建HAProxy"><a href="#创建HAProxy" class="headerlink" title="创建HAProxy"></a>创建HAProxy</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull haproxy:1.9.3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建目录，用于存放配置文件</span></span><br><span class="line">mkdir /haoke/haproxy -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name haproxy --net host -v /root/haoke/haproxy:/usr/local/etc/haproxy haproxy:1.9.3</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建文件</span></span><br><span class="line">vim /haoke/haproxy/haproxy.cfg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入如下内容</span></span><br><span class="line">global</span><br><span class="line">    log 127.0.0.1 local2</span><br><span class="line">    maxconn 4000</span><br><span class="line">    daemon</span><br><span class="line">    </span><br><span class="line">defaults</span><br><span class="line">	mode	http</span><br><span class="line">	log 	global</span><br><span class="line">	option	 httplog</span><br><span class="line">	option 	dontlognull</span><br><span class="line">	option 	http-server-close</span><br><span class="line">	option 	forwardfor except 127.0.0.0/8</span><br><span class="line">	option 	redispatch</span><br><span class="line">	retries 	3</span><br><span class="line">	timeout 	http-request 10s</span><br><span class="line">	timeout 	queue 1m</span><br><span class="line">	timeout 	connect 10s</span><br><span class="line">	timeout 	client 1m</span><br><span class="line">	timeout 	server 1m</span><br><span class="line">	timeout 	http-keep-alive 10s</span><br><span class="line">	timeout 	check 10s</span><br><span class="line">	maxconn 	3000</span><br><span class="line">	</span><br><span class="line">listen admin_stats</span><br><span class="line">	bind 	0.0.0.0:4001</span><br><span class="line">	mode 	http</span><br><span class="line">	stats	 uri /dbs</span><br><span class="line">	stats	 realm Global\ statistics</span><br><span class="line">	stats	 auth admin:admin</span><br><span class="line">	</span><br><span class="line">listen proxy-mysql</span><br><span class="line">	bind 0.0.0.0:4002</span><br><span class="line">	mode tcp</span><br><span class="line">	balance roundrobin</span><br><span class="line">	option tcplog</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">代理mycat服务</span></span><br><span class="line">		server mycat_1 82.157.25.57:18068 check port 18068 maxconn 2000</span><br><span class="line">		server mycat_2 8.140.130.91:18069 check port 18069 maxconn 2000</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动容器</span></span><br><span class="line">docker restart haproxy &amp;&amp; docker logs -f haproxy</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`, `payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`) </span><br><span class="line">VALUES (&#x27;1&#x27;, &#x27;东方曼哈顿 3室2厅 16000元&#x27;, &#x27;1005&#x27;, &#x27;2&#x27;, &#x27;1&#x27;, &#x27;1&#x27;,&#x27;1111&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1室1厅1卫1厨1阳台&#x27;, &#x27;2&#x27;, &#x27;2&#x27;, &#x27;1/2&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3,8,9&#x27;, NULL, &#x27;这个经纪人很懒，没写核心卖点&#x27;, &#x27;张三&#x27;, &#x27;11111111111&#x27;, &#x27;1&#x27;, &#x27;11&#x27;, &#x27;2018-11-16 01:16:00&#x27;,&#x27;2018-11-16 01:16:00&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`, `payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`) </span><br><span class="line">VALUES (&#x27;2&#x27;, &#x27;康城 3室2厅1卫&#x27;, &#x27;1002&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;2000&#x27;, &#x27;1&#x27;,&#x27;2&#x27;, &#x27;3室2厅1卫1厨2阳台&#x27;, &#x27;100&#x27;, &#x27;80&#x27;, &#x27;2/20&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3,7,6&#x27;, NULL, &#x27;拎包入住&#x27;,&#x27;张三&#x27;, &#x27;18888888888&#x27;, &#x27;5&#x27;, &#x27;1.5&#x27;, &#x27;2018-11-16 01:34:02&#x27;, &#x27;2018-11-16 01:34:02&#x27;);</span><br><span class="line">=====</span><br><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`, `payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`) </span><br><span class="line">VALUES (&#x27;3&#x27;, &#x27;2&#x27;, &#x27;1002&#x27;, &#x27;2&#x27;, &#x27;2&#x27;, &#x27;2&#x27;, &#x27;2&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1室1厅1卫1厨1阳台&#x27;, &#x27;22&#x27;, &#x27;11&#x27;, &#x27;1/5&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3&#x27;, NULL, &#x27;11&#x27;, &#x27;22&#x27;, &#x27;33&#x27;, &#x27;1&#x27;, &#x27;3&#x27;,&#x27;2018-11-16 21:15:29&#x27;, &#x27;2018-11-16 21:15:29&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`,`payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`) </span><br><span class="line">VALUES (&#x27;4&#x27;, &#x27;11&#x27;, &#x27;1002&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1室1厅1卫1厨1阳台&#x27;, &#x27;11&#x27;, &#x27;1&#x27;, &#x27;1/1&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3&#x27;, NULL, &#x27;11&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;,&#x27;2018-11-16 21:16:50&#x27;, &#x27;2018-11-16 21:16:50&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`, `payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`)</span><br><span class="line">VALUES (&#x27;5&#x27;, &#x27;最新修改房源5&#x27;, &#x27;1002&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;3000&#x27;, &#x27;1&#x27;,&#x27;1&#x27;, &#x27;1室1厅1卫1厨1阳台&#x27;, &#x27;80&#x27;, &#x27;1&#x27;, &#x27;1/1&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3&#x27;, &#x27;http://itcast-haoke.osscn-qingdao.aliyuncs.com/images/2018/12/04/15439353467987363.jpg,http://itcasthaoke.oss-cn-qingdao.aliyuncs.com/images/2018/12/04/15439354795233043.jpg&#x27;, &#x27;11&#x27;, &#x27;1&#x27;,&#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;2018-11-16 21:17:02&#x27;, &#x27;2018-12-04 23:05:19&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`, `payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`) </span><br><span class="line">VALUES (&#x27;6&#x27;, &#x27;房源标题&#x27;, &#x27;1002&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;11&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1室1厅1卫1厨1阳台&#x27;, &#x27;11&#x27;, &#x27;1&#x27;, &#x27;1/1&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3&#x27;, &#x27;http://itcast-haoke.oss-cnqingdao.aliyuncs.com/images/2018/11/16/15423743004743329.jpg,http://itcast-haoke.osscn-qingdao.aliyuncs.com/images/2018/11/16/15423743049233737.jpg&#x27;, &#x27;11&#x27;, &#x27;2&#x27;, &#x27;2&#x27;, &#x27;1&#x27;,&#x27;1&#x27;, &#x27;2018-11-16 21:18:41&#x27;, &#x27;2018-11-16 21:18:41&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`,`payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`) </span><br><span class="line">VALUES (&#x27;7&#x27;, &#x27;房源标题&#x27;, &#x27;1002&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;11&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1室1厅1卫1厨1阳台&#x27;, &#x27;11&#x27;, &#x27;1&#x27;, &#x27;1/1&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3&#x27;, &#x27;http://itcast-haoke.oss-cnqingdao.aliyuncs.com/images/2018/11/16/15423743004743329.jpg,http://itcast-haoke.osscn-qingdao.aliyuncs.com/images/2018/11/16/15423743049233737.jpg&#x27;, &#x27;11&#x27;, &#x27;2&#x27;, &#x27;2&#x27;, &#x27;1&#x27;,&#x27;1&#x27;, &#x27;2018-11-16 21:18:41&#x27;, &#x27;2018-11-16 21:18:41&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`, `payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`)</span><br><span class="line">VALUES (&#x27;8&#x27;, &#x27;3333&#x27;, &#x27;1002&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1室1厅1卫1厨1阳台&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1/1&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3&#x27;, &#x27;http://itcast-haoke.oss-cnqingdao.aliyuncs.com/images/2018/11/17/15423896060254118.jpg,http://itcast-haoke.osscn-qingdao.aliyuncs.com/images/2018/11/17/15423896084306516.jpg&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;1&#x27;,&#x27;1&#x27;, &#x27;2018-11-17 01:33:35&#x27;, &#x27;2018-12-06 10:22:20&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `TB_HOUSE_RESOURCES` (`id`, `title`, `estate_id`, `building_num`,`building_unit`, `building_floor_num`, `rent`, `rent_method`, `payment_method`,`house_type`, `covered_area`, `use_area`, `floor`, `orientation`, `decoration`,`facilities`, `pic`, `house_desc`, `contact`, `mobile`, `time`, `property_cost`,`created`, `updated`) </span><br><span class="line">VALUES (&#x27;9&#x27;, &#x27;康城 精品房源2&#x27;, &#x27;1002&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;1000&#x27;, &#x27;1&#x27;,&#x27;1&#x27;, &#x27;1室1厅1卫1厨1阳台&#x27;, &#x27;50&#x27;, &#x27;40&#x27;, &#x27;3/20&#x27;, &#x27;南&#x27;, &#x27;1&#x27;, &#x27;1,2,3&#x27;, &#x27;http://itcasthaoke.oss-cnqingdao.aliyuncs.com/images/2018/11/30/15435106627858721.jpg,http://itcast-haoke.osscn-qingdao.aliyuncs.com/images/2018/11/30/15435107119124432.jpg&#x27;, &#x27;精品房源&#x27;, &#x27;李四&#x27;,&#x27;18888888888&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;2018-11-21 18:31:35&#x27;, &#x27;2018-11-30 00:58:46&#x27;);</span><br></pre></td></tr></table></figure><h1 id="Redis集群"><a href="#Redis集群" class="headerlink" title="Redis集群"></a>Redis集群</h1><p>redis采用2主2从的架构</p><h2 id="规划-1"><a href="#规划-1" class="headerlink" title="规划"></a>规划</h2><div class="table-container"><table><thead><tr><th>服务</th><th>端口</th><th>服务器</th><th>容器名</th></tr></thead><tbody><tr><td>Redis-node01</td><td>6379</td><td>8.140.130.91</td><td>redis-node01</td></tr><tr><td>Redis-node02</td><td>6380</td><td>8.140.130.91</td><td>redis-node02</td></tr><tr><td>Redis-node03</td><td>6381</td><td>8.140.130.91</td><td>redis-node03</td></tr><tr><td>Redis-node04</td><td>6382</td><td>82.157.25.57</td><td>redis-node04</td></tr><tr><td>Redis-node05</td><td>6383</td><td>82.157.25.57</td><td>redis-node05</td></tr><tr><td>Redis-node06</td><td>6384</td><td>82.157.25.57</td><td>redis-node06</td></tr></tbody></table></div><h2 id="阿里云"><a href="#阿里云" class="headerlink" title="阿里云"></a>阿里云</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker volume create redis-node01</span><br><span class="line">docker volume create redis-node02</span><br><span class="line">docker volume create redis-node03</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name redis-node01 --net host -v redis-node01:/data redis:5.0.2 --cluster-enabled yes --cluster-config-file nodes-node-01.conf --port 6379 --cluster-announce-ip 8.140.130.91 --cluster-announce-bus-port 16379</span><br><span class="line"></span><br><span class="line">docker create --name redis-node02 --net host -v redis-node02:/data redis:5.0.2 --cluster-enabled yes --cluster-config-file nodes-node-02.conf --port 6380 --cluster-announce-ip 8.140.130.91 --cluster-announce-bus-port 16380</span><br><span class="line"></span><br><span class="line">docker create --name redis-node03 --net host -v redis-node03:/data redis:5.0.2 --cluster-enabled yes --cluster-config-file nodes-node-03.conf --port 6381 --cluster-announce-ip 8.140.130.91 --cluster-announce-bus-port 16381</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">docker start redis-node01 redis-node02</span><br></pre></td></tr></table></figure><h2 id="腾讯云"><a href="#腾讯云" class="headerlink" title="腾讯云"></a>腾讯云</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker volume create redis-node04</span><br><span class="line">docker volume create redis-node05</span><br><span class="line">docker volume create redis-node06</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name redis-node04 --net host -v redis-node04:/data redis:5.0.2 --cluster-enabled yes --cluster-config-file nodes-node-04.conf --port 6382 --cluster-announce-bus-port 16382 --cluster-announce-ip 82.157.25.57</span><br><span class="line"></span><br><span class="line">docker create --name redis-node05 --net host -v redis-node05:/data redis:5.0.2 --cluster-enabled yes --cluster-config-file nodes-node-03.conf --port 6383 --cluster-announce-bus-port 16383 --cluster-announce-ip 82.157.25.57</span><br><span class="line"></span><br><span class="line">docker create --name redis-node06 --net host -v redis-node06:/data redis:5.0.2 --cluster-enabled yes --cluster-config-file nodes-node-03.conf --port 6384 --cluster-announce-bus-port 16384 --cluster-announce-ip 82.157.25.57</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">docker start redis-node05 redis-node06</span><br></pre></td></tr></table></figure><h2 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入redis-node01容器进行操作</span></span><br><span class="line">docker exec -it redis-node01 /bin/bash</span><br><span class="line"></span><br><span class="line">redis-cli --cluster create 8.140.130.91:6379 8.140.130.91:6380 8.140.130.91:6381 82.157.25.57:6382 82.157.25.57:6383 82.157.25.57:6384 --cluster-replicas 1</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210518090317951.png" alt="image-20210518090317951"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">redis-cli -c</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">是否能ping通</span></span><br><span class="line">ping</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群节点信息</span></span><br><span class="line">CLUSTER NODES</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210518090735787.png" alt="image-20210518090735787"></p><blockquote><p>redis 3.x先主后从<br>redis 5.x 随机选主从</p></blockquote><p><img src="/posts/2613761910/image-20210518090854704.png" alt></p><h1 id="部署ElastisSearch集群"><a href="#部署ElastisSearch集群" class="headerlink" title="部署ElastisSearch集群"></a>部署ElastisSearch集群</h1><p>Elasticsearch集群部署3个节点的集群</p><h2 id="规划-2"><a href="#规划-2" class="headerlink" title="规划"></a>规划</h2><div class="table-container"><table><thead><tr><th>服务</th><th>端口</th><th>服务器</th><th>容器名</th></tr></thead><tbody><tr><td>es-node01</td><td>9200，9300</td><td>8.140.130.91</td><td>es-node01</td></tr><tr><td>es-node02</td><td>9201，9301</td><td>8.130.140.91</td><td>es-node02</td></tr><tr><td>es-node03</td><td>9202，9302</td><td>82.157.25.57</td><td>es-node03</td></tr></tbody></table></div><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><h3 id="阿里云-1"><a href="#阿里云-1" class="headerlink" title="阿里云"></a>阿里云</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">node01/ elasticsearch.yml</span></span><br><span class="line">---</span><br><span class="line">cluster.name: es-haoke-cluster</span><br><span class="line"></span><br><span class="line">node.name: node01</span><br><span class="line">node.master: true</span><br><span class="line">node.data: true</span><br><span class="line"></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">network.publish_host: 8.140.130.91</span><br><span class="line">http.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;8.140.130.91:9300&quot;,&quot;8.140.130.91:9301&quot;,&quot;82.157.25.57:9302&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">---</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">jvm.options</span></span><br><span class="line">---</span><br><span class="line">-Xms512m</span><br><span class="line">-Xmx512m</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">mkdir /data/es-cluster-data/node01/data</span><br><span class="line">chmod 777 /data/es-cluster-data/node01/data</span><br><span class="line"></span><br><span class="line">docker create --name es-node01 --net host -v /data/es-cluster-data/node01/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /data/es-cluster-data/node01/jvm.options:/usr/share/elasticsearch/config/jvm.options -v /data/es-cluster-data/node01/data:/usr/share/elasticsearch/data -v /data/es-cluster-data/ik:/usr/share/elasticsearch/plugins/ik elasticsearch:6.5.4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">node02/ elasticsearch.yml</span></span><br><span class="line">---</span><br><span class="line">cluster.name: es-haoke-cluster</span><br><span class="line"></span><br><span class="line">node.name: node02</span><br><span class="line">node.master: true</span><br><span class="line">node.data: true</span><br><span class="line"></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">network.publish_host: 8.140.130.91</span><br><span class="line">http.host: 0.0.0.0</span><br><span class="line"></span><br><span class="line">http.port: 9201</span><br><span class="line">transport.tcp.port: 9301</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;8.140.130.91:9300&quot;,&quot;8.140.130.91:9301&quot;,&quot;82.157.25.57:9302&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">---</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">jvm.options</span></span><br><span class="line">---</span><br><span class="line">-Xms512m</span><br><span class="line">-Xmx512m</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">docker create --name es-node02 --net host -v /data/es-cluster-data/node02/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /data/es-cluster-data/node02/jvm.options:/usr/share/elasticsearch/config/jvm.options -v /data/es-cluster-data/node02/data:/usr/share/elasticsearch/data -v /data/es-cluster-data/ik:/usr/share/elasticsearch/plugins/ik elasticsearch:6.5.4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line">docker start es-node01 &amp;&amp; docker logs -f es-node01</span><br><span class="line">docker start es-node02 &amp;&amp; docker logs -f es-node02</span><br></pre></td></tr></table></figure><h3 id="腾讯云-1"><a href="#腾讯云-1" class="headerlink" title="腾讯云"></a>腾讯云</h3><p><img src="/posts/2613761910/image-20210518095732635.png" alt="image-20210518095732635"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">node03/ elasticsearch.yml</span></span><br><span class="line">---</span><br><span class="line">cluster.name: es-haoke-cluster</span><br><span class="line"></span><br><span class="line">node.name: node03</span><br><span class="line">node.master: true</span><br><span class="line">node.data: true</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当前系统的内网ip</span></span><br><span class="line">network.host: 172.21.0.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当前系统的公网ip</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置结点之间交互的ip地址</span></span><br><span class="line">network.publish_host: 82.157.25.57</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置可以访问的ip,默认为0.0.0.0，这里全部设置通过</span></span><br><span class="line">network.bind_host: 0.0.0.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">该主机的所有网卡可被访问</span></span><br><span class="line">http.host: 0.0.0.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">对外服务的http端口，默认为9200</span></span><br><span class="line">http.port: 9202</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">节点之间交互的tcp端口</span></span><br><span class="line">transport.tcp.port: 9302</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群单播发现</span></span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;8.140.130.91:9300&quot;,&quot;8.140.130.91:9301&quot;,&quot;82.157.25.57:9302&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line"></span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">---</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">jvm.options</span></span><br><span class="line">---</span><br><span class="line">-Xms512m</span><br><span class="line">-Xmx512m</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">docker create --name es-node03 --net host -v /data/es-cluster-data/node03/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /data/es-cluster-data/node03/jvm.options:/usr/share/elasticsearch/config/jvm.options -v /data/es-cluster-data/node03/data:/usr/share/elasticsearch/data -v /data/es-cluster-data/ik:/usr/share/elasticsearch/plugins/ik elasticsearch:6.5.4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line">docker start es-node03 &amp;&amp; docker logs -f es-node03</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210518120310937.png" alt="image-20210518120310937"></p><h2 id="创建索引测试"><a href="#创建索引测试" class="headerlink" title="创建索引测试"></a>创建索引测试</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">PUT http<span class="punctuation">:</span><span class="comment">//8.140.130.91:9200/haoke/</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;house&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;dynamic&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;pic&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;orientation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;houseType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;rentMethod&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;rent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;floor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210518121854995.png" alt="image-20210518121854995"></p><h1 id="Logstash同步mysql中数据到ES"><a href="#Logstash同步mysql中数据到ES" class="headerlink" title="Logstash同步mysql中数据到ES"></a>Logstash同步mysql中数据到ES</h1><h2 id="docker-logstash"><a href="#docker-logstash" class="headerlink" title="docker-logstash"></a>docker-logstash</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull logstash:6.5.4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建目录</span></span><br><span class="line">mkdir /data/logstash/data &amp;&amp; chmod 777 /data/logstash/data</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将原始配置文件复制到 logstash 数据目录下</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置文件目录</span></span><br><span class="line">mkdir /data/logstash/conf.d &amp;&amp; chmod 777 /data/logstash/conf.d</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置logstash.yml</span></span><br><span class="line"><span class="attr">path.config:</span> <span class="string">/usr/share/logstash/conf.d/*.conf</span></span><br><span class="line"><span class="attr">path.logs:</span> <span class="string">/var/log/logstash</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建容器</span></span><br><span class="line">docker run -it -d --name logstash -p 5044:5044 -v /data/logstash/logstash.yml:/usr/share/logstash/config/logstash.yml -v /data/logstash/conf.d/:/usr/share/logstash/conf.d/ logstash:6.5.4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">docker run -it -d logstash &amp;&amp; docker logs -f logstash</span><br></pre></td></tr></table></figure><h2 id="安装logstash-input-jdbc"><a href="#安装logstash-input-jdbc" class="headerlink" title="安装logstash-input-jdbc"></a>安装logstash-input-jdbc</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器中</span></span><br><span class="line">docker exec -it logstash bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入bin目录下，可以看到logstash-plugin文件夹，安装插件</span></span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210518170608594.png" alt="image-20210518170608594"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logstash-plugin install logstash-input-jdbc</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210518170635935.png" alt></p><h2 id="配置文件jdbc-conf"><a href="#配置文件jdbc-conf" class="headerlink" title="配置文件jdbc.conf"></a>配置文件jdbc.conf</h2><p><a target="_blank" rel="noopener" href="http://blog.sqber.com/articles/logstash-mysql-to-stdout.html">http://blog.sqber.com/articles/logstash-mysql-to-stdout.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    jdbc &#123;</span><br><span class="line">      jdbc_driver_library =&gt; &quot;./my/mysql-connector-java-8.0.25.jar&quot;</span><br><span class="line">      jdbc_driver_class =&gt; &quot;com.mysql.cj.jdbc.Driver&quot;</span><br><span class="line">      jdbc_connection_string =&gt; &quot;jdbc:mysql://82.157.25.57:4002/haoke?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC&quot;</span><br><span class="line">      jdbc_user =&gt; &quot;mycat&quot;</span><br><span class="line">      jdbc_password =&gt; &quot;mycat&quot;</span><br><span class="line">      schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">      statement_filepath =&gt; &quot;./my/jdbc.sql&quot;</span><br><span class="line">      tracking_column =&gt; updated</span><br><span class="line">      record_last_run =&gt; true</span><br><span class="line">      clean_run =&gt; false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">    json &#123;</span><br><span class="line">        source =&gt; &quot;message&quot;</span><br><span class="line">        remove_field =&gt; [&quot;message&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">    ruby &#123; </span><br><span class="line">        code =&gt; &quot;event.set(&#x27;timestamp&#x27;, event.get(&#x27;@timestamp&#x27;).time.localtime + 8*60*60)&quot; </span><br><span class="line">    &#125;</span><br><span class="line">    ruby &#123;</span><br><span class="line">        code =&gt; &quot;event.set(&#x27;@timestamp&#x27;,event.get(&#x27;timestamp&#x27;))&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    mutate &#123;</span><br><span class="line">        remove_field =&gt; [&quot;timestamp&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">output&#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts =&gt; [&quot;8.140.130.91:9200&quot;,&quot;8.140.130.91:9201&quot;,&quot;82.157.25.57:9202&quot;]</span><br><span class="line">        index =&gt; &quot;test&quot;</span><br><span class="line">        document_id =&gt; &quot;%&#123;id&#125;&quot;</span><br><span class="line">        document_type =&gt; &quot;house&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    stdout &#123;</span><br><span class="line">        codec =&gt; json_lines</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="配置jdbc-sql"><a href="#配置jdbc-sql" class="headerlink" title="配置jdbc.sql"></a>配置jdbc.sql</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id,title,pic,orientation,house_type,rent_method, time,rent,updated, floor from  users where updated&gt;=  :sql_last_value</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./logstash -f /data/logstash/jdbc.conf</span><br></pre></td></tr></table></figure><p><img src="/posts/2613761910/image-20210519083733742.png" alt="image-20210519083733742"></p><p><img src="/posts/2613761910/image-20210519083824299.png" alt="image-20210519083824299"></p><p><img src="/posts/2613761910/image-20210519084228346.png" alt="image-20210519084228346"></p><p>ES尽量使用单独的机器，如果要安装在一台机器上，那就看一下logstash的使用量，一般给个4G就够用了，然后给kibana留个1~2G，剩下的内存除以2，配置给ES就可以了，一般的机器都是最大32G，那个魔法值是对所有机器的。像你这里说的64G ，分给logstash4G、kibana2G，然后剩下58G，除以2，分配给ES 28G比较合理。</p><h1 id="搭建zk集群"><a href="#搭建zk集群" class="headerlink" title="搭建zk集群"></a>搭建zk集群</h1><h2 id="规划-3"><a href="#规划-3" class="headerlink" title="规划"></a>规划</h2><div class="table-container"><table><thead><tr><th>服务</th><th>端口</th><th>服务器</th><th>容器名</th></tr></thead><tbody><tr><td>zk01</td><td>2181，2888，3888</td><td>8.140.130.91</td><td>zk01</td></tr><tr><td>zk02</td><td>2181，2888，3888</td><td>82.157.25.57</td><td>zk02</td></tr></tbody></table></div><h2 id="部署-1"><a href="#部署-1" class="headerlink" title="部署"></a>部署</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">拉取zk镜像</span></span><br><span class="line">docker pull zookeeper:3.4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name zk01 --net host -e ZOO_MY_ID=1 -e ZOO_SERVERS=&quot;server.1=0.0.0.0:2888:3888 server.2=82.157.25.57:2888:3888&quot; zookeeper:3.4</span><br><span class="line"></span><br><span class="line">docker create --name zk02 --net host -e ZOO_MY_ID=2 -e ZOO_SERVERS=&quot;server.1=8.140.130.91:2888:3888 server.2=0.0.0.0:2888:3888&quot; zookeeper:3.4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动容器</span></span><br><span class="line">docker start zk01 &amp;&amp; docker logs -f zk01</span><br><span class="line">docker start zk02 &amp;&amp; docker logs -f zk02</span><br></pre></td></tr></table></figure><blockquote><p>问题：Cannot open channel to 1 at election address /8.140.130.91:3888</p></blockquote><p>将本机ip改为0.0.0.0</p><h1 id="搭建RocketMQ集群"><a href="#搭建RocketMQ集群" class="headerlink" title="搭建RocketMQ集群"></a>搭建RocketMQ集群</h1><p>2主2从</p><h2 id="规划-4"><a href="#规划-4" class="headerlink" title="规划"></a>规划</h2><div class="table-container"><table><thead><tr><th>服务</th><th>端口</th><th>服务器</th><th>容器名</th></tr></thead><tbody><tr><td>rmqserver01</td><td>9876</td><td>192.168.1.7</td><td>rmqserver01</td></tr><tr><td>rmqserver02</td><td>9877</td><td>192.168.1.7</td><td>rmqserver02</td></tr><tr><td>rmqbroker01</td><td>10911</td><td>192.168.1.19</td><td>rmqbroker01</td></tr><tr><td>rmqbroker02</td><td>10811</td><td>192.168.1.19</td><td>rmqbroker02</td></tr><tr><td>rmqbroker01-slave</td><td>10711</td><td>192.168.1.18</td><td>rmqbroker01-slave</td></tr><tr><td>rmqbroker02-slave</td><td>10611</td><td>192.168.1.18</td><td>rmqbroker02-slave</td></tr><tr><td>rocketmq-console</td><td>8082</td><td>192.168.1.7</td><td>rocketmq-console</td></tr></tbody></table></div></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------<i class="fa fa-hand-peace-o"></i>本文结束-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者 </strong>AmosTian</li><li class="post-copyright-link"><strong>本文链接 </strong><a href="https://amostian.github.io/posts/2613761910/" title="好客租房部署">https://amostian.github.io/posts/2613761910/</a></li><li class="post-copyright-license"><strong>版权声明 </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E5%BC%80%E5%8F%91/" rel="tag"><i class="fa fa-tags"></i> 开发</a> <a href="/tags/Java%E9%A1%B9%E7%9B%AE/" rel="tag"><i class="fa fa-tags"></i> Java项目</a> <a href="/tags/%E6%AF%95%E8%AE%BE%E9%A1%B9%E7%9B%AE/" rel="tag"><i class="fa fa-tags"></i> 毕设项目</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/2161105653/" rel="prev" title="ElasticStack"><i class="fa fa-chevron-left"></i> ElasticStack</a></div><div class="post-nav-item"><a href="/posts/3042078977/" rel="next" title="公费医疗报销系统">公费医疗报销系统 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84"><span class="nav-text">部署架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E8%AE%A1%E5%88%92"><span class="nav-text">部署计划</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mysql"><span class="nav-text">Mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%84%E5%88%92"><span class="nav-text">规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2PXC%E9%9B%86%E7%BE%A4%E2%80%94%E2%80%94%E9%98%BF%E9%87%8C%E4%BA%91"><span class="nav-text">部署PXC集群——阿里云</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%95%E6%9C%BA%E9%87%8D%E5%90%AF%E9%85%8D%E7%BD%AE"><span class="nav-text">宕机重启配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2MS%E9%9B%86%E7%BE%A4%E2%80%94%E2%80%94%E8%85%BE%E8%AE%AF%E4%BA%91"><span class="nav-text">部署MS集群——腾讯云</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#master"><span class="nav-text">master</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#slave"><span class="nav-text">slave</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2MyCat"><span class="nav-text">部署MyCat</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mycat01%E2%80%94%E2%80%94%E8%85%BE%E8%AE%AF%E4%BA%91"><span class="nav-text">mycat01——腾讯云</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#server-xml"><span class="nav-text">server.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#schema-xml"><span class="nav-text">schema.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rule-xml"><span class="nav-text">rule.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wrapper-conf"><span class="nav-text">wrapper.conf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95"><span class="nav-text">启动测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mycat02%E2%80%94%E2%80%94%E9%98%BF%E9%87%8C%E4%BA%91"><span class="nav-text">mycat02——阿里云</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#server-xml-1"><span class="nav-text">server.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#schema-xml-1"><span class="nav-text">schema.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rule-xml-1"><span class="nav-text">rule.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wrapper-conf-1"><span class="nav-text">wrapper.conf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8"><span class="nav-text">启动</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%8F%8A%E6%B5%8B%E8%AF%95"><span class="nav-text">创建表及测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAHAProxy"><span class="nav-text">创建HAProxy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E9%9B%86%E7%BE%A4"><span class="nav-text">Redis集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%84%E5%88%92-1"><span class="nav-text">规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91"><span class="nav-text">阿里云</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%85%BE%E8%AE%AF%E4%BA%91"><span class="nav-text">腾讯云</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2ElastisSearch%E9%9B%86%E7%BE%A4"><span class="nav-text">部署ElastisSearch集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%84%E5%88%92-2"><span class="nav-text">规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2"><span class="nav-text">部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91-1"><span class="nav-text">阿里云</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%85%BE%E8%AE%AF%E4%BA%91-1"><span class="nav-text">腾讯云</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%B5%8B%E8%AF%95"><span class="nav-text">创建索引测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Logstash%E5%90%8C%E6%AD%A5mysql%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%88%B0ES"><span class="nav-text">Logstash同步mysql中数据到ES</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-logstash"><span class="nav-text">docker-logstash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85logstash-input-jdbc"><span class="nav-text">安装logstash-input-jdbc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6jdbc-conf"><span class="nav-text">配置文件jdbc.conf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEjdbc-sql"><span class="nav-text">配置jdbc.sql</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%90%AD%E5%BB%BAzk%E9%9B%86%E7%BE%A4"><span class="nav-text">搭建zk集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%84%E5%88%92-3"><span class="nav-text">规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-1"><span class="nav-text">部署</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%90%AD%E5%BB%BARocketMQ%E9%9B%86%E7%BE%A4"><span class="nav-text">搭建RocketMQ集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%84%E5%88%92-4"><span class="nav-text">规划</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="AmosTian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">AmosTian</p><div class="site-description" itemprop="description">知道的越多，不知道的越多</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">235</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">68</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">84</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/AmosTian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AmosTian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://blog.csdn.net/qq_40479037?type=blog" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_40479037?type&#x3D;blog" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a> </span><span class="links-of-author-item"><a href="mailto:17636679561@163.com" title="E-Mail → mailto:17636679561@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("01/27/2022 15:13:14"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2026</span> <span class="with-love"><i class="fa fa-grav"></i> </span><span class="author" itemprop="copyrightHolder">AmosTian</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">站点总字数 </span><span title="站点总字数">1256.9k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">50:48</span></div></div></footer></div><script color="0,0,0" opacity="0.5" zindex="-1" count="150" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'neutral',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}</script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script><script async src="/js/cursor/fireworks.js"></script><script src="/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,document.body.addEventListener("input",POWERMODE)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"live2d-widget-model-hijiki"},display:{position:"right",width:150,height:300},mobile:{show:!1},log:!1})</script></body></html>