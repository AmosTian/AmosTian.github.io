<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/favicon.png" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa:300,300italic,400,400italic,700,700italic|Ma Shan Zheng:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"amostian.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="[TOC]"><meta property="og:type" content="article"><meta property="og:title" content="Ceph参数注解-mgr"><meta property="og:url" content="https://amostian.github.io/posts/3924783311/index.html"><meta property="og:site_name" content="AmosTian"><meta property="og:description" content="[TOC]"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://amostian.github.io/posts/3924783311/image-20240529162259428.png"><meta property="article:published_time" content="2024-06-24T06:04:16.000Z"><meta property="article:modified_time" content="2024-10-04T11:29:42.000Z"><meta property="article:author" content="AmosTian"><meta property="article:tag" content="存储"><meta property="article:tag" content="分布式存储"><meta property="article:tag" content="Ceph"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://amostian.github.io/posts/3924783311/image-20240529162259428.png"><link rel="canonical" href="https://amostian.github.io/posts/3924783311/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Ceph参数注解-mgr | AmosTian</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">AmosTian</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">68</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">83</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">236</span></a></li><li class="menu-item menu-item-essay"><a href="/categories/%E9%9A%8F%E7%AC%94/" rel="section"><i class="fa fa-fw fa-pied-piper"></i>随笔</a></li><li class="menu-item menu-item-dynamic-resume"><a href="/dynamic-resume/" rel="section"><i class="fa fa-fw fa-cog"></i>动态简历</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/AmosTian" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://amostian.github.io/posts/3924783311/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="AmosTian"><meta itemprop="description" content="知道的越多，不知道的越多"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="AmosTian"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Ceph参数注解-mgr</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间 2024-06-24 14:04:16" itemprop="dateCreated datePublished" datetime="2024-06-24T14:04:16+08:00">2024-06-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间 2024-10-04 19:29:42" itemprop="dateModified" datetime="2024-10-04T19:29:42+08:00">2024-10-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">存储</span></a> </span>> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AD%98%E5%82%A8/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">分布式存储</span></a> </span>> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AD%98%E5%82%A8/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/Ceph/" itemprop="url" rel="index"><span itemprop="name">Ceph</span></a></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数 </span><span title="本文字数">7.3k字 </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>15 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>[TOC]</p><span id="more"></span><h2 id="install-amp-configuration"><a href="#install-amp-configuration" class="headerlink" title="install&amp;configuration"></a>install&amp;configuration</h2><p><code>mgr_module_path</code> ：mgr 模块的文件系统路径</p><p><code>mgr_initial_modules</code> ：首次启动群集时要启用的管理器模块列表</p><ul><li>当集群在安装后首次启动时，监视器会读取此模块名称列表，以填充已启用的管理器模块列表。后续更新是使用“mgr module [enable|disable]”命令完成的。列表可以是逗号或空格分隔的。</li></ul><p><code>mgr_disabled_modules</code> ：永远不会加载的管理器模块列表</p><ul><li>以逗号分隔的模块名称列表。此列表在启动时由经理读取。默认情况下，管理器会加载指定“mgr_module_path”中的所有模块，并按照指示启动已启用的模块。此列表中的模块将完全不会加载</li></ul><p><code>mgr_standby_modules</code> ：在 standby 状态的 mgr 上启动的模块，以待机（重定向）模式启动模块</p><ul><li><p>默认情况下，备用模块将通过 HTTP 重定向到活动的管理器来响应传入请求，允许用户将浏览器指向任何 mgr 节点并找到指向活动管理器的方式。</p><p>但是，在使用负载均衡器时，此模式存在问题，因为 （1） 重定向位置通常是专用 IP，并且 （2） 负载均衡器无法确定哪个 mgr 是将流量发送到的正确 mgr。如果正在使用负载均衡器，请将其设置为 false。</p></li></ul><p><code>mgr_data</code> ：加载守护进程数据的路径（例如密钥环）</p><p><code>mgr_tick_period</code> ：要监视的信标消息的时间段（以秒为单位）</p><ul><li>mgr 信标与监视器之间有多少秒，以及其他定期检查。</li></ul><p><code>mon_mgr_beacon_grace</code> ：从最后一个信标到将管理器守护程序标记为失败的监视器的时间段（以秒为单位）</p><ul><li>mgr 心跳的宽限时长</li><li>从最后一个信标到监视器将管理器守护进程标记为失败的时间段（以秒为单位）</li></ul><p><code>mgr_ttl_cache_expire_seconds</code> ：将生存时间设置为以秒为单位 - 设置为 0 以禁用缓存</p><h2 id="enable-module"><a href="#enable-module" class="headerlink" title="enable module"></a>enable module</h2><h3 id="log-level-54-个"><a href="#log-level-54-个" class="headerlink" title="log_level-54 个"></a>log_level-54 个</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url: https://docs.ceph.com/en/quincy/mgr/modules/#logging</span><br><span class="line">title: &quot;ceph-mgr module developer’s guide — Ceph Documentation&quot;</span><br><span class="line">host: docs.ceph.com</span><br></pre></td></tr></table></figure><p>This is developer documentation, describing Ceph internals that are only relevant to people writing ceph-mgr modules.</p><ul><li>开发人员文档，描述与 ceph-mgr 模块相关的 Ceph 内部结构</li><li><strong>只有与 Ceph-mgr 模块开发相关的开发人员才需要调整这些参数</strong></li></ul><p>其中 <code>&lt;module-name&gt;</code> 是开发人员待调试的 Ceph管理模块，每个模块都支持 <code>log_level</code> 选项，用于指定模块当前的 Python 日志记录级别。模块启动时使用的日志记录级别由 MGR 守护进程的当前日志级别决定，可以使用 <code>config set</code> 对 <code>log_level</code> 进行指定</p><ul><li><p>默认的 MGR 日志级别映射到模块的 Python 日志记录级别为 ：</p><p>&lt;= 0 is CRITICAL；&lt;= 1 is WARNING；&lt;= 4 is INFO；&lt;= +inf is DEBUG</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过config get/set 查看或修改当前日志记录等级</span></span><br><span class="line">ceph config get mgr mgr/&lt;module_name&gt;/log_level</span><br><span class="line">ceph config set mgr mgr/&lt;module_name&gt;/log_level &lt;&quot;&quot;|critical|warning|info|debug|error|&gt;</span><br></pre></td></tr></table></figure><p><code>mgr/&lt;module-name&gt;/log_level</code> 类型的参数有 27 个，取值是枚举类型</p><p><code>mgr/&lt;module-name&gt;/log_to_cluster_level</code> 完全一致</p><h3 id="balancer"><a href="#balancer" class="headerlink" title="balancer"></a>balancer</h3><p>平衡器可以优化 OSD 之间的归置组 (PG) 分配，以实现平衡分配。平衡器可以自动运行或以受监督的方式运行。</p><p>要检查平衡器的当前状态，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph balancer status</span><br></pre></td></tr></table></figure><h4 id="自动平衡"><a href="#自动平衡" class="headerlink" title="自动平衡"></a>自动平衡</h4><p>当平衡器处于upmap模式时，默认启用自动平衡功能。若要禁用，则采用以下指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph balancer off</span><br></pre></td></tr></table></figure><p>平衡器模式可以从upmap模式更改为crush-compat模式。crush-compat 模式向后兼容旧客户端。在压缩兼容模式下，平衡器会自动对数据分布进行微小更改，以确保平等地利用 OSD。</p><h4 id="平衡计划"><a href="#平衡计划" class="headerlink" title="平衡计划"></a>平衡计划</h4><p>如果集群降级（即，如果某个 OSD 发生故障并且系统尚未自行修复），则平衡器不会对 PG 分配进行任何调整。当集群健康时，平衡器将逐步移动一小部分不平衡的 PG，以改善分布。该比例不会超过某个阈值（默认为 5% 的）。要调整此 target_max_misplaced_ratio 阈值设置，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr target_max_misplaced_ratio .07   # 7%</span><br></pre></td></tr></table></figure><p>平衡器在运行之间休眠。要设置此睡眠间隔的秒数，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr mgr/balancer/sleep_interval 60</span><br></pre></td></tr></table></figure><p>要设置自动平衡开始的时间（采用 HHMM 格式），请运行以下命令：</p><h4 id="平衡算法模式"><a href="#平衡算法模式" class="headerlink" title="平衡算法模式"></a>平衡算法模式</h4><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/operations/balancer/#modes">https://docs.ceph.com/en/quincy/rados/operations/balancer/#modes</a></p><h4 id="监督优化"><a href="#监督优化" class="headerlink" title="监督优化"></a>监督优化</h4><ol><li>制定计划</li><li>评估数据分布的质量，无论是当前的 PG 分布还是执行计划后产生的 PG 分布</li><li>执行计划</li></ol><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/operations/balancer/#supervised-optimization">https://docs.ceph.com/en/quincy/rados/operations/balancer/#supervised-optimization</a></p><h4 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h4><p><code>mgr/balancer/active</code> ：启动集群自动平衡 PG</p><p><code>mgr/balancer/begin_time</code> ：一天中的开始时间自动平衡</p><p><code>mgr/balancer/begin_weekday</code> ：将自动平衡限制为一周中的这一天或更晚</p><p><code>mgr/balancer/crush_compat_max_iterations</code> ：尝试优化的最大迭代次数</p><p><code>mgr/balancer/min_score</code> ：最低分数，低于该分数不尝试优化</p><p><code>mgr/balancer/upmap_max_deviation</code> ：偏差，低于该偏差不尝试优化</p><ul><li>如果 PG 的数量在此计数范围内，则不尝试优化</li></ul><p><code>mgr/balancer/upmap_max_optimizations</code> ：每次尝试的upmap的最大优化次数</p><h3 id="crash"><a href="#crash" class="headerlink" title="crash"></a>crash</h3><p>crash module 收集有关守护进程崩溃转储的信息并将其存储在 Ceph 集群中以供以后分析。</p><h4 id="启动crash模块"><a href="#启动crash模块" class="headerlink" title="启动crash模块"></a>启动crash模块</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph mgr module enable crash</span><br></pre></td></tr></table></figure><p>崩溃上传密钥是通过以下方式生成的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph auth get-or-create client.crash mon &#x27;profile crash&#x27; mgr &#x27;profile crash&#x27;</span><br></pre></td></tr></table></figure><p>在每个节点上，您应该将此密钥存储在 /etc/ceph/ceph.client.crash.keyring 中。</p><h4 id="自动收集"><a href="#自动收集" class="headerlink" title="自动收集"></a>自动收集</h4><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/mgr/crash/#automated-collection">https://docs.ceph.com/en/quincy/mgr/crash/#automated-collection</a></p><p>守护进程故障转储默认转储到 /var/lib/ceph/crash 中；这可以使用选项“crash dir”进行配置。崩溃目录按时间和日期以及随机生成的 UUID 命名，并包含元数据文件“meta”和最近的日志文件，“crash_id”相同。</p><p>使用 ceph-crash.service 可以自动提交这些崩溃并保留在监视器的存储中。它监视崩溃转储目录并使用 ceph 崩溃帖子上传它们。</p><h4 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h4><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/mgr/crash/#commands">https://docs.ceph.com/en/quincy/mgr/crash/#commands</a></p><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p><code>mgr/crash/retain_interval</code> ：在修剪崩溃报告之前将崩溃保留多长时间</p><p><code>mgr/crash/warn_recent_interval</code> ：警告最近崩溃的时间间隔</p><h3 id="devicehealth"><a href="#devicehealth" class="headerlink" title="devicehealth"></a>devicehealth</h3><p>设备管理允许 Ceph 解决硬件故障。 Ceph 跟踪硬件存储设备（HDD、SSD）以查看哪些设备由哪些守护进程管理。</p><p>Ceph 还收集有关这些设备的运行状况指标。通过这样做，Ceph 可以提供预测硬件故障的工具，并可以自动响应硬件故障。</p><h4 id="设备跟踪"><a href="#设备跟踪" class="headerlink" title="设备跟踪"></a>设备跟踪</h4><p>要查看正在使用的存储设备的列表，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device ls</span><br></pre></td></tr></table></figure><p>或者，要按守护程序或按主机列出设备，请运行以下形式之一的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph device ls-by-daemon &lt;daemon&gt;</span><br><span class="line">ceph device ls-by-host &lt;host&gt;</span><br></pre></td></tr></table></figure><p>要查看有关特定设备的位置以及如何使用该设备的信息，请运行以下形式的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device info &lt;devid&gt;</span><br></pre></td></tr></table></figure><h4 id="识别物理设备"><a href="#识别物理设备" class="headerlink" title="识别物理设备"></a>识别物理设备</h4><p>为了更轻松地更换故障磁盘且不易出错，您可以（在某些情况下）通过运行以下形式的命令来“闪烁”硬件外壳上的驱动器 LED：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">device light on|off &lt;devid&gt; [ident|fault] [--force]</span><br></pre></td></tr></table></figure><blockquote><p>使用此命令使灯闪烁可能不起作用。它是否有效取决于您的内核版本、SES 固件或 HBA 设置等因素。</p></blockquote><ul><li><p><devid>参数是设备标识。要检索此信息，请运行以下命令：<code>ceph device ls</code></devid></p></li><li><p>[ident|fault] 参数决定哪种灯会闪烁。默认情况下，使用识别灯。</p><p>仅当启用了 Cephadm 或 Rook Orchestrator 模块时，此命令才有效。要查看启用了哪个 Orchestrator 模块，请运行以下命令：</p><p><code>ceph orch status</code></p></li><li><p>使驱动器 LED 闪烁的命令是 lsmcli。要自定义此命令，请通过 Jinja2 模板运行以下形式的命令来配置它：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph config-key set mgr/cephadm/blink_device_light_cmd &quot;&lt;template&gt;&quot;</span><br><span class="line">ceph config-key set mgr/cephadm/&lt;host&gt;/blink_device_light_cmd &quot;lsmcli local-disk-&#123;&#123; ident_fault &#125;&#125;-led-&#123;&#123;&#x27;on&#x27; if on else &#x27;off&#x27;&#125;&#125; --path &#x27;&#123;&#123; path or dev &#125;&#125;&#x27;&quot;</span><br></pre></td></tr></table></figure><p>以下参数可用于自定义 Jinja2 模板：</p><ul><li><p><code>on</code></p><p>A boolean value.</p></li><li><p><code>ident_fault</code></p><p>A string that contains ident or fault.</p></li><li><p><code>dev</code></p><p>A string that contains the device ID: for example, SanDisk_X400_M.2_2280_512GB_162924424784.</p></li><li><p><code>path</code></p><p>A string that contains the device path: for example, /dev/sda.</p></li></ul></li></ul><h4 id="启用设备监控"><a href="#启用设备监控" class="headerlink" title="启用设备监控"></a>启用设备监控</h4><p>Ceph 还可以监控与您的设备相关的运行状况指标。例如，SATA 驱动器实施了一项名为 SMART 的标准，该标准提供了有关设备使用情况和健康状况的广泛内部指标（例如：通电时间、电源循环次数、不可恢复的读取错误数量）。其他设备类型（如 SAS 和 NVMe）提供了一组类似的指标（通过略有不同的标准）。所有这些指标都可以通过 Ceph 收集（利用 <code>smartctl</code>工具）。</p><p>您可以通过运行以下命令之一来启用或禁用运行状况监控：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph device monitoring on</span><br><span class="line">ceph device monitoring off</span><br></pre></td></tr></table></figure><h4 id="抓取指标"><a href="#抓取指标" class="headerlink" title="抓取指标"></a>抓取指标</h4><p>如果启用监控，设备指标将定期自动抓取。要配置该间隔，请运行以下形式的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr mgr/devicehealth/scrape_frequency &lt;seconds&gt;</span><br></pre></td></tr></table></figure><p>默认情况下，设备指标每 24 小时抓取一次。</p><p>要手动抓取所有设备，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device scrape-health-metrics</span><br></pre></td></tr></table></figure><p>要抓取单个设备，请运行以下形式的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device scrape-health-metrics &lt;device-id&gt;</span><br></pre></td></tr></table></figure><p>要抓取单个守护程序的设备，请运行以下形式的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device scrape-daemon-health-metrics &lt;who&gt;</span><br></pre></td></tr></table></figure><p>要检索设备存储的运行状况指标（可以选择特定时间戳），请运行以下形式的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device get-health-metrics &lt;devid&gt; [sample-timestamp]</span><br></pre></td></tr></table></figure><h4 id="故障预测"><a href="#故障预测" class="headerlink" title="故障预测"></a>故障预测</h4><p>Ceph 可以通过分析其收集的运行状况指标来预测驱动器的预期寿命和设备故障。预测模式如下：</p><ul><li>none：禁用设备故障预测。</li><li>local：使用来自 ceph-mgr 守护进程的预训练预测模型。</li></ul><p>要配置预测模式，请运行以下形式的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set global device_failure_prediction_mode &lt;mode&gt;</span><br></pre></td></tr></table></figure><p>在正常情况下，故障预测会在后台定期运行。因此，预期寿命值可能仅在经过相当长的时间后才会填充。所有设备的预期寿命显示在以下命令的输出中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device ls</span><br></pre></td></tr></table></figure><p>要查看特定设备的元数据，请运行以下形式的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device info &lt;devid&gt;</span><br></pre></td></tr></table></figure><p>要明确强制预测特定设备的预期寿命，请运行以下形式的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device predict-life-expectancy &lt;devid&gt;</span><br></pre></td></tr></table></figure><p>除了 Ceph 的内部设备故障预测之外，您可能还有有关设备故障的外部信息源。要告知 Ceph 特定设备的预期寿命，请运行以下形式的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device set-life-expectancy &lt;devid&gt; &lt;from&gt; [&lt;to&gt;]</span><br></pre></td></tr></table></figure><p>预期寿命以时间间隔来表示。这意味着预期寿命的不确定性可以用时间范围的形式来表示，也许是一个很宽的时间范围。间隔的结束时间可以不指定</p><h4 id="健康报警"><a href="#健康报警" class="headerlink" title="健康报警"></a>健康报警</h4><p><code>mgr/devicehealth/warn_threshold</code> 配置选项控制预期设备故障的健康检查。如果预计设备将在指定的时间间隔内发生故障，则会发出警报。</p><p>要检查所有设备的存储预期寿命并生成任何适当的健康警报，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph device check-health</span><br></pre></td></tr></table></figure><h4 id="自动迁移"><a href="#自动迁移" class="headerlink" title="自动迁移"></a>自动迁移</h4><p>mgr/devicehealth/self_heal 选项（默认情况下启用）会自动将数据从预计很快会发生故障的设备中迁移出来。如果启用此选项，模块会将此类设备标记 <code>out</code> ，以便进行自动迁移。</p><blockquote><p>mon_osd_min_up_ratio 配置选项可以帮助防止此进程级联至完全失败。如果“自我修复（self heal）”模块标记出过多的 OSD，以致超出了 mon_osd_min_up_ratio 的比率值，则集群将引发 DEVICE_HEALTH_TOOMANY 健康检查。</p></blockquote><p>mgr/devicehealth/mark_out_threshold 配置选项指定自动迁移的时间间隔。如果预计设备在指定时间间隔内出现故障，则会自动将其标记为淘汰。</p><p><code>mgr/devicehealth/pool_name</code> 要在其中存储设备运行状况指标的池的名称</p><p><code>mgr/devicehealth/retention_period</code> ：设备运行状况指标保留多长时间</p><p><code>mgr/devicehealth/self_heal</code> ：抢先修复可能发生故障的设备周围的集群</p><p><code>mgr/devicehealth/sleep_interval</code> ：唤醒和检查设备运行状况的频率</p><h3 id="orchestrator"><a href="#orchestrator" class="headerlink" title="orchestrator"></a>orchestrator</h3><p>In this context, <em>orchestrator</em> refers to some external service that provides the ability to discover devices and create Ceph services. This includes external projects such as Rook.</p><ul><li>在这种情况下，orchestrator 指的是一些提供发现设备和创建 Ceph 服务能力的外部服务。包括 Rook 等外部项目。</li></ul><h3 id="pg-autoscaler"><a href="#pg-autoscaler" class="headerlink" title="pg_autoscaler"></a>pg_autoscaler</h3><p><code>mgr/pg_autoscaler/threshold</code> ：“新PG_NUM”在被接受之前必须与当前“PG_NUM”不同的因素。不能小于 1.0</p><h3 id="progress"><a href="#progress" class="headerlink" title="progress"></a>progress</h3><p>进度模块用于通知用户受以下事件影响的 PG（放置组）的恢复进度：</p><p>(1) OSD 被标记入或标记出以及 (2) pg_autoscaler 尝试匹配目标 PG 编号。</p><p>ceph -s 命令返回“Global Recovery Progress(全局恢复进度)”，它报告 PG 的整体恢复进度，并且基于处于 active+clean 状态的 PG 数量。</p><h4 id="启用"><a href="#启用" class="headerlink" title="启用"></a>启用</h4><p>进度模块默认启用，但可以通过运行以下命令手动启用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph progress on</span><br><span class="line">ceph progress off</span><br></pre></td></tr></table></figure><h4 id="指令-1"><a href="#指令-1" class="headerlink" title="指令"></a>指令</h4><p>显示所有正在进行和已完成的事件及其持续时间的摘要：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph progress</span><br></pre></td></tr></table></figure><p>以 JSON 格式显示正在进行和已完成的事件的摘要</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph progress json</span><br></pre></td></tr></table></figure><p>清除所有正在进行和已完成的事件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph progress clear</span><br></pre></td></tr></table></figure><h4 id="PG恢复事件"><a href="#PG恢复事件" class="headerlink" title="PG恢复事件"></a>PG恢复事件</h4><p>受恢复事件影响的每个 PG 的事件都可以在 <code>ceph progress</code> 中显示。这是完全可选的，并且考虑到 CPU 负载而默认禁用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr mgr/progress/allow_pg_recovery_event true</span><br></pre></td></tr></table></figure><p><code>mgr/progress/max_completed_events</code> ：要记住的过去已完成事件的数量</p><p><code>mgr/progress/sleep_interval</code> ：模块将休眠多长时间</p><h3 id="rbd-support"><a href="#rbd-support" class="headerlink" title="rbd_support"></a>rbd_support</h3><p><code>mgr/rbd_support/max_concurrent_snap_create</code> ：</p><h3 id="status"><a href="#status" class="headerlink" title="status"></a>status</h3><p>完成</p><h3 id="telemetry"><a href="#telemetry" class="headerlink" title="telemetry"></a>telemetry</h3><p>遥测模块将有关集群的匿名数据发送回 Ceph 开发人员，以帮助了解 Ceph 的使用方式以及用户可能遇到的问题。这些数据在公共仪表板上可视化，使社区能够快速查看有关正在报告的集群数量、总容量和 OSD 计数以及版本分布趋势的摘要统计信息。</p><h4 id="通道"><a href="#通道" class="headerlink" title="通道"></a>通道</h4><p>遥测报告分为多个“通道”，每个通道都有不同类型的信息。假设遥测已启用，则可以打开和关闭各个通道。 （如果遥测关闭，则每通道设置无效。）</p><ul><li>basic（默认：on）：集群的基本信息<ul><li>集群容量</li><li>监视器、管理器、OSD、MDS、对象网关或其他守护程序的数量</li><li>当前使用的软件版本</li><li>RADOS 池和 CephFS 文件系统的数量和类型</li><li>已更改默认配置选项的名称（但不更改其值）</li></ul></li><li>crash（默认：on）：有关守护进程崩溃的信息，包括<ul><li>守护进程类型</li><li>守护进程的版本</li><li>操作系统（操作系统发行版、内核版本）</li><li>堆栈跟踪可识别 Ceph 代码中发生崩溃的位置</li></ul></li><li>device（默认：on）：有关设备指标的信息，包括<ul><li>匿名 SMART 指标</li></ul></li><li>ident（默认值：关闭）：用户提供的有关集群的标识信息<ul><li>集群描述</li><li>联系电子邮件地址</li></ul></li><li>perf（默认：off）：集群的各种性能指标，可用于<ul><li>揭示集群的整体健康状况</li><li>确定工作负载模式</li><li>解决延迟、限制、内存管理等问题。</li><li>通过守护进程监控集群性能</li></ul></li></ul><p>报告的数据不包含任何敏感数据，例如池名称、对象名称、对象内容、主机名或设备序列号。</p><p>它包含有关集群如何部署、Ceph 版本、主机分布和其他参数的计数器和统计信息，帮助项目更好地了解 Ceph 的使用方式</p><p>数据安全发送到 <a target="_blank" rel="noopener" href="https://telemetry.ceph.com。">https://telemetry.ceph.com。</a></p><p>可以通过以下方式启用或禁用各个通道：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry enable channel basic</span><br><span class="line">ceph telemetry enable channel crash</span><br><span class="line">ceph telemetry enable channel device</span><br><span class="line">ceph telemetry enable channel ident</span><br><span class="line">ceph telemetry enable channel perf</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry enable channel basic crash device ident perf</span><br><span class="line">ceph telemetry disable channel basic crash device ident perf</span><br></pre></td></tr></table></figure><p>可以通过以下方式一次性启用或禁用所有通道：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry enable channel all</span><br><span class="line">ceph telemetry disable channel all</span><br></pre></td></tr></table></figure><p>请注意，遥测必须打开才能使这些命令生效。</p><p>列出所有频道：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry channel ls</span><br><span class="line"></span><br><span class="line">NAME      ENABLED    DEFAULT    DESC</span><br><span class="line">basic     ON         ON         Share basic cluster information (size, version)</span><br><span class="line">crash     ON         ON         Share metadata about Ceph daemon crashes (version, stack straces, etc)</span><br><span class="line">device    ON         ON         Share device health metrics (e.g., SMART data, minus potentially identifying info like serial numbers)</span><br><span class="line">ident     OFF        OFF        Share a user-provided description and/or contact email for the cluster</span><br></pre></td></tr></table></figure><h4 id="启用遥测"><a href="#启用遥测" class="headerlink" title="启用遥测"></a>启用遥测</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry on</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/mgr/telemetry/#enabling-telemetry">https://docs.ceph.com/en/latest/mgr/telemetry/#enabling-telemetry</a></p><h4 id="报告样本"><a href="#报告样本" class="headerlink" title="报告样本"></a>报告样本</h4><p>您可以随时使用以下命令查看报告的数据：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry show</span><br></pre></td></tr></table></figure><p>如果遥测关闭，您可以通过以下方式预览示例报告：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry preview</span><br></pre></td></tr></table></figure><p>在大型集群（具有数百个或更多 OSD 的集群）中，生成示例报告可能需要一些时间。</p><p>为了保护您的隐私，设备报告是单独生成的，并且主机名和设备序列号等数据是匿名的。设备遥测数据被发送到不同的端点，并且不会将设备数据与特定集群关联。要查看设备报告的预览，请使用以下命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry show-device</span><br><span class="line">ceph telemetry preview-device</span><br></pre></td></tr></table></figure><p>请注意：为了生成设备报告，我们使用 Smartmontools 7.0 及更高版本，它支持 JSON 输出。</p><p>如果您希望一个输出同时有两个报告，并且遥测已打开，请使用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry show-all</span><br><span class="line">ceph telemetry preview-all</span><br></pre></td></tr></table></figure><h4 id="按通道的报告示例"><a href="#按通道的报告示例" class="headerlink" title="按通道的报告示例"></a>按通道的报告示例</h4><p>当遥测开启时，您可以通过以下方式查看通道报告的数据：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry show &lt;channel_name&gt;</span><br></pre></td></tr></table></figure><p>请注意：如果遥测已打开，并且<channel_name>已禁用，则上述命令将根据用户注册的集合输出该通道的示例报告。然而，由于通道被禁用，因此不会报告此数据。</channel_name></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry preview &lt;channel_name&gt;</span><br></pre></td></tr></table></figure><h4 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h4><p>集合代表我们在渠道内收集的数据的不同方面。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry collection ls</span><br></pre></td></tr></table></figure><p>NAME：集合名称； prefix 表示集合所属的频道。</p><p>status：表示是否报告集合指标；这取决于集合所属频道的状态（启用/禁用）以及集合的注册状态（用户是否选择加入此集合）。</p><p>DESC：集合的一般描述。</p><p>查看您注册的集合与新的可用集合之间的差异：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry diff</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过以下方式注册最新的集合：</span></span><br><span class="line">ceph telemetry on</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后启用已关闭的新通道：</span></span><br><span class="line">ceph telemetry enable channel &lt;channel_name&gt;</span><br></pre></td></tr></table></figure><h4 id="INTERVAL"><a href="#INTERVAL" class="headerlink" title="INTERVAL"></a>INTERVAL</h4><p>默认情况下，模块每 24 小时编译并发送一份新报告。您可以通过以下方式调整此间隔：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr mgr/telemetry/interval 72    # report every three days</span><br></pre></td></tr></table></figure><p>手动发送遥测数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry send</span><br></pre></td></tr></table></figure><p>如果未启用遥测（“ceph telemetry on”），您需要将“—licensesharing-1-0”添加到“ceph telemetry send”命令中。</p><h4 id="STATUS"><a href="#STATUS" class="headerlink" title="STATUS"></a>STATUS</h4><p>查看当前配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph telemetry status</span><br></pre></td></tr></table></figure><h4 id="通过代理发送遥测数据"><a href="#通过代理发送遥测数据" class="headerlink" title="通过代理发送遥测数据"></a>通过代理发送遥测数据</h4><p>如果集群无法直接连接到配置的遥测端点（默认 telemetry.ceph.com），您可以使用以下命令配置 HTTP/HTTPS 代理服务器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr mgr/telemetry/proxy https://10.0.0.1:8080</span><br></pre></td></tr></table></figure><p>如果需要，您还可以包含 user:pass：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr mgr/telemetry/proxy https://ceph:telemetry@10.0.0.1:8080</span><br></pre></td></tr></table></figure><h4 id="agent"><a href="#agent" class="headerlink" title="agent"></a>agent</h4><p><code>mgr/telemetry/last_opt_revision</code> ：</p><p><code>mgr/cephadm/agent_down_multiplier</code> ：通过与代理刷新率相乘，来计算代理在被标记为不可用之前必须多久没有上报</p><h3 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a>volumes</h3><p><code>mgr/volumes/max_concurrent_clones</code> ：异步克隆程序线程数</p><p><code>mgr/volumes/snapshot_clone_delay</code> ：将克隆开始操作延迟 snapshot_clone_delay 秒</p><h3 id="cephadm"><a href="#cephadm" class="headerlink" title="cephadm"></a>cephadm</h3><p><code>mgr/cephadm/agent_down_multiplier</code> ：与代理刷新率(agent_refresh_rate)相乘，计算代理在被标记之前不得报告的时间</p><p><code>mgr/cephadm/agent_refresh_rate</code> ：每个主机上的代理尝试收集和发送元数据的频率</p><p><code>mgr/cephadm/agent_starting_port</code> ：代理将尝试绑定到的第一个端口（如果被阻止，还将尝试下一个 1000 个后续端口）</p><p><code>mgr/cephadm/allow_ptrace</code> ：允许在 Ceph 容器上启用SYS_PTRACE功能</p><ul><li>需要SYS_PTRACE功能才能附加到具有 gdb 或 strace 的进程。启用此选项可以允许调试在运行时遇到问题的守护程序。</li></ul><p><code>mgr/cephadm/cgroups_split</code> ：当 cephadm 创建容器时传递 —cgroups=split（目前仅限 podman）</p><p><code>mgr/cephadm/config_checks_enabled</code> ：启用或禁用 cephadm 配置分析</p><p><code>mgr/cephadm/default_cephadm_command_timeout</code> ：应用于 cephadm 命令的默认超时直接在主机上运行（以秒为单位）</p><p><code>mgr/cephadm/device_cache_timeout</code> ：缓存设备清单的秒数</p><p><code>mgr/cephadm/device_enhanced_scan</code> ：在设备扫描期间使用 libstoragemgmt</p><p><code>mgr/cephadm/facts_cache_timeout</code> ：缓存主机事实数据的秒数</p><p><code>mgr/cephadm/host_check_interval</code> ：执行主机检查的频率</p><p><code>mgr/cephadm/inventory_list_all</code> ：ceph-volume 清单是否应该报告更多设备（主要是映射器（LV、mpaths）、分区……</p><p><code>mgr/cephadm/log_refresh_metadata</code> ：记录所有刷新元数据。包括定期收集的守护程序、设备和主机信息。仅当日志记录在调试级别时才有效</p><p><code>mgr/cephadm/log_to_cluster</code> ：</p><p><code>mgr/cephadm/manage_etc_ceph_ceph_conf</code> ：在主机上管理和拥有 /etc/ceph/ceph.conf。</p><p><code>mgr/cephadm/manage_etc_ceph_ceph_conf_hosts</code> ：PlacementSpec 描述要在哪些主机上管理 etccephceph.conf</p><p><code>mgr/cephadm/max_count_per_host</code> ：每个主机的每个服务的最大守护程序数</p><p><code>mgr/cephadm/max_osd_draining_count</code> ：移除 OSD 时将同时排空的最大 OSD 数量</p><p><code>mgr/cephadm/mode</code> ：远程执行 CEPHADM 的模式</p><p><code>mgr/cephadm/registry_insecure</code> ：注册表将被视为不安全（没有可用的 TLS）。仅用于开发目的</p><p><code>mgr/cephadm/use_agent</code> ：在每个主机上使用 cephadm 代理来收集和发送元数据</p><p><code>mgr/cephadm/use_repo_digest</code> ：自动将镜像标签转换为镜像摘要。确保所有守护进程都使用相同的镜像</p><p><code>mgr/cephadm/warn_on_failed_host_check</code> ：如果主机检查失败，则引发运行状况警告</p><p><code>mgr/cephadm/warn_on_stray_daemons</code> ：如果检测到不受 CEPHADM 管理的守护程序，则会引发运行状况警告</p><p><code>mgr/cephadm/warn_on_stray_hosts</code> ：如果在不受 CEPHADM 管理的主机上检测到守护程序，则会引发运行状况警告</p><h3 id="dashboard"><a href="#dashboard" class="headerlink" title="dashboard"></a>dashboard</h3><p><code>mgr/dashboard/FEATURE_TOGGLE_CEPHFS</code> ：控制是否启用 Ceph 文件系统（CephFS）特性的一个功能切换或配置选项</p><p><code>mgr/dashboard/standby_behaviour</code> 与性能无关</p><p>If the dashboard is behind a load-balancing proxy like <a target="_blank" rel="noopener" href="https://www.haproxy.org/">HAProxy</a> you might want to disable redirection to prevent situations in which internal (unresolvable) URLs are published to the frontend client. Use the following command to get the dashboard to respond with an HTTP error (500 by default) instead of redirecting to the active dashboard:</p><p><code>ceph config set mgr mgr/dashboard/standby_behaviour &quot;error&quot;</code></p><p>To reset the setting to default redirection, use the following command:</p><p><code>ceph config set mgr mgr/dashboard/standby_behaviour &quot;redirect&quot;</code></p><ul><li>如果您的前端负载均衡器（如HAProxy, 更接近用户）后面有多个Ceph Dashboard副本，您可能希望禁用重定向功能，以避免将内部（不可解析的）URL发布给前端客户端。使用以下命令可以让备用副本的Dashboard返回HTTP错误（默认为500），而不是重定向到活动副本：</li></ul><h3 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h3><p>完成</p><h3 id="nfs"><a href="#nfs" class="headerlink" title="nfs"></a>nfs</h3><p>完成</p><h3 id="prometheus"><a href="#prometheus" class="headerlink" title="prometheus"></a>prometheus</h3><p>提供 Prometheus exporter 以从 ceph-mgr 中的收集点传递 Ceph 性能计数器。</p><p>Ceph-mgr 从所有 MgrClient 进程（例如 mons 和 OSD）接收 MMgrReport messages，其中包含性能计数器架构数据和实际计数器数据，并保留最后 N 个样本的循环缓冲区。该模块创建一个 HTTP 端点（与所有 Prometheus 导出器一样），并在轮询时抓取每个计数器的最新样本（或在 Prometheus 术语中“scraped ”）。</p><p>HTTP 路径和查询参数被忽略；所有报告实体的所有现有计数器均以文本说明格式返回。</p><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph mgr module enable prometheus</span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>需要重启 才能应用prometheus manager 模块的参数配置修改</p><p><code>mgr/prometheus/address</code> ：模块侦听 HTTP 请求的 IPv4 或 IPv6 地址</p><p><code>server_port</code> ：模块侦听 HTTP 请求的端口</p><p><code>mgr/prometheus/cache</code></p><h3 id="restful"><a href="#restful" class="headerlink" title="restful"></a>restful</h3><p>RESTful 模块通过 SSL 安全连接提供对集群状态的 REST API 访问</p><h4 id="启用-1"><a href="#启用-1" class="headerlink" title="启用"></a>启用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph mgr module enable restful</span><br></pre></td></tr></table></figure><p>在 API 端点可用之前，您还需要在下面配置 SSL 证书。默认情况下，模块将接受主机上所有 IPv4 和 IPv6 地址上端口 8003 上的 HTTPS 请求。</p><h4 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h4><p>所有与 Restful 的连接均通过 SSL 进行保护。您可以使用以下命令生成自签名证书：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph restful create-self-signed-cert</span><br></pre></td></tr></table></figure><p>请注意，使用自签名证书，大多数客户端将需要一个标志来允许连接和/或抑制警告消息。例如，如果 ceph-mgr 守护进程位于同一主机上：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -k https://localhost:8003/</span><br></pre></td></tr></table></figure><p>为了正确保护部署，应使用由组织的证书颁发机构签名的证书。例如，可以使用类似于以下的命令生成密钥对：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -nodes -x509 \</span><br><span class="line">  -subj &quot;/O=IT/CN=ceph-mgr-restful&quot; \</span><br><span class="line">  -days 3650 -keyout restful.key -out restful.crt -extensions v3_ca</span><br></pre></td></tr></table></figure><p>然后，restful.crt 应由您组织的 CA（证书颁发机构）签名。完成后，您可以使用以下命令进行设置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph config-key set mgr/restful/$name/crt -i restful.crt</span><br><span class="line">ceph config-key set mgr/restful/$name/key -i restful.key</span><br></pre></td></tr></table></figure><p>其中 <code>$name</code> 是 ceph-mgr 实例的名称（通常是主机名）。如果所有管理器实例要共享相同的证书，您可以省略 <code>$name</code> 部分：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph config-key set mgr/restful/crt -i restful.crt</span><br><span class="line">ceph config-key set mgr/restful/key -i restful.key</span><br></pre></td></tr></table></figure><h4 id="配置IP和端口"><a href="#配置IP和端口" class="headerlink" title="配置IP和端口"></a>配置IP和端口</h4><p>与任何其他 RESTful API 端点一样，Restful 绑定到 IP 和端口。默认情况下，当前活动的 ceph-mgr 守护进程将绑定到端口 8003 以及主机上任何可用的 IPv4 或 IPv6 地址。</p><p>由于每个 ceph-mgr 托管自己的 Restful 实例，因此可能还需要单独配置它们。 IP 和端口可以通过配置密钥工具进行更改：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr mgr/restful/$name/server_addr $IP</span><br><span class="line">ceph config set mgr mgr/restful/$name/server_port $PORT</span><br></pre></td></tr></table></figure><p>其中 <code>$name</code> 是 ceph-mgr 守护进程的 ID（通常是主机名）。</p><p>这些设置也可以在集群范围内配置，而不是特定于管理器。例如，：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph config set mgr mgr/restful/server_addr $IP</span><br><span class="line">ceph config set mgr mgr/restful/server_port $PORT</span><br></pre></td></tr></table></figure><p>如果未配置端口，restful将绑定到端口8003。如果未配置地址，restful将绑定到::，它对应于所有可用的IPv4和IPv6地址。</p><h4 id="创建-API-用户"><a href="#创建-API-用户" class="headerlink" title="创建 API 用户"></a>创建 API 用户</h4><p>要创建 API 用户，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph restful create-key &lt;username&gt;</span><br></pre></td></tr></table></figure><p>将 &lt;用户名&gt; 替换为所需的用户名。例如，创建一个名为 api 的用户：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph restful create-key api</span><br><span class="line">	52dffd92-a103-4a10-bfce-5b60f48f764e</span><br></pre></td></tr></table></figure><p>从 ceph restful create-key api 生成的 UUID 充当用户的密钥。</p><p>要列出您的所有 API 密钥，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ceph restful list-keys</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ceph restful list-keys 命令将以 JSON 格式输出：</span></span><br><span class="line">&#123;</span><br><span class="line">      &quot;api&quot;: &quot;52dffd92-a103-4a10-bfce-5b60f48f764e&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以使用curl 来使用API 测试您的用户。这是一个例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -k https://api:52dffd92-a103-4a10-bfce-5b60f48f764e@&lt;ceph-mgr&gt;:&lt;port&gt;/server</span><br></pre></td></tr></table></figure><p>在上面的例子中，我们使用 GET 从服务器端点获取信息。</p><h4 id="负载均衡器"><a href="#负载均衡器" class="headerlink" title="负载均衡器"></a>负载均衡器</h4><p>请注意，restful 只会在当时处于活动状态的 manager 上启动。查询 Ceph 集群状态以查看哪个 manager 处于活动状态（例如 ceph mgr dump）。</p><p>为了使 API 通过一致的 URL 可用，无论哪个 manager 守护进程当前处于活动状态，您可能需要设置一个负载均衡器前端，以将流量定向到任何可用的管理器端点。</p><h4 id="支持的访问方式"><a href="#支持的访问方式" class="headerlink" title="支持的访问方式"></a>支持的访问方式</h4><p>您可以 navigate to /doc 端点以获取可用端点以及为每个端点实现的 HTTP 方法的完整列表。</p><p>例如，如果要使用 /osd/<id>端点的 PATCH 方法来设置 OSD id 1 的状态，可以使用以下curl 命令</id></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -En &#x27;&#123;&quot;up&quot;: true&#125;&#x27; | curl --request PATCH --data @- --silent --insecure --user &lt;user&gt; &#x27;https://&lt;ceph-mgr&gt;:&lt;port&gt;/osd/1&#x27;</span><br></pre></td></tr></table></figure><p>或者你可以使用 python 来执行此操作：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt; import requests</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt; result = requests.patch(</span></span><br><span class="line">       &#x27;https://&lt;ceph-mgr&gt;:&lt;port&gt;/osd/1&#x27;,</span><br><span class="line">       json=&#123;&quot;up&quot;: True&#125;,</span><br><span class="line">       auth=(&quot;&lt;user&gt;&quot;, &quot;&lt;password&gt;&quot;)</span><br><span class="line">   )</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt; <span class="built_in">print</span> result.json()</span></span><br></pre></td></tr></table></figure><p>Restful 模块中实现的一些其他端点包括</p><ul><li><code>/config/cluster</code>: <strong>GET</strong></li><li><code>/config/osd</code>: <strong>GET</strong>, <strong>PATCH</strong></li><li><code>/crush/rule</code>: <strong>GET</strong></li><li><code>/mon</code>: <strong>GET</strong></li><li><code>/osd</code>: <strong>GET</strong></li><li><code>/pool</code>: <strong>GET</strong>, <strong>POST</strong></li><li><code>/pool/&lt;arg&gt;</code>: <strong>DELETE</strong>, <strong>GET</strong>, <strong>PATCH</strong></li><li><code>/request</code>: <strong>DELETE</strong>, <strong>GET</strong>, <strong>POST</strong></li><li><code>/request/&lt;arg&gt;</code>: <strong>DELETE</strong>, <strong>GET</strong></li><li><code>/server</code>: <strong>GET</strong></li></ul><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/latest/mgr/restful/#the-request-endpoint">THE <code>/REQUEST</code> ENDPOINT</a></p><h2 id="disabled-module"><a href="#disabled-module" class="headerlink" title="disabled module"></a>disabled module</h2><h3 id="localpool"><a href="#localpool" class="headerlink" title="localpool"></a>localpool</h3><p><em>localpool</em> 模块为集群 CRUSH map 的某个子树创建池（故障域级的池）。如，默认情况为集群中的不同 rack 创建一个池</p><p><img src="/posts/3924783311/image-20240529162259428.png" alt="image-20240529162259428"></p><p><code>localpool</code> 的使用通常与Ceph的本地存储功能（如 BlueStore）相关，它允许将存储池配置为使用特定节点的本地磁盘，而不是分布在整个集群中的磁盘。可以在需要优化性能或管理不同类型的数据时使用。</p><p>一般情况，管理员不使用 localpool 模块自动创建池，且仅与池的创建有关，并不影响集群性能，故裁剪</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------<i class="fa fa-hand-peace-o"></i>本文结束-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者 </strong>AmosTian</li><li class="post-copyright-link"><strong>本文链接 </strong><a href="https://amostian.github.io/posts/3924783311/" title="Ceph参数注解-mgr">https://amostian.github.io/posts/3924783311/</a></li><li class="post-copyright-license"><strong>版权声明 </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E5%AD%98%E5%82%A8/" rel="tag"><i class="fa fa-tags"></i> 存储</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" rel="tag"><i class="fa fa-tags"></i> 分布式存储</a> <a href="/tags/Ceph/" rel="tag"><i class="fa fa-tags"></i> Ceph</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/2796979247/" rel="prev" title="Ceph参数注解-OSD"><i class="fa fa-chevron-left"></i> Ceph参数注解-OSD</a></div><div class="post-nav-item"><a href="/posts/2744181762/" rel="next" title="Ceph参数注解-MON">Ceph参数注解-MON <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#install-amp-configuration"><span class="nav-text">install&amp;configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#enable-module"><span class="nav-text">enable module</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#log-level-54-%E4%B8%AA"><span class="nav-text">log_level-54 个</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#balancer"><span class="nav-text">balancer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%B9%B3%E8%A1%A1"><span class="nav-text">自动平衡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B3%E8%A1%A1%E8%AE%A1%E5%88%92"><span class="nav-text">平衡计划</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B3%E8%A1%A1%E7%AE%97%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="nav-text">平衡算法模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E7%9D%A3%E4%BC%98%E5%8C%96"><span class="nav-text">监督优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="nav-text">参数配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crash"><span class="nav-text">crash</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8crash%E6%A8%A1%E5%9D%97"><span class="nav-text">启动crash模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E6%94%B6%E9%9B%86"><span class="nav-text">自动收集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4"><span class="nav-text">指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-text">参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#devicehealth"><span class="nav-text">devicehealth</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87%E8%B7%9F%E8%B8%AA"><span class="nav-text">设备跟踪</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%86%E5%88%AB%E7%89%A9%E7%90%86%E8%AE%BE%E5%A4%87"><span class="nav-text">识别物理设备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E8%AE%BE%E5%A4%87%E7%9B%91%E6%8E%A7"><span class="nav-text">启用设备监控</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96%E6%8C%87%E6%A0%87"><span class="nav-text">抓取指标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%85%E9%9A%9C%E9%A2%84%E6%B5%8B"><span class="nav-text">故障预测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%81%A5%E5%BA%B7%E6%8A%A5%E8%AD%A6"><span class="nav-text">健康报警</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%BF%81%E7%A7%BB"><span class="nav-text">自动迁移</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orchestrator"><span class="nav-text">orchestrator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pg-autoscaler"><span class="nav-text">pg_autoscaler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#progress"><span class="nav-text">progress</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8"><span class="nav-text">启用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4-1"><span class="nav-text">指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PG%E6%81%A2%E5%A4%8D%E4%BA%8B%E4%BB%B6"><span class="nav-text">PG恢复事件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rbd-support"><span class="nav-text">rbd_support</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#status"><span class="nav-text">status</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#telemetry"><span class="nav-text">telemetry</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E9%81%93"><span class="nav-text">通道</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E9%81%A5%E6%B5%8B"><span class="nav-text">启用遥测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%A5%E5%91%8A%E6%A0%B7%E6%9C%AC"><span class="nav-text">报告样本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%89%E9%80%9A%E9%81%93%E7%9A%84%E6%8A%A5%E5%91%8A%E7%A4%BA%E4%BE%8B"><span class="nav-text">按通道的报告示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#collection"><span class="nav-text">collection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#INTERVAL"><span class="nav-text">INTERVAL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#STATUS"><span class="nav-text">STATUS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E4%BB%A3%E7%90%86%E5%8F%91%E9%80%81%E9%81%A5%E6%B5%8B%E6%95%B0%E6%8D%AE"><span class="nav-text">通过代理发送遥测数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#agent"><span class="nav-text">agent</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#volumes"><span class="nav-text">volumes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cephadm"><span class="nav-text">cephadm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dashboard"><span class="nav-text">dashboard</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iostat"><span class="nav-text">iostat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nfs"><span class="nav-text">nfs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prometheus"><span class="nav-text">prometheus</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8"><span class="nav-text">启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-text">配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#restful"><span class="nav-text">restful</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8-1"><span class="nav-text">启用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E5%85%A8"><span class="nav-text">安全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEIP%E5%92%8C%E7%AB%AF%E5%8F%A3"><span class="nav-text">配置IP和端口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-API-%E7%94%A8%E6%88%B7"><span class="nav-text">创建 API 用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8"><span class="nav-text">负载均衡器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">支持的访问方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#disabled-module"><span class="nav-text">disabled module</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#localpool"><span class="nav-text">localpool</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="AmosTian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">AmosTian</p><div class="site-description" itemprop="description">知道的越多，不知道的越多</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">236</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">68</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">83</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/AmosTian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AmosTian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://blog.csdn.net/qq_40479037?type=blog" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_40479037?type&#x3D;blog" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a> </span><span class="links-of-author-item"><a href="mailto:17636679561@163.com" title="E-Mail → mailto:17636679561@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("01/27/2022 15:13:14"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-grav"></i> </span><span class="author" itemprop="copyrightHolder">AmosTian</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">站点总字数 </span><span title="站点总字数">1252.1k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">50:25</span></div></div></footer></div><script color="0,0,0" opacity="0.5" zindex="-1" count="150" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'neutral',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}</script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script><script async src="/js/cursor/fireworks.js"></script><script src="/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,document.body.addEventListener("input",POWERMODE)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"live2d-widget-model-hijiki"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>