<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/favicon.png" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa:300,300italic,400,400italic,700,700italic|Ma Shan Zheng:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"amostian.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="IP协议族是网络层是主要实现，主要完成数据报的转发与路由的计算   网络层提供主机之间的逻辑通信  尽最大努力交付  不保证IP数据报无差错，不重复  不保证数据报按顺序到达目的主机  不故意丢弃数据报 丢弃数据报的情况：路由器检测出首部检验和有错；网络拥塞"><meta property="og:type" content="article"><meta property="og:title" content="4.网络层"><meta property="og:url" content="https://amostian.github.io/posts/1989371375/index.html"><meta property="og:site_name" content="AmosTian"><meta property="og:description" content="IP协议族是网络层是主要实现，主要完成数据报的转发与路由的计算   网络层提供主机之间的逻辑通信  尽最大努力交付  不保证IP数据报无差错，不重复  不保证数据报按顺序到达目的主机  不故意丢弃数据报 丢弃数据报的情况：路由器检测出首部检验和有错；网络拥塞"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220308120003844.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220308121043139.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220308130612796.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220308131906747.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220308093535064.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220308152728825.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220308171512594.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/IPv4%E5%88%86%E7%BB%84%E6%A0%BC%E5%BC%8F.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220308173312387.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220309150545465.png"><meta property="og:image" content="https://amostian.github.io/posts/1989371375/image-20220309122521877.png"><meta property="article:published_time" content="2022-03-08T00:30:55.000Z"><meta property="article:modified_time" content="2022-03-09T06:47:17.000Z"><meta property="article:author" content="AmosTian"><meta property="article:tag" content="计算机基础"><meta property="article:tag" content="计算机网络"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://amostian.github.io/posts/1989371375/image-20220308120003844.png"><link rel="canonical" href="https://amostian.github.io/posts/1989371375/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>4.网络层 | AmosTian</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">AmosTian</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">65</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">82</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">216</span></a></li><li class="menu-item menu-item-essay"><a href="/categories/%E9%9A%8F%E7%AC%94/" rel="section"><i class="fa fa-fw fa-pied-piper"></i>随笔</a></li><li class="menu-item menu-item-dynamic-resume"><a href="/dynamic-resume/" rel="section"><i class="fa fa-fw fa-cog"></i>动态简历</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/AmosTian" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://amostian.github.io/posts/1989371375/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="AmosTian"><meta itemprop="description" content="知道的越多，不知道的越多"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="AmosTian"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">4.网络层</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间 2022-03-08 08:30:55" itemprop="dateCreated datePublished" datetime="2022-03-08T08:30:55+08:00">2022-03-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间 2022-03-09 14:47:17" itemprop="dateModified" datetime="2022-03-09T14:47:17+08:00">2022-03-09</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">计算机基础</span></a> </span>> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数 </span><span title="本文字数">7.5k字 </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>8 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>IP协议族是网络层是主要实现，主要完成数据报的转发与路由的计算</p><p><strong>网络层提供主机之间的逻辑通信</strong></p></blockquote><p>尽最大努力交付</p><ul><li><p>不保证IP数据报无差错，不重复</p></li><li><p>不保证数据报按顺序到达目的主机</p></li><li><p>不故意丢弃数据报</p><p>丢弃数据报的情况：路由器检测出首部检验和有错；网络拥塞</p></li></ul><span id="more"></span><h1 id="4-网络层"><a href="#4-网络层" class="headerlink" title="4. 网络层"></a>4. 网络层</h1><h2 id="4-1-功能"><a href="#4-1-功能" class="headerlink" title="4.1 功能"></a>4.1 功能</h2><h3 id="4-1-1-异构网络互联"><a href="#4-1-1-异构网络互联" class="headerlink" title="4.1.1 异构网络互联"></a>4.1.1 异构网络互联</h3><blockquote><p>将两个及以上的计算机网络，用一种或多种通信设备(中间设备)相互连接起来</p></blockquote><ul><li>物理层中继系统：中继器、集线器</li><li>数据链路层中继系统：网桥、交换机</li><li>网络层中继系统：路由器</li><li>网络层以上中继系统：网关</li></ul><h3 id="4-1-2-路由与转发"><a href="#4-1-2-路由与转发" class="headerlink" title="4.1.2 路由与转发"></a>4.1.2 路由与转发</h3><h4 id="a-分组转发"><a href="#a-分组转发" class="headerlink" title="a. 分组转发"></a>a. 分组转发</h4><p><strong>仅涉及一个路由器</strong></p><blockquote><p>路由器根据转发表将用户的IP数据报从合适的端口转发出去</p></blockquote><h4 id="b-路由选择"><a href="#b-路由选择" class="headerlink" title="b. 路由选择"></a>b. 路由选择</h4><p><strong>涉及很多路由器</strong></p><blockquote><p>定期和相邻路由器交换路由信息而不断更新和维护路由表</p></blockquote><p>具体做法：根据从各相邻路由器得到的关于网络拓扑变化情况，使用特定的路由选择协议，动态地改变所选择的路由，进而构造出整个路由表</p><h3 id="4-1-3-复用和分用"><a href="#4-1-3-复用和分用" class="headerlink" title="4.1.3 复用和分用"></a>4.1.3 复用和分用</h3><p>复用：发送方不同协议的数据报都可以封装成IP数据报发送出去</p><p>分用：接收方的网络层剥去首部后把数据交付给相应的协议</p><h3 id="4-1-4-拥塞控制"><a href="#4-1-4-拥塞控制" class="headerlink" title="4.1.4 拥塞控制"></a>4.1.4 拥塞控制</h3><h4 id="a-拥塞"><a href="#a-拥塞" class="headerlink" title="a. 拥塞"></a>a. 拥塞</h4><blockquote><p><strong>全局性的问题</strong></p><p>网络中分组过多，每个结点都很忙</p><p>来不及接受分组，分组被大量丢弃</p></blockquote><p>判断将进入拥塞状态的方法</p><ul><li>轻度拥塞：网络负载增加，网络吞吐量增加不多</li><li>拥塞状态：随着网络负载的增大，网络吞吐量下降</li><li>死锁状态：网络负载继续增大，网络吞吐量下降到0</li></ul><h4 id="b-拥塞控制"><a href="#b-拥塞控制" class="headerlink" title="b. 拥塞控制"></a>b. 拥塞控制</h4><ul><li>开环控制：设计网络前考虑周到，这是一种静态的预防方法</li><li>闭环控制：基于反馈环路，一种动态的方法</li></ul><h2 id="4-2-物理设备"><a href="#4-2-物理设备" class="headerlink" title="4.2 物理设备"></a>4.2 物理设备</h2><p>Router：多输入/输出端口专用计算机</p><h3 id="4-2-1-功能"><a href="#4-2-1-功能" class="headerlink" title="4.2.1 功能"></a>4.2.1 功能</h3><ul><li>连接不同网络</li><li>完成路由与转发</li><li>隔离广播域</li></ul><h3 id="4-2-2-数据的交付方式"><a href="#4-2-2-数据的交付方式" class="headerlink" title="4.2.2 数据的交付方式"></a>4.2.2 数据的交付方式</h3><h4 id="a-直接交付"><a href="#a-直接交付" class="headerlink" title="a. 直接交付"></a>a. 直接交付</h4><p>在该路由器某一端口的<strong>同一局域网</strong>中</p><p>将分组中的目的IP与该路由器的各端口子网掩码相与，若是匹配，则查找ARP(IP与物理MAC地址映射表)缓存表，找到IP地址对应的MAC地址，直接交付</p><h4 id="b-间接交付"><a href="#b-间接交付" class="headerlink" title="b. 间接交付"></a>b. 间接交付</h4><p>路由器按照转发表(路由表)指出的路由器，将数据报发给下一跳路由器</p><div style="page-break-after:always"></div><h3 id="4-2-3-结构"><a href="#4-2-3-结构" class="headerlink" title="4.2.3 结构"></a>4.2.3 结构</h3><p><img src="/posts/1989371375/image-20220308120003844.png" alt></p><h4 id="a-路由表与转发表"><a href="#a-路由表与转发表" class="headerlink" title="a. 路由表与转发表"></a>a. 路由表与转发表</h4><p><img src="/posts/1989371375/image-20220308121043139.png" alt></p><h4 id="b-路由选择处理机"><a href="#b-路由选择处理机" class="headerlink" title="b. 路由选择处理机"></a>b. 路由选择处理机</h4><ul><li><p>根据路由协议构造路由表</p></li><li><p>定期和其他相邻路由器交换路由表，进而动态更新和维护路由表</p></li></ul><h4 id="c-分组转发部分"><a href="#c-分组转发部分" class="headerlink" title="c. 分组转发部分"></a>c. 分组转发部分</h4><h5 id="交换结构"><a href="#交换结构" class="headerlink" title="交换结构"></a>交换结构</h5><blockquote><p>根据转发表对分组进行处理，将从输入端口进入的分组从一个合适的端口转发出去</p></blockquote><ul><li>若是 <code>RIP/OSPF</code> 分组，传送给路由选择处理机</li><li>若是数据分组，查找转发表输出</li></ul><p>三种交换方式</p><ul><li>通过存储器交换</li><li>通过总线交换</li><li>通过互联网交换</li></ul><h5 id="输入输出端口"><a href="#输入输出端口" class="headerlink" title="输入输出端口"></a>输入输出端口</h5><p>路由器实现了网络模型的下三层：物理层、链路层和网络层</p><p>路由器可以对这三层协议的控制信息进行识别、分析和转换(对帧、报文可以拆开和包装)</p><ul><li>物理层：接收bit流</li><li>链路层：根据链路层协议将bit流转换为帧</li><li>网络层：分组排队，查表和转发</li></ul><p><img src="/posts/1989371375/image-20220308130612796.png" alt></p><p>从传输介质接收到一组电平，物理层处理后，变为一连串bit流</p><p>比特流经过链路层，识别到帧定界符后，将帧拆分成网络层数据报</p><p>经过网络层，根据目的地址，查找转发表，选择合适的输出端口，通过交换结构，逐层封装后通过输出端口输出</p><p><img src="/posts/1989371375/image-20220308131906747.png" alt></p><h5 id="分组转发过程"><a href="#分组转发过程" class="headerlink" title="分组转发过程"></a>分组转发过程</h5><ol><li>从数据报中提取目的主机的IP地址D，得出其网络地址号N</li><li>若网络N与路由器直连，则将数据报直接交付目的主机D，称为直接交付；否则间接交付</li><li>若路由表中有目的地址为D的特定主机路由，则把数据传送给路由表所指明的下一跳路由器</li><li>若路由表中有到达网络N的路由，则把数据报传送给路由表指明的下一跳路由器，否则执行下一步</li><li>若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由，否则报告转发分组出错</li></ol><h2 id="4-3-网络编址"><a href="#4-3-网络编址" class="headerlink" title="4.3 网络编址"></a>4.3 网络编址</h2><h3 id="4-3-1-干什么的"><a href="#4-3-1-干什么的" class="headerlink" title="4.3.1 干什么的"></a>4.3.1 干什么的</h3><blockquote><p>一个IP地址标记一台主机(或路由器)和一条链路的接口</p></blockquote><p>格式： <code>网络号.主机号:端口号</code></p><p>在同一局域网上的主机或路由器的IP地址网络号相同，主机号一定不同</p><ul><li>用转发器或网桥连接的若干LAN仍是同一个网络（同一个广播域）</li></ul><p>一台主机MAC地址唯一，但当其连接到两个网络，必须有两个相应的IP地址，这两个IP地址是该主机在不同网络中的标识，网络号一定不相同</p><ul><li>一台路由器必须的输入和输出端口必须各有一个IP地址</li></ul><h3 id="4-3-2-IPv4特殊的IP地址"><a href="#4-3-2-IPv4特殊的IP地址" class="headerlink" title="4.3.2 IPv4特殊的IP地址"></a>4.3.2 IPv4特殊的IP地址</h3><p>网络号全0：表示本网络</p><p>主机号全0：表示本机或本网络</p><p>主机号全1：本网络广播地址</p><p>有网络号：能找到具体的网络</p><p>有主机号：能找到具体的主机</p><div class="table-container"><table><thead><tr><th>网络号</th><th>主机号</th><th>可作源地址?</th><th>可作目的地址?</th><th>用途</th></tr></thead><tbody><tr><td>全0</td><td>特定值</td><td>√</td><td>×</td><td>用于本网内通信，表示本网内的某个主机</td></tr><tr><td>全0</td><td>全0</td><td>√</td><td>×</td><td>表示本网络上的本机<br>不知道自己IP的情况下，用作填充源地址<br>是路由表中的默认路由。<strong>作为目的地址，其子网掩码为0.0.0.0？</strong></td></tr><tr><td>特定值</td><td>全0</td><td>×</td><td>×</td><td>表示本网络，用于表示一个局域网</td></tr><tr><td>特定值</td><td>全1</td><td>×</td><td>√</td><td>广播地址，可对指定网络的所有主机广播</td></tr><tr><td>全1</td><td>全1</td><td>×</td><td>√</td><td>广播地址，只能对本网的所有主机广播</td></tr><tr><td></td><td>127.0.0.0</td><td>√</td><td>√</td><td>环回地址：表示主机本身，用于本地软件测试，不出现在任何网络中</td></tr></tbody></table></div><p>问题：127开头的全部都是环回地址吗，还是只有127.0.0.0</p><div style="page-break-after:always"></div><h3 id="4-3-3-一般的地址分类及个数"><a href="#4-3-3-一般的地址分类及个数" class="headerlink" title="4.3.3 一般的地址分类及个数"></a>4.3.3 一般的地址分类及个数</h3><p><img src="/posts/1989371375/image-20220308093535064.png" alt></p><div class="table-container"><table><thead><tr><th>网络类别(字节-前缀)</th><th>最大网络数</th><th>第一个网络号</th><th>最后一个网络号</th><th>每个网络中最大的主机数</th></tr></thead><tbody><tr><td>A(1B-0)</td><td>$2^{8-1}-2$</td><td>1</td><td>126</td><td>$2^{24}-2$</td></tr><tr><td>B(2B-10)</td><td>$2^{16-2}-1=2^{14}-1$</td><td>128.1</td><td>128.255</td><td>$2^{16}-2$</td></tr><tr><td>C(3B-110)</td><td>$2^{24-3}-1=2^{21}-1$</td><td>192.0.1</td><td>223.255.255</td><td>$2^8-2$</td></tr></tbody></table></div><p>A 类网络号 <strong>-2</strong>：<strong>127</strong>.x.x.x作为本地环回地址，<strong>0</strong>.x.x.x 表示网络号为 <strong>0</strong> 的网络</p><p>BC类网络号 <strong>-1</strong>：<strong>128.0</strong>.x.x表示网络号为 <strong>128.0</strong> 的网络</p><p>主机号 <strong>-2</strong>：主机号全0：表示本网络，主机号全1表示广播地址</p><h3 id="4-3-4-子网划分"><a href="#4-3-4-子网划分" class="headerlink" title="4.3.4 子网划分"></a>4.3.4 子网划分</h3><blockquote><p><strong>网络数量 由少变多</strong></p></blockquote><h4 id="a-思路"><a href="#a-思路" class="headerlink" title="a. 思路"></a>a. 思路</h4><blockquote><p>从主机号借用若干比特作为子网号，<code>IP地址=&#123;&lt;网络号&gt;,&lt;子网号&gt;,&lt;主机号&gt;&#125;</code></p><p>从一个IP地址本身无法判断是否进行了子网划分</p></blockquote><p>如：一个单位按部门划分了子网，若有一个发往该单位的一台主机的数据，则先根据目的网络号找到该单位路由器，单位路由器按 目的网络号+子网号找到 目的主机所在的子网，在子网中找到目的主机</p><h4 id="b-子网掩码"><a href="#b-子网掩码" class="headerlink" title="b. 子网掩码"></a>b. 子网掩码</h4><blockquote><p>若所在网络划分了子网，则为一台主机设置IP地址外还需要设置子网掩码</p><p><code>子网掩码:网络号全1，借的主机位全1</code></p></blockquote><p>子网掩码告诉主机或路由器当前网络进行了子网划分，</p><script type="math/tex;mode=display">子网号=IP地址\&(按位与)子网掩码=该IP地址所在的网段</script><ul><li>同属于一个子网的所有主机及路由器的端口必须有相同的子网号与子网掩码</li></ul><blockquote><p>使用子网掩码时，路由器的分组转发算法</p></blockquote><ol><li><p>从收到的分组首部提取目的IP地址，记为D</p></li><li><p>先判断是否为直接交付。</p><p>对与路由器直接相连的网络逐个检查：用各网络的子网掩码和D按位与，得到子网号N看是否与该掩码的子网号匹配。</p><p>若匹配则将分组直接交付，完成转发；否则执行下一步</p></li><li><p>若路由表中的目的地址D与特定的主机路由匹配，则将分组转发给路由表中指明的下一跳路由器，否则执行下一步</p></li><li><p>对路由表中的每一行($目的网络子网号\mid 子网掩码\mid 下一跳地址$)中的子网掩码与D按位与，得到结果N。</p><p>若N与该行的目的网络地址匹配，则转发给对应的下一跳地址对应的路由器</p><p>若否则执行下一步</p></li><li><p>若路由表中有默认路由，则将分组转发给默认路由指明的路由器，否则报告分组转发出错</p></li></ol><h3 id="4-3-5-无分类编址CIDR"><a href="#4-3-5-无分类编址CIDR" class="headerlink" title="4.3.5 无分类编址CIDR"></a>4.3.5 无分类编址CIDR</h3><blockquote><p><strong>网络数量 由多变少</strong></p></blockquote><h4 id="a-思路-1"><a href="#a-思路-1" class="headerlink" title="a. 思路"></a>a. 思路</h4><blockquote><p>用网络前缀代替网络号与子网号</p><p>定义为：<code>&#123;&lt;网络前缀&gt;,&lt;主机号&gt;&#125;=&#123;网络号+子网号&#125;</code></p></blockquote><p>表示方法：<code>IP地址/网络前缀位数</code></p><p>构成超网(路由聚合)：一个路由器中，走一个接口的网络地址聚合成一个 <code>CIDR地址块</code> ，一个CIDR地址块可以表示很多地址</p><h4 id="b-最长前缀匹配"><a href="#b-最长前缀匹配" class="headerlink" title="b. 最长前缀匹配"></a>b. 最长前缀匹配</h4><p>从匹配结果中选择具有最长网络前缀的路由，得到的路由越具体</p><h4 id="c-CIDR路由表"><a href="#c-CIDR路由表" class="headerlink" title="c. CIDR路由表"></a>c. CIDR路由表</h4><p>线索二叉树，自上而下按层次进行查找</p><h3 id="4-3-6-与IP地址相关的协议"><a href="#4-3-6-与IP地址相关的协议" class="headerlink" title="4.3.6 与IP地址相关的协议"></a>4.3.6 与IP地址相关的协议</h3><h4 id="a-ARP-地址解析协议"><a href="#a-ARP-地址解析协议" class="headerlink" title="a. ARP(地址解析协议)"></a>a. ARP(地址解析协议)</h4><p><strong>网络层协议：能看见IP地址</strong></p><p><strong>运行于主机</strong></p><h5 id="干啥的"><a href="#干啥的" class="headerlink" title="干啥的"></a>干啥的</h5><blockquote><p>ARP动态维护ARP映射表：每台主机都设有一个ARP高速缓存，存放本局域网上各主机到路由器的IP地址到MAC地址的映射</p></blockquote><h5 id="怎么干"><a href="#怎么干" class="headerlink" title="怎么干"></a>怎么干</h5><p>本局域网中的主机A收到一个IP分组后</p><p>先查找本机的ARP映射表，看表项中是否有与目的地址相同的IP地址</p><ul><li>如果有，将此IP地址对应的硬件地址写入MAC帧，作为目的MAC地址</li><li>如果没有<ol><li><strong>广播ARP请求帧(目的MAC地址为FF-FF-FF-FF-FF-FF的帧)</strong>。</li><li>到达IP地址指定的主机B后，向主机A发送ARP相应分组，将主机B与MAC地址的映射返回。</li><li>主机A收到此响应后，更新MAC映射表。按查询到的硬件地址填充MAC帧的目的地址</li></ol></li></ul><hr><p>使用ARP，本网络找目的主机的MAC地址；不同网络，找网关路由器的MAC地址</p><hr><p>MAC帧的传输过程中，每一跳都要更新源MAC地址与目的MAC地址</p><ul><li><strong>经过路由器才算一跳</strong></li></ul><h4 id="b-NAT-网络地址转换"><a href="#b-NAT-网络地址转换" class="headerlink" title="b. NAT(网络地址转换)"></a>b. NAT(网络地址转换)</h4><p><strong>传输层协议：能看见端口号</strong></p><p><strong>运行于边际路由器</strong></p><h5 id="干啥的-1"><a href="#干啥的-1" class="headerlink" title="干啥的"></a>干啥的</h5><blockquote><p>专用网内部的一些主机已经分配到了私网IP，若想和互联网上的主机通信，需要通过NAT路由器，将私网IP转换为公网IP，才能和互联网上的主机通信</p></blockquote><ul><li>NAT路由器：装有NAT软件，且至少有一个公网IP</li></ul><h5 id="怎么干-1"><a href="#怎么干-1" class="headerlink" title="怎么干"></a>怎么干</h5><p>路由器对目的地址是私网IP的，一律不转发</p><p><strong>通过NAT路由器时，需要将地址字段的私网IP替换为公网IP</strong></p><p><code>私网IP:端口号-&gt;公网IP:端口号</code></p><h5 id="约定的私网IP"><a href="#约定的私网IP" class="headerlink" title="约定的私网IP"></a>约定的私网IP</h5><p><img src="/posts/1989371375/image-20220308152728825.png" alt></p><h4 id="c-DHCP-动态主机配置协议"><a href="#c-DHCP-动态主机配置协议" class="headerlink" title="c. DHCP(动态主机配置协议)"></a>c. DHCP(动态主机配置协议)</h4><p><strong>应用层协议</strong>：C/S模式</p><p><strong>基于UDP协议</strong>：TCP需要建立连接，前提是知道IP地址，所以无法建立单播</p><p><strong>运行于主机</strong></p><h5 id="干啥的-2"><a href="#干啥的-2" class="headerlink" title="干啥的"></a>干啥的</h5><blockquote><p>给主机动态地分配IP地址，DHCP分配给DHCP客户的IP地址是临时的，称为租用期</p><p>由DHCP服务器决定租用期的时长</p></blockquote><h5 id="怎么做"><a href="#怎么做" class="headerlink" title="怎么做"></a>怎么做</h5><p>需要IP地址的主机称为客户机，DHCP服务器称为服务器</p><ol><li><p>DHCP客户机启动时就广播 <code>DHCP发现</code> 消息：为了找到网络中的DHCP服务器获得一个IP地址</p><p>源地址：0.0.0.0</p><p>目的地址：255.255.255.255</p></li><li><p>DHCP服务器收到 <code>DHCP发现</code> 消息后，向网络中广播 <code>DHCP提供</code> 消息</p><p>包含提供给客户机的IP地址和相关配置信息</p><ul><li>IP地址、默认网关、子网掩码、DNS名称及其IP地址</li></ul></li><li><p>DHCP客户机收到 <code>DHCP提供</code> 消息后，若接受配置信息，则广播 <code>DHCP请求</code> 消息向DHCP服务器请求分配IP地址</p></li><li><p>DHCP服务器收到 <code>DHCP请求</code> 消息后，将IP地址分配给DHCP客户机</p></li></ol><h5 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h5><ol><li>在DHCP获取IP地址前，通过广播方式传输消息，所以目的地址都是 <code>255.255.255.255</code></li><li>DHCP允许网络上存在多态DHCP服务器，DHCP客户机会选用最先到达的 <code>DHCP提供</code> 消息中提供的IP地址</li></ol><h3 id="4-3-7-移动IP"><a href="#4-3-7-移动IP" class="headerlink" title="4.3.7 移动IP"></a>4.3.7 移动IP</h3><blockquote><p>手机卡与基站的关系</p></blockquote><h4 id="a-概念"><a href="#a-概念" class="headerlink" title="a. 概念"></a>a. 概念</h4><h5 id="移动结点"><a href="#移动结点" class="headerlink" title="移动结点"></a>移动结点</h5><blockquote><p>具有唯一<strong>永久的本地IP地址</strong>的结点</p></blockquote><ul><li>从外网移动回本地时，辅地址改变或者撤销，而<strong>主地址保持不变</strong></li></ul><h5 id="归属代理-本地代理"><a href="#归属代理-本地代理" class="headerlink" title="归属代理(本地代理)"></a>归属代理(本地代理)</h5><blockquote><p>在归属网络中代表移动结点执行管理功能的实体</p></blockquote><ul><li>在本地网络链路上，每个移动结点必须有一个本地代理来维护它当前的IP地址信息</li></ul><h5 id="外部代理"><a href="#外部代理" class="headerlink" title="外部代理"></a>外部代理</h5><blockquote><p>当移动结点移动到外地(另一个网络中)时，需要获得一个临时的辅地址(归属地主地址不变)</p></blockquote><div style="page-break-after:always"></div><h4 id="b-通信过程"><a href="#b-通信过程" class="headerlink" title="b. 通信过程"></a>b. 通信过程</h4><h5 id="工作在本地"><a href="#工作在本地" class="headerlink" title="工作在本地"></a>工作在本地</h5><p>按传统的TCP/IP协议通信(通过本地网的固有地址)</p><h5 id="漫游在外地"><a href="#漫游在外地" class="headerlink" title="漫游在外地"></a>漫游在外地</h5><ol><li><p>获得外部代理的IP（转交地址）</p><ul><li><p>移动结点主动申请获得外部代理的转交代理</p></li><li><p>外部代理以ICMP报文的方式广播转交地址</p></li></ul></li><li><p>移动结点向本地代理注册所在地的转交地址(外部代理IP)</p></li><li><p>本地代理接收到请求时，将该移动结点的本地IP地址与转交地址绑定</p><p>构建一条通向转交地址的隧道，将发往移动结点的分组通过隧道送到外部代理处</p><p>返回注册响应</p></li><li><p>外部代理接收到注册响应后，转发给移动结点</p></li><li><p>移动结点开始通信</p><p><strong>接收和发送的分组都要通过外部代理转交给本地代理路由器进行</strong></p></li></ol><h5 id="从外地回本地"><a href="#从外地回本地" class="headerlink" title="从外地回本地"></a>从外地回本地</h5><blockquote><p>向本地代理注销转交地址</p></blockquote><h2 id="4-4-网络层数据传送单元"><a href="#4-4-网络层数据传送单元" class="headerlink" title="4.4 网络层数据传送单元"></a>4.4 网络层数据传送单元</h2><h3 id="4-4-1-IPv4分组"><a href="#4-4-1-IPv4分组" class="headerlink" title="4.4.1 IPv4分组"></a>4.4.1 IPv4分组</h3><p><img src="/posts/1989371375/image-20220308171512594.png" alt="image-20220308171512594"></p><p><img src="/posts/1989371375/IPv4分组格式.png" alt="IPv4分组格式"></p><h4 id="a-涉及长度的字段的单位"><a href="#a-涉及长度的字段的单位" class="headerlink" title="a. 涉及长度的字段的单位"></a>a. 涉及长度的字段的单位</h4><p><strong>偏8首4</strong></p><p>总长度——1B</p><p>偏移地址——8B</p><p>首部长度——4B</p><h3 id="4-4-2-IPv6分组"><a href="#4-4-2-IPv6分组" class="headerlink" title="4.4.2 IPv6分组"></a>4.4.2 IPv6分组</h3><p><img src="/posts/1989371375/image-20220308173312387.png" alt></p><h4 id="a-解决地址耗尽的问题"><a href="#a-解决地址耗尽的问题" class="headerlink" title="a. 解决地址耗尽的问题"></a>a. 解决地址耗尽的问题</h4><ol><li>采用无分类编址CIDR</li><li>采用网络地址转换(NAT)节省全球IP</li><li><strong>采用更大的地址空间——IPV6</strong></li></ol><h4 id="b-IPv6地址"><a href="#b-IPv6地址" class="headerlink" title="b. IPv6地址"></a>b. IPv6地址</h4><p><strong>64bit</strong></p><p>表示方法：冒号十六进制</p><ul><li>四位十六进制一段，中间用冒号分隔</li></ul><p>缩写规则</p><ul><li>段开始的零可以省略</li><li>段末尾的零不能省略</li><li>全0的段可以不写，但两段的冒号不能省 如：<code>xxxx:0000:xxxx:xxxx</code> 可表示为 <code>xxxx::xxxx:xxxx</code></li></ul><h4 id="c-IPv6协议特点"><a href="#c-IPv6协议特点" class="headerlink" title="c. IPv6协议特点"></a>c. IPv6协议特点</h4><ol><li><p>有更大的地址空间：IPV4——32位，IPV6——64位</p></li><li><p>无首部检验和，减少每跳上的检验时间</p></li><li><p>支持即插即用(自动配置)，无需DHCP</p></li><li><p>IPV6首部长度固定为40B，IPV4首部长度为4B的整数倍</p></li><li><p>IPV6只有在源站才能分片，中间结点放不下IPv6数据则直接丢弃</p><p>IPV4协议，中间结点放不下可以分片</p><p>都是在目的站点合并分片</p></li></ol><h4 id="d-从IPv4到IPv6的过渡"><a href="#d-从IPv4到IPv6的过渡" class="headerlink" title="d. 从IPv4到IPv6的过渡"></a>d. 从IPv4到IPv6的过渡</h4><h5 id="双栈协议"><a href="#双栈协议" class="headerlink" title="双栈协议"></a>双栈协议</h5><blockquote><p>一部分主机(路由器)装有两个协议栈</p></blockquote><h5 id="隧道技术"><a href="#隧道技术" class="headerlink" title="隧道技术"></a>隧道技术</h5><blockquote><p>将整个IPv6数据报封装成IPv4数据报的数据部分，使得IPv6的报文可以在IPv6的隧道中传输</p></blockquote><h3 id="4-4-3-ICMP报文"><a href="#4-4-3-ICMP报文" class="headerlink" title="4.4.3 ICMP报文"></a>4.4.3 ICMP报文</h3><p><strong>ICMP是网络层协议</strong>：服务于网络层</p><p><strong>ICMP报文作为IP数据报的数据部分</strong></p><h5 id="干啥的-3"><a href="#干啥的-3" class="headerlink" title="干啥的"></a>干啥的</h5><blockquote><p>由于IP协议族不提供差错控制功能，所以使用ICMP（网际控制报文协议）让主机或路由器报告差错和异常情况</p></blockquote><h5 id="ICMP差错报告报文"><a href="#ICMP差错报告报文" class="headerlink" title="ICMP差错报告报文"></a>ICMP差错报告报文</h5><blockquote><p>用于目标主机或到目标主机路径上的路由器向源主机报告差错和异常情况</p></blockquote><hr><p>类型：</p><ol><li><p>终点不可达。数据不能交付。RIP16跳</p></li><li><p>源点抑制。拥塞丢弃</p></li><li><p>超时。TTL=0</p><p><strong>路由器</strong>收到TTL=0的报文，丢弃<strong>该分组</strong>，并返回ICMP超时报文</p><p><strong>主机</strong>收到TTL=0的报文，丢弃<strong>该数据报的全部分组</strong> ，向源站发送ICMP超时报文</p></li><li><p>参数出错。首部检验和出错</p></li><li><p>改变路由（重定向）。路由器收到报文后，把改变路由报文发送给主机，让主机知道下次应把数据报发送给另一个路由器</p></li></ol><hr><p>不发送ICMP差错报文的情况</p><ol><li>对ICMP的差错报文不再发送ICMP差错报文</li><li>只对同一个数据报的第一个分片发送ICMP报文</li><li>对具有组播地址的数据报不发送ICMP差错报文</li><li>对具体的特殊地址(127.0.0.0或0.0.0.0)不发送ICMP差错报文</li></ol><h5 id="ICMP询问报文"><a href="#ICMP询问报文" class="headerlink" title="ICMP询问报文"></a>ICMP询问报文</h5><p>类型</p><ol><li><p>回送请求和回答报文</p><p>测试结点是否可达，了解相关状态</p><p>Ping：测试两台主机连通性</p></li><li><p>时间戳请求和回答报文</p><p>时钟同步</p><p>traceroute:用于跟踪分组经过的路由</p></li></ol><h3 id="4-4-4-IP数据报的三种传输方式"><a href="#4-4-4-IP数据报的三种传输方式" class="headerlink" title="4.4.4 IP数据报的三种传输方式"></a>4.4.4 IP数据报的三种传输方式</h3><ol><li><p>单播(点对点)：单个目的地，发送一次IP报，用一个单播IP最为目的地址</p></li><li><p>广播(点对不知道)：同一 广播域 或 局域网 内所有设备都可收到</p><p>目的地址字段：</p><ul><li>IP：主机号全1</li><li>MAC：FF-FF-FF-FF-FF-FF</li></ul></li><li><p>多播、组播(点对多点)：源主机一次发送单个分组到同一组的多个主机</p><p>一个主机可归属于多个分组，同一主机上的多个进程有各自的组播地址</p></li></ol><h2 id="4-5-路由选择"><a href="#4-5-路由选择" class="headerlink" title="4.5 路由选择"></a>4.5 路由选择</h2><h3 id="4-5-1-基本概念"><a href="#4-5-1-基本概念" class="headerlink" title="4.5.1 基本概念"></a>4.5.1 基本概念</h3><p>层次路由：路由选择必须按照<strong>层次结构</strong>的方式，一个层次即一个自治系统</p><h4 id="a-采用层次路由的原因"><a href="#a-采用层次路由的原因" class="headerlink" title="a. 采用层次路由的原因"></a>a. 采用层次路由的原因</h4><blockquote><p>随着网络规模的扩大，路由表会相应扩大</p></blockquote><ul><li>空间：需要消耗更多的路由器缓冲区</li><li>时间：需要更多的CPU时间扫描路由</li><li>带宽：需要占更多的带宽交换状态信息</li></ul><h4 id="b-自治系统"><a href="#b-自治系统" class="headerlink" title="b. 自治系统"></a>b. 自治系统</h4><blockquote><p>由一组路由器连接的局域网形成一个自治系统</p></blockquote><p>区域：OSPF将一个自治系统按路由器连接的局域网划分成一个区域</p><p>在一个自治系统内的路由器必须连通</p><h4 id="自治系统的路由选择"><a href="#自治系统的路由选择" class="headerlink" title="自治系统的路由选择"></a>自治系统的路由选择</h4><p>自治系统内部的路由选择协议称为 内部网关协议(IGP)，共同度量确定分组在AS内部的路由，如：RIP，OSPF</p><p>自治系统间的路由选择协议称为 外部网关协议(EGP)，确定分组在AS间的路由，如：BGP</p><h3 id="4-5-2-路由算法"><a href="#4-5-2-路由算法" class="headerlink" title="4.5.2 路由算法"></a>4.5.2 路由算法</h3><h4 id="a-静态路由算法"><a href="#a-静态路由算法" class="headerlink" title="a. 静态路由算法"></a>a. 静态路由算法</h4><blockquote><p>网络管理员手工配置的路由信息</p></blockquote><p>优点</p><ul><li>在负载稳定，拓扑变化不大的网络中效果好</li></ul><p>缺点</p><ul><li>路由更新慢，不适用于大型网络</li></ul><h4 id="b-动态路由算法"><a href="#b-动态路由算法" class="headerlink" title="b. 动态路由算法"></a>b. 动态路由算法</h4><blockquote><p>路由表项是通过相互连接的路由器之间彼此交换信息，按照一定的算法优化出来</p><ul><li>路由信息定时更新，以适应不断变化的网络</li></ul></blockquote><p>优点</p><ul><li>改善网络的性能</li><li>有助于流量控制</li></ul><p>缺点</p><ul><li>算法复杂</li><li>增加网络负载</li></ul><p>分类</p><ul><li><p>距离-向量算法：分散性，适用于小网络，应用协议：RIP，BGP</p></li><li><p>链路状态路由算法：全局性，适用于大网络，应用协议：OSPF</p></li></ul><h3 id="4-5-3-路由协议"><a href="#4-5-3-路由协议" class="headerlink" title="4.5.3 路由协议"></a>4.5.3 路由协议</h3><div class="table-container"><table><thead><tr><th></th><th>RIP</th><th>OSPF</th><th>BGP</th></tr></thead><tbody><tr><td>类型</td><td>内部</td><td>内部</td><td>外部</td></tr><tr><td>路由算法</td><td>距离-向量</td><td>链路状态</td><td>路径-向量</td></tr><tr><td>传递协议</td><td>UDP</td><td>IP</td><td>TCP</td></tr><tr><td>路径选择</td><td>跳数最少</td><td>代价最低</td><td>较好，非最佳</td></tr><tr><td>交换结点</td><td>和本结点相邻的路由器</td><td>网络中的所有路由器</td><td>和本结点相邻的路由器</td></tr><tr><td>交换内容</td><td>当前本路由器知道的全部信息</td><td>与本路由器相邻的所有路由器的链路状态</td><td>首次：整个路由表<br>非首次：有变化的部分</td></tr></tbody></table></div><h4 id="a-路由信息协议RIP"><a href="#a-路由信息协议RIP" class="headerlink" title="a. 路由信息协议RIP"></a>a. 路由信息协议RIP</h4><p><strong>应用层协议</strong>：使用UDP数据报</p><blockquote><p>RIP是一种分布式基于距离-向量的路由选择协议，简单适用于小网络</p></blockquote><p>跳数与连通</p><ul><li>与本路由器直连的网络，其跳数（距离）为1，表现为可检测到网络的连通状态</li><li>距离16表示表示不可达</li></ul><h5 id="距离-向量算法"><a href="#距离-向量算法" class="headerlink" title="距离-向量算法"></a>距离-向量算法</h5><p>路由表项：<code>目的网络N|距离d|下一跳X</code></p><ol><li><strong>每隔30S和相邻路由器</strong>交换全部路由信息，即<strong>自己的路由表</strong></li><li>本机收到地址为X的相邻路由器发来的RIP报，其中包含的RIP表项所有 <code>距离</code> 字段值加1，<code>下一跳</code> 为X</li><li>设修改后的RIP报文中每个表项的目的网络为N，逐个执行如下步骤：<ol><li>本机路由表中没有该项N，则将N添加到本机的路由表中</li><li>若N存在于本地路由表，且其下一跳地址为X，用最新的距离向量</li><li>若N存在与本地路由表，且其下一跳地址不为X，用最短的距离向量</li></ol></li><li>如果180S还没收到相邻路由器的路由更新表，则把此相邻路由记为不可达路由器，距离改为16</li></ol><h5 id="协议内容"><a href="#协议内容" class="headerlink" title="协议内容"></a>协议内容</h5><p>网络中的每个路由器都要维护从它自身到每个目的网络的最佳距离</p><ul><li>经过若干次RIP广播后，所有路由器都知道整个IP网络的路由表，称RIP最终是收敛的</li></ul><p>RIP认为好的路由就是通过的路由器数目最少，即跳数最少的路径，但不一定是传输时间最短</p><ul><li>RIP一条路径最多包含15个路由器</li></ul><p><strong>好消息传的快，坏消息传的慢</strong></p><ul><li><p>网络出现故障，会出现慢收敛现象，可能导致路由回路</p></li><li><p>R1，R2到同一网络的距离是16，才知道网络不可达</p></li></ul><p>在RIP中不支持子网掩码的RIP广播，所以RIP中每个网络的子网掩码必须相同</p><p>一个RIP报文中最多包含25个路由信息</p><ul><li>RIP报文封装到UDP用户数据报的数据部分；端口520</li></ul><h4 id="b-开放最短路径优先协议OSPF"><a href="#b-开放最短路径优先协议OSPF" class="headerlink" title="b. 开放最短路径优先协议OSPF"></a>b. 开放最短路径优先协议OSPF</h4><p><strong>网络层协议</strong>：使用IP数据报传输</p><blockquote><p>使用分布式链路状态路由算法</p></blockquote><p>链路状态</p><ul><li>本路由器和哪些路由器相邻</li><li>该链路的 代价：费用，距离，时延</li></ul><p>SPF：Dijkstra最短路径；代价最小</p><p><img src="/posts/1989371375/image-20220309150545465.png" alt></p><h5 id="与RIP协议区别"><a href="#与RIP协议区别" class="headerlink" title="与RIP协议区别"></a>与RIP协议区别</h5><p>交换方式：洪泛</p><p>交换对象：本自治系统的所有路由器发送信息</p><p>交换信息：与本路由器相邻的所有路由器的链路状态</p><p>交换时间：只有当链路状态发生变化时</p><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>在一个站点路由器中，已知的链路状态信息被保存在 <code>链路状态数据库</code> 中，网络达到收敛状态后，就构造出 <strong>全网的拓扑结构图</strong>。本站据此用 <code>Dijkstra</code> 算法计算到每个目的网络的最短路径，在路由表中保存路径中下一跳路由器的地址</p><p>OSPF将自治系统划分成若干<strong>区域</strong>，只需要在区域内洪泛，在一个区域内部的路由器只知道本区域内的网络拓扑</p><h5 id="完整流程"><a href="#完整流程" class="headerlink" title="完整流程"></a>完整流程</h5><ol><li>启动路由器，让每个路由器向其邻接路由器发送 <code>数据库描述分组</code>，给出已有的的链路状态摘要信息</li><li>使用 <code>链路状态请求分组</code> 请求自己缺少的某些链路状态详细信息</li><li>邻居收到的 <code>链路状态请求分组</code> 后，向对方发送 <code>链路状态更新分组</code></li><li>收到 <code>链路状态更新分组</code> 后，更新链路状态，向邻居发送 <code>链路状态确认分组</code></li><li>这样就建立了全网同步的链路数据库</li><li>各路由器根据自己的链路状态数据库，使用 <code>Dijkstra</code> 算法，计算到目的网络的最短路径，将路径上的下一跳路由器作为表项放入路由表</li><li>当一个路由器的链路状态发生变化，该路由器使用 <code>链路状态更新分组</code> ，用洪泛法向全网发送链路状态。其他路由器接收到后，发送 <code>链路状态确认分组</code>进行确认</li></ol><h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ol><li>每隔一段时间，就要刷新数据库中的链路状态</li><li>每隔10S，相邻路由器交换一次 <code>问候分组</code></li><li>一个路由器的链路状态只涉及相邻路由器的连通状态，所以与整个互联网的规模无关</li><li>OSPF收敛快</li></ol><h4 id="c-边界网关协议BGP"><a href="#c-边界网关协议BGP" class="headerlink" title="c. 边界网关协议BGP"></a>c. 边界网关协议BGP</h4><p><strong>应用层协议</strong>：基于TCP</p><blockquote><p>采用路径-向量路由选择协议</p></blockquote><p>选择比较好的路由，不能兜圈子</p><h5 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h5><p>各自治系统的网管至少选一个路由器作为该AS的 发言人。</p><p>一个BGP发言人与另一AS的BGP发言人建立TCP连接</p><p>在TCP连接的基础上交换BGP报文建立BGP会话</p><p>BGP会话建立后交换路路由信息</p><p>当所有BGP发言人都相互交换网络可达性的信息后，各BGP发言人就能找出到达各AS的较好路由</p><ul><li><p>可达性信息：到达某个网络所要经过的一系列AS</p><p>BGP刚运行时，BGP各邻站交换的是整个BGP路由表，但以后只需在发生变化时更新有变化部分</p></li></ul><h5 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h5><p>BGP支持CIDR，BGP路由表结构 <code>&#123;目的网络前缀、下一跳路由器、到达该目的网络经过的AS序列&#125;</code></p><h2 id="4-6-IP组播"><a href="#4-6-IP组播" class="headerlink" title="4.6 IP组播"></a>4.6 IP组播</h2><blockquote><p>组播数据包会被IP层路由器转发到组群成员所在的路由器，然后用以太网的组播功能把数据包送到组播成员的网卡接口</p></blockquote><h3 id="4-6-1-特点"><a href="#4-6-1-特点" class="headerlink" title="4.6.1 特点"></a>4.6.1 特点</h3><ol><li>组播源点主机，只发送一份数据，只有在传送路径出现分叉，才将分组复制转发<ul><li>路径分叉：组播组中的主机若不在同一物理网络，需要组播路由器转发</li></ul></li><li>一定仅用UDP</li><li>不提供可靠交付，“尽最大努力交付”</li><li>组播地址只能用于目的地址</li></ol><h3 id="4-6-2-D类地址与组播地址"><a href="#4-6-2-D类地址与组播地址" class="headerlink" title="4.6.2 D类地址与组播地址"></a>4.6.2 D类地址与组播地址</h3><p>不是所有的D类地址都可作为组播地址</p><p><img src="/posts/1989371375/image-20220309122521877.png" alt></p><h4 id="a-IP组播的两种情况"><a href="#a-IP组播的两种情况" class="headerlink" title="a. IP组播的两种情况"></a>a. IP组播的两种情况</h4><p>因特网范围的组播</p><p>局域网上的硬件组播：以太网的洪泛。一个节点发送的数据包会被以太网泛洪，导致每一个以太网网卡接口都会收到这个数据包。接口收到数据包后，并不马上交给节点CPU处理，而是进行MAC地址比较，如果数据包的目的MAC地址和接口的MAC地址一样，它才接受，把数据包交给计算机，否则就把数据包丢弃。</p><h4 id="b-协议"><a href="#b-协议" class="headerlink" title="b. 协议"></a>b. 协议</h4><h5 id="因特网组管理协议IGMP"><a href="#因特网组管理协议IGMP" class="headerlink" title="因特网组管理协议IGMP"></a>因特网组管理协议IGMP</h5><p><strong>让路由器知道组播组的成员信息</strong></p><blockquote><p>使组播路由器知道本局域网上是否有主机参与或推出了组播组</p></blockquote><p>工作阶段</p><ol><li><p>当某台主机加入新的组播组，该主机向组播组的组播地址发送一个IGMP报文，声明自己要成为该组的成员</p><p>本地的组播路由器收到IGMP报文后，将组成员关系转发给因特网上的其他组播路由器</p></li><li><p>本地组播路由器要周期性地探寻本地局域网上的主机，以便知道这些主机所在的组是否还活跃。只要组中有一台主机响应，则认为该组仍然活跃。如果连续几次探询，没有收到回应，则不再将该组的成员关系转发给其他组播路由器</p></li></ol><h5 id="路由选择协议"><a href="#路由选择协议" class="headerlink" title="路由选择协议"></a>路由选择协议</h5><blockquote><p>组播路由器间协同工作：最低代价转发</p></blockquote><p>找出以源主机为根结点的组播转发树</p><ul><li>不同组播组，不同的组播转发树</li><li>同一组播组，不同的源点有不同的组播转发树</li></ul><h5 id="路由算法"><a href="#路由算法" class="headerlink" title="路由算法"></a>路由算法</h5><ul><li>基于链路状态的路由选择</li><li>基于距离-向量的路由选择</li></ul></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------<i class="fa fa-hand-peace-o"></i>本文结束-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者 </strong>AmosTian</li><li class="post-copyright-link"><strong>本文链接 </strong><a href="https://amostian.github.io/posts/1989371375/" title="4.网络层">https://amostian.github.io/posts/1989371375/</a></li><li class="post-copyright-license"><strong>版权声明 </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag"><i class="fa fa-tags"></i> 计算机基础</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag"><i class="fa fa-tags"></i> 计算机网络</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/3177222135/" rel="prev" title="3.链路层"><i class="fa fa-chevron-left"></i> 3.链路层</a></div><div class="post-nav-item"><a href="/posts/3792261443/" rel="next" title="3.内存管理">3.内存管理 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="nav-text">4. 网络层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%8A%9F%E8%83%BD"><span class="nav-text">4.1 功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-%E5%BC%82%E6%9E%84%E7%BD%91%E7%BB%9C%E4%BA%92%E8%81%94"><span class="nav-text">4.1.1 异构网络互联</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-%E8%B7%AF%E7%94%B1%E4%B8%8E%E8%BD%AC%E5%8F%91"><span class="nav-text">4.1.2 路由与转发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91"><span class="nav-text">a. 分组转发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9"><span class="nav-text">b. 路由选择</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-3-%E5%A4%8D%E7%94%A8%E5%92%8C%E5%88%86%E7%94%A8"><span class="nav-text">4.1.3 复用和分用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-4-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="nav-text">4.1.4 拥塞控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E6%8B%A5%E5%A1%9E"><span class="nav-text">a. 拥塞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="nav-text">b. 拥塞控制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E7%89%A9%E7%90%86%E8%AE%BE%E5%A4%87"><span class="nav-text">4.2 物理设备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-%E5%8A%9F%E8%83%BD"><span class="nav-text">4.2.1 功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BA%A4%E4%BB%98%E6%96%B9%E5%BC%8F"><span class="nav-text">4.2.2 数据的交付方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E7%9B%B4%E6%8E%A5%E4%BA%A4%E4%BB%98"><span class="nav-text">a. 直接交付</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E9%97%B4%E6%8E%A5%E4%BA%A4%E4%BB%98"><span class="nav-text">b. 间接交付</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-%E7%BB%93%E6%9E%84"><span class="nav-text">4.2.3 结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E8%B7%AF%E7%94%B1%E8%A1%A8%E4%B8%8E%E8%BD%AC%E5%8F%91%E8%A1%A8"><span class="nav-text">a. 路由表与转发表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%A4%84%E7%90%86%E6%9C%BA"><span class="nav-text">b. 路由选择处理机</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c-%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91%E9%83%A8%E5%88%86"><span class="nav-text">c. 分组转发部分</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%A4%E6%8D%A2%E7%BB%93%E6%9E%84"><span class="nav-text">交换结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%AB%AF%E5%8F%A3"><span class="nav-text">输入输出端口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="nav-text">分组转发过程</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E7%BD%91%E7%BB%9C%E7%BC%96%E5%9D%80"><span class="nav-text">4.3 网络编址</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-%E5%B9%B2%E4%BB%80%E4%B9%88%E7%9A%84"><span class="nav-text">4.3.1 干什么的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-IPv4%E7%89%B9%E6%AE%8A%E7%9A%84IP%E5%9C%B0%E5%9D%80"><span class="nav-text">4.3.2 IPv4特殊的IP地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-%E4%B8%80%E8%88%AC%E7%9A%84%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB%E5%8F%8A%E4%B8%AA%E6%95%B0"><span class="nav-text">4.3.3 一般的地址分类及个数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4-%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86"><span class="nav-text">4.3.4 子网划分</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E6%80%9D%E8%B7%AF"><span class="nav-text">a. 思路</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="nav-text">b. 子网掩码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-5-%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80CIDR"><span class="nav-text">4.3.5 无分类编址CIDR</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E6%80%9D%E8%B7%AF-1"><span class="nav-text">a. 思路</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E6%9C%80%E9%95%BF%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D"><span class="nav-text">b. 最长前缀匹配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c-CIDR%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="nav-text">c. CIDR路由表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-6-%E4%B8%8EIP%E5%9C%B0%E5%9D%80%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="nav-text">4.3.6 与IP地址相关的协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-ARP-%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE"><span class="nav-text">a. ARP(地址解析协议)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B9%B2%E5%95%A5%E7%9A%84"><span class="nav-text">干啥的</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%80%8E%E4%B9%88%E5%B9%B2"><span class="nav-text">怎么干</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-NAT-%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2"><span class="nav-text">b. NAT(网络地址转换)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B9%B2%E5%95%A5%E7%9A%84-1"><span class="nav-text">干啥的</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%80%8E%E4%B9%88%E5%B9%B2-1"><span class="nav-text">怎么干</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BA%A6%E5%AE%9A%E7%9A%84%E7%A7%81%E7%BD%91IP"><span class="nav-text">约定的私网IP</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c-DHCP-%E5%8A%A8%E6%80%81%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8D%8F%E8%AE%AE"><span class="nav-text">c. DHCP(动态主机配置协议)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B9%B2%E5%95%A5%E7%9A%84-2"><span class="nav-text">干啥的</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%80%8E%E4%B9%88%E5%81%9A"><span class="nav-text">怎么做</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="nav-text">注意点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-7-%E7%A7%BB%E5%8A%A8IP"><span class="nav-text">4.3.7 移动IP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E6%A6%82%E5%BF%B5"><span class="nav-text">a. 概念</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8%E7%BB%93%E7%82%B9"><span class="nav-text">移动结点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BD%92%E5%B1%9E%E4%BB%A3%E7%90%86-%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%90%86"><span class="nav-text">归属代理(本地代理)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E4%BB%A3%E7%90%86"><span class="nav-text">外部代理</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B"><span class="nav-text">b. 通信过程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%9C%A8%E6%9C%AC%E5%9C%B0"><span class="nav-text">工作在本地</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%BC%AB%E6%B8%B8%E5%9C%A8%E5%A4%96%E5%9C%B0"><span class="nav-text">漫游在外地</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%8E%E5%A4%96%E5%9C%B0%E5%9B%9E%E6%9C%AC%E5%9C%B0"><span class="nav-text">从外地回本地</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-%E7%BD%91%E7%BB%9C%E5%B1%82%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E5%8D%95%E5%85%83"><span class="nav-text">4.4 网络层数据传送单元</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-1-IPv4%E5%88%86%E7%BB%84"><span class="nav-text">4.4.1 IPv4分组</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E6%B6%89%E5%8F%8A%E9%95%BF%E5%BA%A6%E7%9A%84%E5%AD%97%E6%AE%B5%E7%9A%84%E5%8D%95%E4%BD%8D"><span class="nav-text">a. 涉及长度的字段的单位</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-2-IPv6%E5%88%86%E7%BB%84"><span class="nav-text">4.4.2 IPv6分组</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E8%A7%A3%E5%86%B3%E5%9C%B0%E5%9D%80%E8%80%97%E5%B0%BD%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">a. 解决地址耗尽的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-IPv6%E5%9C%B0%E5%9D%80"><span class="nav-text">b. IPv6地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c-IPv6%E5%8D%8F%E8%AE%AE%E7%89%B9%E7%82%B9"><span class="nav-text">c. IPv6协议特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#d-%E4%BB%8EIPv4%E5%88%B0IPv6%E7%9A%84%E8%BF%87%E6%B8%A1"><span class="nav-text">d. 从IPv4到IPv6的过渡</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%8C%E6%A0%88%E5%8D%8F%E8%AE%AE"><span class="nav-text">双栈协议</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="nav-text">隧道技术</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-3-ICMP%E6%8A%A5%E6%96%87"><span class="nav-text">4.4.3 ICMP报文</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B9%B2%E5%95%A5%E7%9A%84-3"><span class="nav-text">干啥的</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ICMP%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87"><span class="nav-text">ICMP差错报告报文</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ICMP%E8%AF%A2%E9%97%AE%E6%8A%A5%E6%96%87"><span class="nav-text">ICMP询问报文</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-4-IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E4%B8%89%E7%A7%8D%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F"><span class="nav-text">4.4.4 IP数据报的三种传输方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9"><span class="nav-text">4.5 路由选择</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text">4.5.1 基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E9%87%87%E7%94%A8%E5%B1%82%E6%AC%A1%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="nav-text">a. 采用层次路由的原因</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F"><span class="nav-text">b. 自治系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9"><span class="nav-text">自治系统的路由选择</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-2-%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="nav-text">4.5.2 路由算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="nav-text">a. 静态路由算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="nav-text">b. 动态路由算法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-3-%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="nav-text">4.5.3 路由协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF%E5%8D%8F%E8%AE%AERIP"><span class="nav-text">a. 路由信息协议RIP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%9D%E7%A6%BB-%E5%90%91%E9%87%8F%E7%AE%97%E6%B3%95"><span class="nav-text">距离-向量算法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE%E5%86%85%E5%AE%B9"><span class="nav-text">协议内容</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E5%BC%80%E6%94%BE%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E5%8D%8F%E8%AE%AEOSPF"><span class="nav-text">b. 开放最短路径优先协议OSPF</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8ERIP%E5%8D%8F%E8%AE%AE%E5%8C%BA%E5%88%AB"><span class="nav-text">与RIP协议区别</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-text">原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B"><span class="nav-text">完整流程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E7%82%B9"><span class="nav-text">特点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c-%E8%BE%B9%E7%95%8C%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AEBGP"><span class="nav-text">c. 边界网关协议BGP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">工作原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E7%82%B9-1"><span class="nav-text">特点</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-IP%E7%BB%84%E6%92%AD"><span class="nav-text">4.6 IP组播</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-1-%E7%89%B9%E7%82%B9"><span class="nav-text">4.6.1 特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-2-D%E7%B1%BB%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80"><span class="nav-text">4.6.2 D类地址与组播地址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-IP%E7%BB%84%E6%92%AD%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%83%85%E5%86%B5"><span class="nav-text">a. IP组播的两种情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b-%E5%8D%8F%E8%AE%AE"><span class="nav-text">b. 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9B%A0%E7%89%B9%E7%BD%91%E7%BB%84%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AEIGMP"><span class="nav-text">因特网组管理协议IGMP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE"><span class="nav-text">路由选择协议</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="nav-text">路由算法</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="AmosTian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">AmosTian</p><div class="site-description" itemprop="description">知道的越多，不知道的越多</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">216</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">65</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">82</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/AmosTian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AmosTian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://blog.csdn.net/qq_40479037?type=blog" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_40479037?type&#x3D;blog" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a> </span><span class="links-of-author-item"><a href="mailto:17636679561@163.com" title="E-Mail → mailto:17636679561@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("01/27/2022 15:13:14"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-grav"></i> </span><span class="author" itemprop="copyrightHolder">AmosTian</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">站点总字数 </span><span title="站点总字数">1150.8k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">46:51</span></div></div></footer></div><script color="0,0,0" opacity="0.5" zindex="-1" count="150" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'neutral',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}</script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script><script async src="/js/cursor/fireworks.js"></script><script src="/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,document.body.addEventListener("input",POWERMODE)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"live2d-widget-model-hijiki"},display:{position:"right",width:150,height:300},mobile:{show:!1},log:!1})</script></body></html>