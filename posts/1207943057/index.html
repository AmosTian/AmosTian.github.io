<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/favicon.png" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa:300,300italic,400,400italic,700,700italic|Ma Shan Zheng:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"amostian.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="前置知识： Mybatis Spring SpringMVC SpringBoot 微服务 Dubbo  后台信息管理系统采用的是前后端分离开发模式，前端使用LayUI系统作为模板进行改造，后端采用的是SpringBoot+Dubbo+SSM的架构进行开发  后台系统架构 工具：图像存储——COS对象存储 分析服务之间关系并创建工程 代码优化： 抽取公共工程 GraphQL风格查询接口"><meta property="og:type" content="article"><meta property="og:title" content="毕设项目后台"><meta property="og:url" content="https://amostian.github.io/posts/1207943057/index.html"><meta property="og:site_name" content="AmosTian"><meta property="og:description" content="前置知识： Mybatis Spring SpringMVC SpringBoot 微服务 Dubbo  后台信息管理系统采用的是前后端分离开发模式，前端使用LayUI系统作为模板进行改造，后端采用的是SpringBoot+Dubbo+SSM的架构进行开发  后台系统架构 工具：图像存储——COS对象存储 分析服务之间关系并创建工程 代码优化： 抽取公共工程 GraphQL风格查询接口"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%9B%BE.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210317155702868.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210316102155629.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210316140430615.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210316150113220.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210316100010234.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210317084917963.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210317085311342.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210317090850987.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210317153718529.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210318101526639.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210319224559982.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210319230828751.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320095729934.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320152702837.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320152848121.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320152904298.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320175407784.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320181030805.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320181200692.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320204332157.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320204448159.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320205112431.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320205326494.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210320222151968.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210321101340465.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210321130341760.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210321160241482.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210321165322279.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210322110918002.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210322111758197-1623733053892.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210322114358743.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210324162901912.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210324162830267.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325112409709.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325115643885.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325133234793-16487887911294.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325140008394.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325152651651.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325153833335.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325154405802.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325154518654.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325212209112.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325213959837.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325213654529.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325215219807.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210325220325732.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210322134830161.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210327101345725.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210327101912684.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210327102625196.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210327102534537.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210327104220902-16487887782013.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210327103900120.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210327111113135.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210327170512039.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210328092844152.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210328100647147.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329200213549.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210324210335332.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210318225539186.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210318225008858.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210318231205448.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210319094707779.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210319181738866.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210319214954890.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329211330395.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329212642988.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329213347984.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329214229212.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329214247804.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329214259863.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329214354855.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329214600149.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329214817311.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210329220126931.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210330091711876.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210330092907260.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210330200516377.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210331085258567.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210330225920792.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210331091627323.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210331094542994.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210331094609925.png"><meta property="og:image" content="https://amostian.github.io/posts/1207943057/image-20210331100535360.png"><meta property="article:published_time" content="2022-03-18T08:41:48.000Z"><meta property="article:modified_time" content="2022-04-01T10:39:38.000Z"><meta property="article:author" content="AmosTian"><meta property="article:tag" content="开发"><meta property="article:tag" content="Java项目"><meta property="article:tag" content="毕设项目"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://amostian.github.io/posts/1207943057/%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%9B%BE.png"><link rel="canonical" href="https://amostian.github.io/posts/1207943057/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>毕设项目后台 | AmosTian</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">AmosTian</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">58</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">74</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">358</span></a></li><li class="menu-item menu-item-essay"><a href="/categories/%E9%9A%8F%E7%AC%94/" rel="section"><i class="fa fa-fw fa-pied-piper"></i>随笔</a></li><li class="menu-item menu-item-dynamic-resume"><a href="/dynamic-resume/" rel="section"><i class="fa fa-fw fa-cog"></i>动态简历</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/AmosTian" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://amostian.github.io/posts/1207943057/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="AmosTian"><meta itemprop="description" content="知道的越多，不知道的越多"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="AmosTian"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">毕设项目后台</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间 2022-03-18 16:41:48" itemprop="dateCreated datePublished" datetime="2022-03-18T16:41:48+08:00">2022-03-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间 2022-04-01 18:39:38" itemprop="dateModified" datetime="2022-04-01T18:39:38+08:00">2022-04-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">开发</span></a> </span>> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%BC%80%E5%8F%91/Java%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">Java项目</span></a> </span>> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%BC%80%E5%8F%91/Java%E9%A1%B9%E7%9B%AE/%E6%AF%95%E8%AE%BE%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">毕设项目</span></a></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数 </span><span title="本文字数">22.3k字 </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1:49</span></span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>前置知识：</p><p><a href="https://amostian.github.io/posts/3381441825/">Mybatis</a></p><p><a href="https://amostian.github.io/posts/1821512031/">Spring</a></p><p><a href="https://amostian.github.io/posts/2920256992/">SpringMVC</a></p><p><a href="https://amostian.github.io/posts/1864766114/">SpringBoot</a></p><p><a href="https://amostian.github.io/posts/1175195952/">微服务</a></p><p><a href="https://amostian.github.io/posts/4129633176/">Dubbo</a></p></blockquote><p>后台信息管理系统采用的是前后端分离开发模式，前端使用LayUI系统作为模板进行改造，后端采用的是SpringBoot+Dubbo+SSM的架构进行开发</p><ul><li>后台系统架构</li><li>工具：图像存储——COS对象存储</li><li>分析服务之间关系并创建工程</li><li>代码优化：<ul><li>抽取公共工程</li><li>GraphQL风格查询接口</li></ul></li></ul><span id="more"></span><h1 id="后台系统"><a href="#后台系统" class="headerlink" title="后台系统"></a>后台系统</h1><h2 id="后台系统架构"><a href="#后台系统架构" class="headerlink" title="后台系统架构"></a>后台系统架构</h2><blockquote><p>后台服务采用微服务的思想，使用Dubbo作为服务治理框架</p></blockquote><p><img src="/posts/1207943057/后台服务系统架构图.png" alt></p><h3 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h3><p>在单体架构的应用中，一个服务的所有功能模块都会被部署到同一台机器上。当用户规模变得庞大，应用的响应速度会变慢。这个时候可以通过增加一台机器部署应用来提高响应速度。假设这个应用只有房源模块和用户模块。经过分析，这个系统中房源模块消耗的资源最多。提高响应速度最高效的方法就是单独为房源模块分配更多资源。单体架构的应用无法做到这一点。</p><p>在微服务架构的应用中，应用会按照功能模块拆分为多个服务。部署时，可以在一台机器上部署一个用户服务和一个房源服务，另一台机器上部署两个房源服务，这样可以最大化利用系统资源。</p><h3 id="在该项目中为什么引入Dubbo"><a href="#在该项目中为什么引入Dubbo" class="headerlink" title="在该项目中为什么引入Dubbo"></a>在该项目中为什么引入Dubbo</h3><p>Dubbo框架基于生产者-消费者模型来完成服务治理。在一项业务流程中，一个服务要么是服务提供方，要么是服务消费方。降低了各层之间服务的耦合度。</p><p>设想一种场景，前台使用者进入程序会根据地理位置、平时浏览的户型、设置的喜好推送房源列表，后台管理员登录管理系统后，也会有获取房源列表的需求。但这两种角色身份不同，获取到的房源列表也会不同，所以需要不同的处理器对模型层返回的房源列表进行处理。但这两种处理器中，从模型层获取房源列表这个过程是公有的，所以将模型层查询房源列表服务作为一个服务，提供给不同控制器调用。</p><p>这与Dubbo的生产者-消费者模式很类似，Service层处理完数据后提供给Controller层，Controller层利用Service层的数据进行不同的业务处理流程，所以我把Service层作为服务的生产者，Controller层作为服务的消费者。</p><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p><img src="/posts/1207943057/image-20210317155702868.png" alt></p><h3 id="父工程"><a href="#父工程" class="headerlink" title="父工程"></a>父工程</h3><p><code>haoke-manage</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>haoke-manage-dubbo-server<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>haoke-manage-api-server<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--添加SpringBoot支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--springboot的测试支持--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--dubbo的springbboot支持--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--dubbo框架--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--zk依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.sgroschupf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--springboot的maven框架--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="子工程"><a href="#子工程" class="headerlink" title="子工程"></a>子工程</h3><h4 id="服务生产方"><a href="#服务生产方" class="headerlink" title="服务生产方"></a>服务生产方</h4><p><code>haoke-manage-dubbo-server</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>haoke-manage-dubbo-server-house-resources<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>haoke-manage-dubbo-server-generator<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="服务消费方"><a href="#服务消费方" class="headerlink" title="服务消费方"></a>服务消费方</h4><p><code>haoke-manage-api-server</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-api-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--springboot的web支持--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            api模块———本模块————服务导出层面</span></span><br><span class="line"><span class="comment">            interface模块————当前依赖，服务实现层面</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-house-resources-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="房源服务的构建"><a href="#房源服务的构建" class="headerlink" title="房源服务的构建"></a>房源服务的构建</h2><h3 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">use haoke;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `TB_ESTATE`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `TB_ESTATE` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;楼盘名称&#x27;</span>,</span><br><span class="line">  `province` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所在省&#x27;</span>,</span><br><span class="line">  `city` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所在市&#x27;</span>,</span><br><span class="line">  `area` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所在区&#x27;</span>,</span><br><span class="line">  `address` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;具体地址&#x27;</span>,</span><br><span class="line">  `<span class="keyword">year</span>` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;建筑年代&#x27;</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;建筑类型&#x27;</span>,</span><br><span class="line">  `property_cost` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;物业费&#x27;</span>,</span><br><span class="line">  `property_company` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;物业公司&#x27;</span>,</span><br><span class="line">  `developers` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;开发商&#x27;</span>,</span><br><span class="line">  `created` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `updated` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1006</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;楼盘表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `TB_ESTATE` <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1001</span>,<span class="string">&#x27;中远两湾城&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;普陀区&#x27;</span>,<span class="string">&#x27;远景路97弄&#x27;</span>,<span class="string">&#x27;2001&#x27;</span>,<span class="string">&#x27;塔楼/板楼&#x27;</span>,<span class="string">&#x27;1.5&#x27;</span>,<span class="string">&#x27;上海中远物业管理发展有限公司&#x27;</span>,<span class="string">&#x27;上海万业企业股份有限公司&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>),</span><br><span class="line">(<span class="number">1002</span>,<span class="string">&#x27;上海康城&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;闵行区&#x27;</span>,<span class="string">&#x27;莘松路958弄&#x27;</span>,<span class="string">&#x27;2001&#x27;</span>,<span class="string">&#x27;塔楼/板楼&#x27;</span>,<span class="string">&#x27;1.5&#x27;</span>,<span class="string">&#x27;盛孚物业&#x27;</span>,<span class="string">&#x27;闵行房地产&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>),</span><br><span class="line">(<span class="number">1003</span>,<span class="string">&#x27;保利西子湾&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;松江区&#x27;</span>,<span class="string">&#x27;广富林路1188弄&#x27;</span>,<span class="string">&#x27;2008&#x27;</span>,<span class="string">&#x27;塔楼/板楼&#x27;</span>,<span class="string">&#x27;1.75&#x27;</span>,<span class="string">&#x27;上海保利物业管理&#x27;</span>,<span class="string">&#x27;上海城乾房地产开发有限公司&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>),</span><br><span class="line">(<span class="number">1004</span>,<span class="string">&#x27;万科城市花园&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;松江区&#x27;</span>,<span class="string">&#x27;广富林路1188弄&#x27;</span>,<span class="string">&#x27;2002&#x27;</span>,<span class="string">&#x27;塔楼/板楼&#x27;</span>,<span class="string">&#x27;1.5&#x27;</span>,<span class="string">&#x27;上海保利物业管理&#x27;</span>,<span class="string">&#x27;上海城乾房地产开发有限公司&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>),</span><br><span class="line">(<span class="number">1005</span>,<span class="string">&#x27;上海阳城&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;上海市&#x27;</span>,<span class="string">&#x27;闵行区&#x27;</span>,<span class="string">&#x27;罗锦路888弄&#x27;</span>,<span class="string">&#x27;2002&#x27;</span>,<span class="string">&#x27;塔楼/板楼&#x27;</span>,<span class="string">&#x27;1.5&#x27;</span>,<span class="string">&#x27;上海莲阳物业管理有限公司&#x27;</span>,<span class="string">&#x27;上海莲城房地产开发有限公司&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>,<span class="string">&#x27;2021-03-16 23:00:20&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `TB_HOUSE_RESOURCES` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;房源标题&#x27;</span>,</span><br><span class="line">  `estate_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;楼盘id&#x27;</span>,</span><br><span class="line">  `building_num` <span class="type">varchar</span>(<span class="number">5</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;楼号（栋）&#x27;</span>,</span><br><span class="line">  `building_unit` <span class="type">varchar</span>(<span class="number">5</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;单元号&#x27;</span>,</span><br><span class="line">  `building_floor_num` <span class="type">varchar</span>(<span class="number">5</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;门牌号&#x27;</span>,</span><br><span class="line">  `rent` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;租金&#x27;</span>,</span><br><span class="line">  `rent_method` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;租赁方式，1-整租，2-合租&#x27;</span>,</span><br><span class="line">  `payment_method` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;支付方式，1-付一押一，2-付三押一，3-付六押一，4-年付押一，5-其它&#x27;</span>,</span><br><span class="line">  `house_type` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;户型，如：2室1厅1卫&#x27;</span>,</span><br><span class="line">  `covered_area` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;建筑面积&#x27;</span>,</span><br><span class="line">  `use_area` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;使用面积&#x27;</span>,</span><br><span class="line">  `floor` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;楼层，如：8/26&#x27;</span>,</span><br><span class="line">  `orientation` <span class="type">varchar</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;朝向：东、南、西、北&#x27;</span>,</span><br><span class="line">  `decoration` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;装修，1-精装，2-简装，3-毛坯&#x27;</span>,</span><br><span class="line">  `facilities` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;配套设施， 如：1,2,3&#x27;</span>,</span><br><span class="line">  `pic` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片，最多5张&#x27;</span>,</span><br><span class="line">  `house_desc` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;描述&#x27;</span>,</span><br><span class="line">  `contact` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;联系人&#x27;</span>,</span><br><span class="line">  `mobile` <span class="type">varchar</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">  `<span class="type">time</span>` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;看房时间，1-上午，2-中午，3-下午，4-晚上，5-全天&#x27;</span>,</span><br><span class="line">  `property_cost` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;物业费&#x27;</span>,</span><br><span class="line">  `created` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `updated` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;房源表&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="POJO"><a href="#POJO" class="headerlink" title="POJO"></a>POJO</h3><h4 id="BasePOJO"><a href="#BasePOJO" class="headerlink" title="BasePOJO"></a>BasePOJO</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.dubbo.server.pojo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BasePojo</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Date created;</span><br><span class="line">    <span class="keyword">private</span> Date updated;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="房源POJO"><a href="#房源POJO" class="headerlink" title="房源POJO"></a>房源POJO</h4><h5 id="1-MybatisPlus逆向工程生成POJO"><a href="#1-MybatisPlus逆向工程生成POJO" class="headerlink" title="1. MybatisPlus逆向工程生成POJO"></a>1. MybatisPlus逆向工程生成POJO</h5><p><code>&lt;span id=&quot;generator&quot;&gt;&lt;/span&gt;</code></p><blockquote><p>mybatis-plus的AutoGenerator插件根据 <em>数据库中的表结构</em> 生成相应的POJO类</p></blockquote><h6 id="创建generator项目"><a href="#创建generator项目" class="headerlink" title="创建generator项目"></a>创建generator项目</h6><p><img src="/posts/1207943057/image-20210316102155629.png" alt="image-20210316102155629"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--代码生成引擎 freemarker--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatis-plus插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h6 id="编写CodeGenerator"><a href="#编写CodeGenerator" class="headerlink" title="编写CodeGenerator"></a>编写CodeGenerator</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取控制台内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">scanner</span><span class="params">(String tip)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">help</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        </span><br><span class="line">        help.append(<span class="string">&quot;请输入&quot;</span> + tip + <span class="string">&quot;：&quot;</span>);</span><br><span class="line">        System.out.println(help.toString());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (scanner.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">ipt</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotEmpty(ipt)) &#123;</span><br><span class="line">                <span class="keyword">return</span> ipt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusException</span>(<span class="string">&quot;请输入正确的&quot;</span> + tip + <span class="string">&quot;！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">projectPath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        gc.setOutputDir(projectPath + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;amostian&quot;</span>);</span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://82.157.25.57:4002/haoke?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&quot;</span>);</span><br><span class="line">        <span class="comment">// dsc.setSchemaName(&quot;public&quot;);</span></span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;mycat&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;mycat&quot;</span>);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 目标包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        pc.setModuleName(scanner(<span class="string">&quot;模块名&quot;</span>));</span><br><span class="line">        pc.setParent(<span class="string">&quot;com.haoke.dubbo.server&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自定义配置</span></span><br><span class="line">        <span class="type">InjectionConfig</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InjectionConfig</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initMap</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        List&lt;FileOutConfig&gt; focList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        focList.add(<span class="keyword">new</span> <span class="title class_">FileOutConfig</span>(<span class="string">&quot;/templates/mapper.xml.ftl&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">outputFile</span><span class="params">(TableInfo tableInfo)</span> &#123;</span><br><span class="line">                <span class="comment">// 自定义输入文件名称</span></span><br><span class="line">                <span class="keyword">return</span> projectPath + <span class="string">&quot;/src/main/resources/mapper/&quot;</span> +</span><br><span class="line">                    pc.getModuleName()</span><br><span class="line">                    + <span class="string">&quot;/&quot;</span> + tableInfo.getEntityName() + <span class="string">&quot;Mapper&quot;</span> +</span><br><span class="line">                    StringPool.DOT_XML;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        mpg.setCfg(cfg);</span><br><span class="line">        mpg.setTemplate(<span class="keyword">new</span> <span class="title class_">TemplateConfig</span>().setXml(<span class="literal">null</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategy.setSuperEntityClass(<span class="string">&quot;com.haoke.dubbo.server.pojo.BasePojo&quot;</span>);</span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        strategy.setInclude(scanner(<span class="string">&quot;表名&quot;</span>));</span><br><span class="line">        strategy.setSuperEntityColumns(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        strategy.setTablePrefix(pc.getModuleName() + <span class="string">&quot;_&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line">        mpg.setTemplateEngine(<span class="keyword">new</span> <span class="title class_">FreemarkerTemplateEngine</span>());</span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="运行代码"><a href="#运行代码" class="headerlink" title="运行代码"></a>运行代码</h6><p><img src="/posts/1207943057/image-20210316140430615.png" alt="image-20210316140430615"></p><p><img src="/posts/1207943057/image-20210316150113220.png" alt></p><p>只需要entity (pojo)</p><ul><li>@EqualsAndHashCode(callSuper = true)<ul><li>自动生成equals和 hashcode 方法，一般不需要，所以去掉</li></ul></li><li>@Accessors(chain = true)<ul><li>表示，生成的set方法将采用链式编程方式</li></ul></li></ul><h5 id="2-将生成的POJO放到-com-haoke-dubbo-server-pojo-下"><a href="#2-将生成的POJO放到-com-haoke-dubbo-server-pojo-下" class="headerlink" title="2. 将生成的POJO放到 com.haoke.dubbo.server.pojo 下"></a>2. 将生成的POJO放到 <code>com.haoke.dubbo.server.pojo</code> 下</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.dubbo.server.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@TableName(&quot;TB_HOUSE_RESOURCES&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseResources</span> <span class="keyword">extends</span> <span class="title class_">BasePojo</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2471649692631014216L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 房源标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 楼盘id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;ID&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long estateId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 楼号（栋）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String buildingNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单元号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String buildingUnit;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 门牌号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String buildingFloorNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 租金</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer rent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 租赁方式，1-整租，2-合租</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer rentMethod;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付方式，1-付一押一，2-付三押一，3-付六押一，4-年付押一，5-其它</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer paymentMethod;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 户型，如：2室1厅1卫</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String houseType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 建筑面积</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String coveredArea;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用面积</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String useArea;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 楼层，如：8/26</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String floor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 朝向：东、南、西、北</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String orientation;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 装修，1-精装，2-简装，3-毛坯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer decoration;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配套设施， 如：1,2,3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String facilities;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片，最多5张</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String houseDesc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 联系人</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String contact;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 手机号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 看房时间，1-上午，2-中午，3-下午，4-晚上，5-全天</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer time;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 物业费</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String propertyCost;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="房源服务项目结构"><a href="#房源服务项目结构" class="headerlink" title="房源服务项目结构"></a>房源服务项目结构</h3><p><img src="/posts/1207943057/image-20210316100010234.png" alt="image-20210316100010234"></p><p>将房源业务分为接口层面和实现层面，是为了便于组件化维护。</p><ul><li>实现层面是Spring业务，具体实现业务逻辑。</li><li>接口层面作为Dubbo的服务导出。</li></ul><p><code>haoke-manage-dubbo-server-house-resources</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-house-resources<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring接口与其实现模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>haoke-manage-dubbo-server-house-resources-interface<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>haoke-manage-dubbo-server-house-resources-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="房源业务接口"><a href="#房源业务接口" class="headerlink" title="房源业务接口"></a>房源业务接口</h4><p><code>haoke-manage-dubbo-server-house-resources-interface</code></p><ul><li>对外提供的SDK包</li><li>只提供pojo实体类以及接口</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-house-resources<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-house-resources-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="房源业务实现"><a href="#房源业务实现" class="headerlink" title="房源业务实现"></a>房源业务实现</h4><p><code>haoke-manage-server-house-resources-service</code></p><p>房源服务的实现——Spring业务</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-house-resources<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-house-resources-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-house-resources-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="相关配置"><a href="#相关配置" class="headerlink" title="相关配置"></a>相关配置</h4><p><code>application.preperties</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Spring boot application</span></span><br><span class="line"><span class="attr">spring.application.name</span> = <span class="string">haoke-manage-dubbo-server-house-resources</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 数据库</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://82.157.25.25:4002/haoke?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">mycat</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">mycat</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Dubbo配置</span></span><br><span class="line"><span class="comment">##服务的扫描包</span></span><br><span class="line"><span class="attr">dubbo.scan.basePackages</span> = <span class="string">com.haoke.server.api</span></span><br><span class="line"><span class="comment">##服务名称</span></span><br><span class="line"><span class="attr">dubbo.application.name</span> = <span class="string">dubbo-provider-house-resources</span></span><br><span class="line"><span class="attr">dubbo.service.version</span> = <span class="string">1.0.0</span></span><br><span class="line"><span class="comment">##协议以及端口</span></span><br><span class="line"><span class="attr">dubbo.protocol.name</span> = <span class="string">dubbo</span></span><br><span class="line"><span class="attr">dubbo.protocol.port</span> = <span class="string">20880</span></span><br><span class="line"><span class="comment">##zk服务注册中心地址</span></span><br><span class="line"><span class="attr">dubbo.registry.address</span> = <span class="string">zookeeper://8.140.130.91:2181</span></span><br><span class="line"><span class="attr">dubbo.registry.client</span> = <span class="string">zkclient</span></span><br></pre></td></tr></table></figure><h3 id="新增房源"><a href="#新增房源" class="headerlink" title="新增房源"></a>新增房源</h3><h4 id="服务提供方"><a href="#服务提供方" class="headerlink" title="服务提供方"></a>服务提供方</h4><h5 id="Dubbo服务定义"><a href="#Dubbo服务定义" class="headerlink" title="Dubbo服务定义"></a>Dubbo服务定义</h5><p><code>haoke-manage-dubbo-server-house-resources-interface</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.api;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApiHouseResourcesService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> houseResources</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> -1:输入的参数不符合要求，0：数据插入数据库失败，1：成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">saveHouseResources</span><span class="params">(HouseResources houseResources)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="新增房源业务实现"><a href="#新增房源业务实现" class="headerlink" title="新增房源业务实现"></a>新增房源业务实现</h5><blockquote><p>创建SpringBoot应用，实现新增房源服务</p><ol><li>连接数据库——Dao层</li><li>实现CRUD接口——Service层</li></ol></blockquote><p><img src="/posts/1207943057/image-20210317084917963.png" alt="image-20210317084917963"></p><h6 id="Dao层"><a href="#Dao层" class="headerlink" title="Dao层"></a>Dao层</h6><p>MybatisPlus配置类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义包扫描路径</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.haoke.server.mapper&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>HouseResourcesMapper接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.haoke.dubbo.server.pojo.HouseResources;</span><br><span class="line"></span><br><span class="line"><span class="comment">//BaseMapper是MybatisPlus提供的基本CRUD类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HouseResourcesMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;HouseResources&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><h6 id="Service层"><a href="#Service层" class="headerlink" title="Service层"></a>Service层</h6><blockquote><p>此处实现的是spring的服务，为dubbo服务的具体实现细节，无需对外暴露，同时需要进行事务控制和其他判断逻辑</p></blockquote><p>定义接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.service;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HouseResourcesService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> houseResources</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> -1:输入的参数不符合要求，0：数据插入数据库失败，1：成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">saveHouseResources</span><span class="params">(HouseResources houseResources)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写实现类</p><blockquote><p>通用CRUD实现</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.haoke.dubbo.server.pojo.BasePojo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseServiceImpl</span>&lt;T <span class="keyword">extends</span> <span class="title class_">BasePojo</span>&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BaseMapper&lt;T&gt; mapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">queryAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询一条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">queryOne</span><span class="params">(T record)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;(record));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询数据列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">queryListByWhere</span><span class="params">(T record)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;(record));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件分页查询数据列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;T&gt; <span class="title function_">queryPageListByWhere</span><span class="params">(T record, Integer page, Integer rows)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取分页数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.selectPage(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;T&gt;(page, rows), <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;</span><br><span class="line">                (record));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">save</span><span class="params">(T record)</span> &#123;</span><br><span class="line">        record.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        record.setUpdated(record.getCreated());</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.insert(record);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">update</span><span class="params">(T record)</span> &#123;</span><br><span class="line">        record.setUpdated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.updateById(record);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ids批量删除数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">deleteByIds</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.deleteBatchIds(ids);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件删除数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">deleteByWhere</span><span class="params">(T record)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapper.delete(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;(record));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>房源相关实现类——HouseResourcesImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.utils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.service.HouseResourcesService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span><span class="comment">//开启事务</span></span><br><span class="line"><span class="meta">@Service</span><span class="comment">//这是Spring的服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseResourcesServiceImpl</span></span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">BaseServiceImpl</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">HouseResourcesService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveHouseResources</span><span class="params">(HouseResources houseResources)</span> &#123;</span><br><span class="line">        <span class="comment">// 编写校验逻辑，如果校验不通过，返回-1</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(houseResources.getTitle())) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//其他校验以及逻辑省略 ……</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.save(houseResources);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Dubbo服务实现"><a href="#Dubbo服务实现" class="headerlink" title="Dubbo服务实现"></a>Dubbo服务实现</h5><blockquote><p>暴露新增房源的dubbo服务，将接口作为Dubbo服务导出</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.service.HouseResourcesService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现Dubbo，对外暴露服务</span></span><br><span class="line"><span class="meta">@Service(version = &quot;$&#123;dubbo.service.version&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiHoukeResourcesImpl</span> <span class="keyword">implements</span> <span class="title class_">ApiHouseResourcesService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HouseResourcesService resourcesService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveHouseResources</span><span class="params">(HouseResources houseResources)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.resourcesService.saveHouseResources(houseResources);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Dubbo服务启动"><a href="#Dubbo服务启动" class="headerlink" title="Dubbo服务启动"></a>Dubbo服务启动</h5><blockquote><p>启动SpringBoot程序，将Dubbo服务导出到注册中心</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.WebApplicationType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DubboProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(DubboProvider.class)</span><br><span class="line">                .web(WebApplicationType.NONE)<span class="comment">//不是web应用</span></span><br><span class="line">                .run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="启用DubboAdmin"><a href="#启用DubboAdmin" class="headerlink" title="启用DubboAdmin"></a>启用DubboAdmin</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/incubator-dubbo-ops/</span><br><span class="line"></span><br><span class="line">mvn --projects dubbo-admin-server spring-boot:run</span><br></pre></td></tr></table></figure><h6 id="查询dubbo服务提供方"><a href="#查询dubbo服务提供方" class="headerlink" title="查询dubbo服务提供方"></a>查询dubbo服务提供方</h6><p><img src="/posts/1207943057/image-20210317085311342.png" alt="image-20210317085311342"></p><p>dubbo-provider-house-resources,端口为20880</p><h4 id="服务消费方-1"><a href="#服务消费方-1" class="headerlink" title="服务消费方"></a>服务消费方</h4><p><code>haoke-manage-api-server</code></p><ul><li>为前端系统提供RESTful风格接口</li><li>dubbo的消费方</li></ul><p><img src="/posts/1207943057/image-20210317090850987.png" alt="image-20210317090850987"></p><h5 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h5><p>因为dubbo是消费方，需要添加dubbo提供方提供的接口、pojo的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springboot的web支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		api模块———本模块，对外提供接口，作为dubbo的服务消费方</span></span><br><span class="line"><span class="comment">        interface模块————当前依赖，dubbo的服务提供方</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-house-resources-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="消费方配置文件"><a href="#消费方配置文件" class="headerlink" title="消费方配置文件"></a>消费方配置文件</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Spring boot application</span></span><br><span class="line"><span class="attr">spring.application.name</span> = <span class="string">haoke-manage-api-server</span></span><br><span class="line"><span class="attr">server.port</span> = <span class="string">9091</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#logging.level.root=DEBUG</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 应用名称</span></span><br><span class="line"><span class="attr">dubbo.application.name</span> = <span class="string">dubbo-consumer-haoke-manage</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># zk注册中心  服务消费方从注册中心订阅服务</span></span><br><span class="line"><span class="attr">dubbo.registry.address</span> = <span class="string">zookeeper://8.140.130.91:2181</span></span><br><span class="line"><span class="attr">dubbo.registry.client</span> = <span class="string">zkclient</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dubbo.service.version</span> = <span class="string">1.0.0</span></span><br></pre></td></tr></table></figure><h5 id="服务消费方-2"><a href="#服务消费方-2" class="headerlink" title="服务消费方"></a>服务消费方</h5><p><code>HouseResourceService用于调用dubbo服务</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.api.ApiHouseResourcesService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseResourceService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference(version = &quot;$&#123;dubbo.service.version&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApiHouseResourcesService apiHouseResourcesService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(HouseResources houseResources)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.apiHouseResourcesService.saveHouseResources(houseResources);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result==<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="控制层"><a href="#控制层" class="headerlink" title="控制层"></a>控制层</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haoke.api.service.HouseResourceService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;house/resources&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseResourcesController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HouseResourceService houseResourceService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增房源</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> houseResources json数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> HouseResources houseResources)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">bool</span> <span class="operator">=</span> <span class="built_in">this</span>.houseResourceService.save(houseResources);</span><br><span class="line">            <span class="keyword">if</span>(bool)&#123;</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).build();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * test</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;get House Resources&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="测试程序"><a href="#测试程序" class="headerlink" title="测试程序"></a>测试程序</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DubboApiApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DubboApiApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="测试接口"><a href="#测试接口" class="headerlink" title="测试接口"></a>测试接口</h5><p><img src="/posts/1207943057/image-20210317153718529.png" alt="image-20210317153718529"></p><h4 id="前后端整合"><a href="#前后端整合" class="headerlink" title="前后端整合"></a>前后端整合</h4><h5 id="增加model"><a href="#增加model" class="headerlink" title="增加model"></a>增加model</h5><p>新建 <strong>models</strong> 文件夹</p><p><img src="/posts/1207943057/image-20210318101526639.png" alt></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; routerRedux &#125; <span class="keyword">from</span> <span class="string">&#x27;dva/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addHouseResource &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/haoke/haoke&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">&#x27;house&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">effects</span>: &#123;</span><br><span class="line">    *<span class="title function_">submitHouseForm</span>(<span class="params">&#123; payload &#125;, &#123; call &#125;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;page model&quot;</span>)</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">call</span>(addHouseResource, payload);</span><br><span class="line">      message.<span class="title function_">success</span>(<span class="string">&#x27;提交成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="增加services"><a href="#增加services" class="headerlink" title="增加services"></a>增加services</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">addHouseResource</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">&#x27;/haoke/house/resources&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: params</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="修改表单提交地址"><a href="#修改表单提交地址" class="headerlink" title="修改表单提交地址"></a>修改表单提交地址</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">handleSubmit = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; dispatch, form &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    form.<span class="title function_">validateFieldsAndScroll</span>(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">            <span class="keyword">if</span>(values.<span class="property">facilities</span>)&#123;</span><br><span class="line">                values.<span class="property">facilities</span> = values.<span class="property">facilities</span>.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(values.<span class="property">floor_1</span> &amp;&amp; values.<span class="property">floor_2</span>)&#123;</span><br><span class="line">                values.<span class="property">floor</span> = <span class="string">`<span class="subst">$&#123;values.floor_1  &#125;</span>/<span class="subst">$&#123;  values.floor_2&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            values.<span class="property">houseType</span> = <span class="string">`<span class="subst">$&#123;values.houseType_1  &#125;</span>室<span class="subst">$&#123;  values.houseType_2  &#125;</span>厅<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            values.houseType_3  &#125;</span>卫<span class="subst">$&#123;  values.houseType_4  &#125;</span>厨<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            values.houseType_2  &#125;</span>阳台`</span>;</span><br><span class="line">            <span class="keyword">delete</span> values.<span class="property">floor_1</span>;</span><br><span class="line">            <span class="keyword">delete</span> values.<span class="property">floor_2</span>;</span><br><span class="line">            <span class="keyword">delete</span> values.<span class="property">houseType_1</span>;</span><br><span class="line">            <span class="keyword">delete</span> values.<span class="property">houseType_2</span>;</span><br><span class="line">            <span class="keyword">delete</span> values.<span class="property">houseType_3</span>;</span><br><span class="line">            <span class="keyword">delete</span> values.<span class="property">houseType_4</span>;</span><br><span class="line">            <span class="keyword">delete</span> values.<span class="property">houseType_5</span>;</span><br><span class="line">            <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;house/submitHouseForm&#x27;</span>,</span><br><span class="line">                <span class="attr">payload</span>: values,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="通过反向代理解决跨域问题"><a href="#通过反向代理解决跨域问题" class="headerlink" title="通过反向代理解决跨域问题"></a>通过反向代理解决跨域问题</h5><p><a target="_blank" rel="noopener" href="https://umijs.org/zh-CN/config#proxy">https://umijs.org/zh-CN/config#proxy</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">proxy<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    &#x27;/haoke/&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        target<span class="punctuation">:</span> &#x27;http<span class="punctuation">:</span><span class="comment">//127.0.0.1:9091&#x27;,//目标地址</span></span><br><span class="line">        changeOrigin<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        pathRewrite<span class="punctuation">:</span> <span class="punctuation">&#123;</span> &#x27;^/haoke/&#x27;<span class="punctuation">:</span> &#x27;&#x27; <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="comment">//路径覆盖</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>代理效果：</p><p>请求：<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/haoke/house/resources">http://127.0.0.1:8000/haoke/house/resources</a></p><p>实际：<a target="_blank" rel="noopener" href="http://127.0.0.1:9091/house/resources">http://127.0.0.1:9091/house/resources</a></p><h3 id="房源列表"><a href="#房源列表" class="headerlink" title="房源列表"></a>房源列表</h3><p><img src="/posts/1207943057/image-20210319224559982.png" alt="image-20210319224559982"></p><ul><li>PageInfo：返回给服务消费方的数据</li><li>ApiHouseResourcesService:暴露 <em>Dubbo</em> 服务提供方接口</li><li>ApiHaoKeResourcesImpl： <em>Dubbo</em> 服务提供方的实现</li><li>HouseResourcesService： <em>spring</em> 服务层定义</li><li>HouseResourcesServiceImpl：<em>spring</em> 业务的实现</li><li>BaseServiceImpl：<em>Mybatisplus</em> 层访问数据库</li></ul><h4 id="1-定义dubbo服务"><a href="#1-定义dubbo服务" class="headerlink" title="1. 定义dubbo服务"></a>1. 定义dubbo服务</h4><p><code>haoke-manage-server-house-resources-dubbo-interface</code></p><p>Dubbo服务提供方接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApiHouseResourcesService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> houseResources</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> -1:输入的参数不符合要求，0：数据插入数据库失败，1：成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">saveHouseResources</span><span class="params">(HouseResources houseResources)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询房源列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page 当前页</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize 页面大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryCondition 查询条件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PageInfo&lt;HouseResources&gt; <span class="title function_">queryHouseResourcesList</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, HouseResources queryCondition)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-Dubbo生产方"><a href="#2-Dubbo生产方" class="headerlink" title="2. Dubbo生产方"></a>2. Dubbo生产方</h4><p><code>haoke-manage-dubbo-server-house-resources-service</code></p><h5 id="1-定义数据模型"><a href="#1-定义数据模型" class="headerlink" title="1. 定义数据模型"></a>1. 定义数据模型</h5><blockquote><p>服务提供方封装返回的数据</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageInfo</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 总条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer total;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前页</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNum;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一页显示的大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; records = Collections.emptyList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-服务提供方实现"><a href="#2-服务提供方实现" class="headerlink" title="2. 服务提供方实现"></a>2. 服务提供方实现</h5><blockquote><p>dubbo服务的实现实际上为调用Spring的服务层业务</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.service.HouseResourcesService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现Dubbo，对外暴露服务</span></span><br><span class="line"><span class="meta">@Service(version = &quot;$&#123;dubbo.service.version&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiHaokeResourcesImpl</span> <span class="keyword">implements</span> <span class="title class_">ApiHouseResourcesService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HouseResourcesService houseResourcesService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveHouseResources</span><span class="params">(HouseResources houseResources)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.houseResourcesService.saveHouseResources(houseResources);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;HouseResources&gt; <span class="title function_">queryHouseResourcesList</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, HouseResources queryCondition)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.houseResourcesService.queryHouseResourcesList(page, pageSize, queryCondition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-列表业务实现"><a href="#3-列表业务实现" class="headerlink" title="3. 列表业务实现"></a>3. 列表业务实现</h5><h6 id="Dao层-1"><a href="#Dao层-1" class="headerlink" title="Dao层"></a>Dao层</h6><blockquote><p>mybatisplus从数据库获取数据</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageInfo&lt;HouseResources&gt; <span class="title function_">queryHouseResourcesList</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, HouseResources queryCondition)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;HouseResources&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;HouseResources&gt;(queryCondition);</span><br><span class="line">    queryWrapper.orderByDesc(<span class="string">&quot;updated&quot;</span>);<span class="comment">//按更新时间降序排列</span></span><br><span class="line"></span><br><span class="line">    <span class="type">IPage</span> <span class="variable">iPage</span> <span class="operator">=</span> <span class="built_in">super</span>.queryPageList(queryWrapper, page, pageSize);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;HouseResources&gt;(Long.valueOf(iPage.getTotal()).intValue() , page, pageSize, iPage.getRecords());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="Service层-1"><a href="#Service层-1" class="headerlink" title="Service层"></a>Service层</h6><blockquote><p>spring的服务层实现查询列表业务</p></blockquote><p><code>spring服务层定义</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HouseResourcesService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> houseResources</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> -1:输入的参数不符合要求，0：数据插入数据库失败，1：成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">saveHouseResources</span><span class="params">(HouseResources houseResources)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;HouseResources&gt; <span class="title function_">queryHouseResourcesList</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, HouseResources queryCondition)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>spring服务层实现</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.utils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.HouseResources;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.service.HouseResourcesService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span><span class="comment">//开启事务</span></span><br><span class="line"><span class="meta">@Service</span><span class="comment">//这是Spring的服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseResourcesServiceImpl</span></span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">BaseServiceImpl</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">HouseResourcesService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">saveHouseResources</span><span class="params">(HouseResources houseResources)</span> &#123;</span><br><span class="line">        <span class="comment">// 编写校验逻辑，如果校验不通过，返回-1</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(houseResources.getTitle())) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//其他校验以及逻辑省略 ……</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.save(houseResources);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;HouseResources&gt; <span class="title function_">queryHouseResourcesList</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, HouseResources queryCondition)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Object&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;(queryCondition);</span><br><span class="line">        queryWrapper.orderByDesc(<span class="string">&quot;updated&quot;</span>);</span><br><span class="line">        <span class="type">IPage</span> <span class="variable">iPage</span> <span class="operator">=</span> <span class="built_in">super</span>.queryPageList(queryWrapper, page, pageSize);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;HouseResources&gt;(Long.valueOf(iPage.getTotal()).intValue() , page, pageSize, iPage.getRecords());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-Dubbo消费方"><a href="#3-Dubbo消费方" class="headerlink" title="3. Dubbo消费方"></a>3. Dubbo消费方</h4><blockquote><p>实现RESTful风格接口</p></blockquote><p><img src="/posts/1207943057/image-20210319230828751.png" alt="image-20210319230828751"></p><ul><li>TableResult：返回给前端的vo</li><li>Pagination：分页信息</li><li>HouseResourceService：调用服务提供方提供的接口</li><li>HouseResourcesController：服务消费方提供接口给前端调用</li></ul><h5 id="1-定义vo"><a href="#1-定义vo" class="headerlink" title="1. 定义vo"></a>1. 定义vo</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TableResult</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Pagination pagination;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pagination</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer current;</span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">    <span class="keyword">private</span> Integer total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-调用服务提供方"><a href="#2-调用服务提供方" class="headerlink" title="2. 调用服务提供方"></a>2. 调用服务提供方</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TableResult <span class="title function_">queryList</span><span class="params">(HouseResources houseResources, Integer currentPage, Integer pageSize)</span> &#123;</span><br><span class="line">    PageInfo&lt;HouseResources&gt; pageInfo</span><br><span class="line">        = <span class="built_in">this</span>.apiHouseResourcesService.queryHouseResourcesList(currentPage, pageSize, houseResources);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TableResult</span>(</span><br><span class="line">        pageInfo.getRecords(),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Pagination</span>(currentPage, pageSize, pageInfo.getTotal()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-服务消费方提供给前端接口"><a href="#3-服务消费方提供给前端接口" class="headerlink" title="3. 服务消费方提供给前端接口"></a>3. 服务消费方提供给前端接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询房源列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> houseResources</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> currentPage</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span><span class="comment">//完整请求路径是/house/resource/list</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;TableResult&gt; <span class="title function_">list</span><span class="params">(HouseResources houseResources,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@RequestParam(name = &quot;currentPage&quot;, defaultValue = &quot;1&quot;)</span> Integer currentPage,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@RequestParam(name = &quot;pageSize&quot;,defaultValue = &quot;10&quot;)</span> Integer pageSize)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="built_in">this</span>.houseResourceService.queryList(houseResources, currentPage, pageSize));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-测试接口"><a href="#4-测试接口" class="headerlink" title="4. 测试接口"></a>4. 测试接口</h5><p><img src="/posts/1207943057/image-20210320095729934.png" alt="image-20210320095729934"></p><h4 id="4-前后端整合"><a href="#4-前后端整合" class="headerlink" title="4. 前后端整合"></a>4. 前后端整合</h4><p><img src="/posts/1207943057/image-20210320152702837.png" alt="image-20210320152702837"></p><p><img src="/posts/1207943057/image-20210320152848121.png" alt="image-20210320152848121"></p><p><img src="/posts/1207943057/image-20210320152904298.png" alt></p><h5 id="1-修改前端表结构"><a href="#1-修改前端表结构" class="headerlink" title="1. 修改前端表结构"></a>1. 修改前端表结构</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">columns = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;房源编号&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;房源信息&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;图&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;pic&#x27;</span>,</span><br><span class="line">        render : <span class="function">(<span class="params">text, record, index</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ShowPics</span> <span class="attr">pics</span>=<span class="string">&#123;text&#125;</span> /&gt;</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;楼栋&#x27;</span>,</span><br><span class="line">        render : <span class="function">(<span class="params">text, record, index</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;record.buildingFloorNum  &#125;</span>栋<span class="subst">$&#123;record.buildingNum&#125;</span>单元<span class="subst">$&#123;record.buildingUnit&#125;</span>号`</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;户型&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;houseType&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;面积&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;useArea&#x27;</span>,</span><br><span class="line">        render : <span class="function">(<span class="params">text, record, index</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;text&#125;</span>平方`</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;楼层&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;floor&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">        <span class="attr">render</span>: <span class="function">(<span class="params">text, record</span>) =&gt;</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.handleUpdateModalVisible(true, record)&#125;&gt;查看<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Divider</span> <span class="attr">type</span>=<span class="string">&quot;vertical&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">    ),</span><br><span class="line">&#125;,</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure><h5 id="2-自定义图片展示组件"><a href="#2-自定义图片展示组件" class="headerlink" title="2. 自定义图片展示组件"></a>2. 自定义图片展示组件</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Modal</span>, <span class="title class_">Button</span>, <span class="title class_">Carousel</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShowPics</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">  info = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Modal</span>.<span class="title function_">info</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">iconType</span>:<span class="string">&#x27;false&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="string">&#x27;800px&#x27;</span>,</span><br><span class="line">      <span class="attr">okText</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">      <span class="attr">content</span>: (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:650,</span> <span class="attr">height:</span> <span class="attr">400</span>, <span class="attr">lineHeight:400</span>, <span class="attr">textAlign:</span>&quot;<span class="attr">center</span>&quot;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Carousel</span> <span class="attr">autoplay</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;</span></span><br><span class="line"><span class="language-xml">              this.props.pics.split(&#x27;,&#x27;).map((value,index) =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">maxWidth:600</span> ,<span class="attr">maxHeight:400</span>, <span class="attr">margin:</span>&quot;<span class="attr">0</span> <span class="attr">auto</span>&quot; &#125;&#125; <span class="attr">src</span>=<span class="string">&#123;value&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Carousel</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      ),</span><br><span class="line">      <span class="title function_">onOk</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">      <span class="variable language_">super</span>(props);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span>=&#123;</span><br><span class="line">        <span class="attr">btnDisabled</span>: !<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">pics</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">disabled</span>=<span class="string">&#123;this.state.btnDisabled&#125;</span> <span class="attr">icon</span>=<span class="string">&quot;picture&quot;</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;this.info()&#125;&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ShowPics</span>;</span><br></pre></td></tr></table></figure><h5 id="3-model层"><a href="#3-model层" class="headerlink" title="3. model层"></a>3. model层</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; queryResource &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/haoke/houseResource&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">&#x27;houseResource&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">list</span>: [],</span><br><span class="line">      <span class="attr">pagination</span>: &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">effects</span>: &#123;</span><br><span class="line">    *<span class="title function_">fetch</span>(<span class="params">&#123; payload &#125;, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;houseResource fetch&quot;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">yield</span> <span class="title function_">call</span>(queryResource, payload);</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">put</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: response,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">save</span>(<span class="params">state, action</span>) &#123;<span class="comment">// state表示当前model的数据，action表示异步函数 put ，put()中的payload为封装了回调数据的属性</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">data</span>: action.<span class="property">payload</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="4-修改数据请求地址"><a href="#4-修改数据请求地址" class="headerlink" title="4. 修改数据请求地址"></a>4. 修改数据请求地址</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; stringify &#125; <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">queryResource</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">`/haoke/house/resources/list?<span class="subst">$&#123;stringify(params)&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="GraphQL"><a href="#GraphQL" class="headerlink" title="GraphQL"></a>GraphQL</h2><ul><li>使用GraphQL开发房源接口</li><li>实现房源列表查询的接口</li></ul><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><img src="/posts/1207943057/image-20210320175407784.png" alt="image-20210320175407784"></p><p><a target="_blank" rel="noopener" href="https://graphql.cn/">官网地址</a></p><p>一种用于前后端 <strong>数据查询</strong> 方式的规范</p><h4 id="RESTful存在的问题"><a href="#RESTful存在的问题" class="headerlink" title="RESTful存在的问题"></a>RESTful存在的问题</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET http://127.0.0.1/user/1 #查询</span><br><span class="line">POST http://127.0.0.1/user #新增</span><br><span class="line">PUT http://127.0.0.1/user #更新</span><br><span class="line">DELETE http://127.0.0.1/user #删除</span><br></pre></td></tr></table></figure><p><strong>场景一：</strong></p><p>只需某一对象的部分属性，但通过RESTful返回的是这个对象的所有属性</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#请求</span><br><span class="line">GET http<span class="punctuation">:</span><span class="comment">//127.0.0.1/user/1001</span></span><br><span class="line">#响应：</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    id <span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">    name <span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">    age <span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">    address <span class="punctuation">:</span> <span class="string">&quot;北京市&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ……</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>场景二：</strong></p><p>一个需求，要发起多次请求才能完成</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#查询用户信息</span><br><span class="line">GET http<span class="punctuation">:</span><span class="comment">//127.0.0.1/user/1001</span></span><br><span class="line">#响应：</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    id <span class="punctuation">:</span> <span class="number">1001</span><span class="punctuation">,</span></span><br><span class="line">    name <span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">    age <span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">    address <span class="punctuation">:</span> <span class="string">&quot;北京市&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ……</span><br><span class="line"><span class="punctuation">&#125;</span> </span><br><span class="line"></span><br><span class="line">#查询用户的身份证信息</span><br><span class="line">GET http<span class="punctuation">:</span><span class="comment">//127.0.0.1/card/8888</span></span><br><span class="line">#响应：</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    id <span class="punctuation">:</span> <span class="number">8888</span><span class="punctuation">,</span></span><br><span class="line">    name <span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">    cardNumber <span class="punctuation">:</span> <span class="string">&quot;999999999999999&quot;</span><span class="punctuation">,</span></span><br><span class="line">    address <span class="punctuation">:</span> <span class="string">&quot;北京市&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ……</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="GraphQL的优势"><a href="#GraphQL的优势" class="headerlink" title="GraphQL的优势"></a>GraphQL的优势</h4><h5 id="1-按需索取数据"><a href="#1-按需索取数据" class="headerlink" title="1. 按需索取数据"></a>1. 按需索取数据</h5><p>当请求中只有name属性时，响应结果中只包含name属性，如果请求中添加appearsIn属性，那么结果中就会返回appearsIn的值</p><p>演示地址:<a target="_blank" rel="noopener" href="https://graphql.cn/learn/schema/#type-system">https://graphql.cn/learn/schema/#type-system</a></p><h5 id="2-一次查询多个数据"><a href="#2-一次查询多个数据" class="headerlink" title="2. 一次查询多个数据"></a>2. 一次查询多个数据</h5><p><img src="/posts/1207943057/image-20210320181030805.png" alt="image-20210320181030805"></p><p>一次请求，不仅查询到了hero数据，而且还查询到了friends数据。节省了网络请求次数</p><h5 id="3-API的演进无需划分版本"><a href="#3-API的演进无需划分版本" class="headerlink" title="3. API的演进无需划分版本"></a>3. API的演进无需划分版本</h5><p><img src="/posts/1207943057/image-20210320181200692.png" alt="image-20210320181200692"></p><p>当API进行升级时，客户端可以不进行升级，可以等到后期一起升级，这样就大大减少了客户端和服务端的耦合度</p><h4 id="GraphQL查询的规范"><a href="#GraphQL查询的规范" class="headerlink" title="GraphQL查询的规范"></a>GraphQL查询的规范</h4><p>GraphQL定义了一套规范，用来描述语法定义 <a target="_blank" rel="noopener" href="http://graphql.cn/learn/queries/">http://graphql.cn/learn/queries/</a></p><blockquote><p>规范 $\neq$ 实现</p></blockquote><h5 id="字段-Fields"><a href="#字段-Fields" class="headerlink" title="字段 Fields"></a>字段 Fields</h5><p>在GraphQL的查询中，请求结构中包含了所预期结果的结构，这个就是字段。并且响应的结构和请求结构基本一致，这是GraphQL的一个特性，这样就可以让请求发起者很清楚的知道自己想要什么。</p><p><img src="/posts/1207943057/image-20210320204332157.png" alt="image-20210320204332157"></p><h5 id="参数Arguments"><a href="#参数Arguments" class="headerlink" title="参数Arguments"></a>参数Arguments</h5><p>语法：(参数名:参数值)</p><p><img src="/posts/1207943057/image-20210320204448159.png" alt="image-20210320204448159"></p><h5 id="别名-Aliases"><a href="#别名-Aliases" class="headerlink" title="别名 Aliases"></a>别名 Aliases</h5><p>如果一次查询多个 <code>相同对象</code> ，但是 <code>值不同</code> ，这个时候就需要起别名了，否则json的语法就不能通过了</p><p><img src="/posts/1207943057/image-20210320205112431.png" alt="image-20210320205112431"></p><h5 id="片段-Fragments"><a href="#片段-Fragments" class="headerlink" title="片段 Fragments"></a>片段 Fragments</h5><p>查询对的属性如果相同，可以采用片段的方式进行简化定义</p><p><img src="/posts/1207943057/image-20210320205326494.png" alt="image-20210320205326494"></p><h4 id="GraphQL的schema和类型规范"><a href="#GraphQL的schema和类型规范" class="headerlink" title="GraphQL的schema和类型规范"></a>GraphQL的schema和类型规范</h4><p><strong>Schema用于定义数据结构</strong></p><p><a target="_blank" rel="noopener" href="https://graphql.cn/learn/schema/">https://graphql.cn/learn/schema/</a></p><h5 id="Schema定义结构"><a href="#Schema定义结构" class="headerlink" title="Schema定义结构"></a>Schema定义结构</h5><p>每一个 GraphQL 服务都有一个 <code>query</code> 类型，可能有一个 <code>mutation</code> 类型。这两个类型和常规对象类型无差，但是它们之所以特殊，是因为它们定义了每一个 GraphQL 查询的<strong>入口</strong>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">schema &#123; #定义查询</span><br><span class="line">	query: UserQuery</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type UserQuery&#123;# 定义查询的类型</span><br><span class="line">	user(id:ID):User #指定对象以及参数类型</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type User&#123;# 定义对象</span><br><span class="line">	id:ID! #!表示该属性必须不可为空</span><br><span class="line">	name:String</span><br><span class="line">	age:Int</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="标量类型"><a href="#标量类型" class="headerlink" title="标量类型"></a>标量类型</h6><ul><li>Int ：有符号 32 位整数。</li><li>Float ：有符号双精度浮点值。</li><li>String ：UTF‐8 字符序列。</li><li>Boolean ： true 或者 false 。</li><li>ID ：ID 标量类型表示一个唯一标识符，通常用以重新获取对象或者作为缓存中的键</li></ul><p>GraphQL支持自定义类型，比如在graphql-java实现中增加了：Long、Byte等。</p><h6 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">enum Episode&#123;# 定义枚举</span><br><span class="line">	NEWHOPE</span><br><span class="line">	EMPIRE</span><br><span class="line">	JEDI</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type huma&#123;</span><br><span class="line">	id: ID!</span><br><span class="line">	name: String!</span><br><span class="line">	appearsIn: [Episode]! #使用枚举类型  表示一个 Episode 数组</span><br><span class="line">	homePlanet: String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="接口-interface"><a href="#接口-interface" class="headerlink" title="接口 interface"></a>接口 interface</h5><p>一个接口是一个抽象类型，它包含某些字段，而对象类型必须包含这些字段，才能算实现了这个接口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">interface Character&#123;# 定义接口</span><br><span class="line">	id: ID!</span><br><span class="line">	name: String!</span><br><span class="line">	friends: [Character]</span><br><span class="line">	appearsIn: [Episode]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#实现接口</span><br><span class="line">type Human implememts Character&#123;</span><br><span class="line">	id: ID!</span><br><span class="line">	name: String!</span><br><span class="line">	friends: [Character]!</span><br><span class="line">	starship: [Startships]!</span><br><span class="line">	</span><br><span class="line">	totalCredits: Int</span><br><span class="line">&#125;</span><br><span class="line">type Droid implements Character &#123;</span><br><span class="line">	id: ID!</span><br><span class="line">	name: String!</span><br><span class="line">	friends: [Character]</span><br><span class="line">	appearsIn: [Episode]!</span><br><span class="line">	</span><br><span class="line">	primaryFunction: String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="GraphQL的Java实现"><a href="#GraphQL的Java实现" class="headerlink" title="GraphQL的Java实现"></a>GraphQL的Java实现</h3><p>官方只是定义了规范并没有做实现，就需要有第三方来进行实现了</p><p>官网：<a target="_blank" rel="noopener" href="https://www.graphql-java.com/">https://www.graphql-java.com/</a></p><p><img src="/posts/1207943057/image-20210320222151968.png" alt></p><p><a target="_blank" rel="noopener" href="https://www.graphql-java.com/documentation/v16/getting-started/">https://www.graphql-java.com/documentation/v16/getting-started/</a></p><p>graphQL并未发布到maven中央仓库中，需要添加第三方仓库，才能下载到依赖</p><blockquote><p>Maven：若使用mirrors配置镜像，则第三方配置不会生效</p></blockquote><h4 id="1-导入依赖"><a href="#1-导入依赖" class="headerlink" title="1. 导入依赖"></a>1. 导入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>graphql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>bintray-andimarek-graphql-java<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>bintray<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://dl.bintray.com/andimarek/graphql-java<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.graphql-java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>graphql-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-安装插件"><a href="#2-安装插件" class="headerlink" title="2. 安装插件"></a>2. 安装插件</h4><p><img src="/posts/1207943057/image-20210321101340465.png" alt></p><p><img src="/posts/1207943057/image-20210321130341760.png" alt></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">schema &#123;</span><br><span class="line">    query: UserQuery</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type UserQuery&#123;</span><br><span class="line">    user(id:ID): User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type User&#123;</span><br><span class="line">    id: ID!</span><br><span class="line">    name: String</span><br><span class="line">    age: Int</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Java-API实现"><a href="#Java-API实现" class="headerlink" title="Java API实现"></a>Java API实现</h4><h5 id="按需返回"><a href="#按需返回" class="headerlink" title="按需返回"></a>按需返回</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 定义User对象类型</span></span><br><span class="line"><span class="comment">         * type User &#123; #定义对象</span></span><br><span class="line"><span class="comment">         *  id:Long! # !表示该属性是非空项</span></span><br><span class="line"><span class="comment">         *  name:String</span></span><br><span class="line"><span class="comment">         *  age:Int</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">GraphQLObjectType</span> <span class="variable">userType</span> <span class="operator">=</span> newObject()</span><br><span class="line">            .name(<span class="string">&quot;User&quot;</span>)</span><br><span class="line">            .field(newFieldDefinition().name(<span class="string">&quot;id&quot;</span>).type(GraphQLLong))</span><br><span class="line">            .field(newFieldDefinition().name(<span class="string">&quot;name&quot;</span>).type(GraphQLString))</span><br><span class="line">            .field(newFieldDefinition().name(<span class="string">&quot;age&quot;</span>).type(GraphQLInt))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 定义查询的类型</span></span><br><span class="line"><span class="comment">         * type UserQuery &#123; #定义查询的类型</span></span><br><span class="line"><span class="comment">         *  user : User #指定对象</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">GraphQLObjectType</span> <span class="variable">userQuery</span> <span class="operator">=</span> newObject()</span><br><span class="line">            .name(<span class="string">&quot;userQuery&quot;</span>)</span><br><span class="line">            .field(newFieldDefinition()</span><br><span class="line">                   .name(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                   .type(userType)</span><br><span class="line">                   .dataFetcher(<span class="keyword">new</span> <span class="title class_">StaticDataFetcher</span>(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>,<span class="string">&quot;张三&quot;</span>,<span class="number">20</span>)))</span><br><span class="line">                  )</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 定义Schema</span></span><br><span class="line"><span class="comment">         * schema &#123; #定义查询</span></span><br><span class="line"><span class="comment">         *  query: UserQuery</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">GraphQLSchema</span> <span class="variable">graphQLSchema</span> <span class="operator">=</span> GraphQLSchema.newSchema()</span><br><span class="line">            .query(userQuery)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建GraphQL查询器</span></span><br><span class="line">        <span class="type">GraphQL</span> <span class="variable">graphQL</span> <span class="operator">=</span> GraphQL.newGraphQL(graphQLSchema).build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询结果</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">&quot;&#123;user&#123;id,name&#125;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">ExecutionResult</span> <span class="variable">executionResult</span> <span class="operator">=</span> graphQL.execute(query);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印错误</span></span><br><span class="line">        System.out.println(<span class="string">&quot;错误：&quot;</span> + executionResult.getErrors());</span><br><span class="line">        <span class="comment">// 打印数据</span></span><br><span class="line">        System.out.println(<span class="string">&quot;结果：&quot;</span> +(Object) executionResult.toSpecification());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="查询参数的设置"><a href="#查询参数的设置" class="headerlink" title="查询参数的设置"></a>查询参数的设置</h5><p><img src="/posts/1207943057/image-20210321160241482.png" alt="image-20210321160241482"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 定义User对象类型</span></span><br><span class="line"><span class="comment">         * type User &#123; #定义对象</span></span><br><span class="line"><span class="comment">         *  id:Long! # !表示该属性是非空项</span></span><br><span class="line"><span class="comment">         *  name:String</span></span><br><span class="line"><span class="comment">         *  age:Int</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">GraphQLObjectType</span> <span class="variable">userType</span> <span class="operator">=</span> newObject()</span><br><span class="line">            .name(<span class="string">&quot;User&quot;</span>)</span><br><span class="line">            .field(newFieldDefinition().name(<span class="string">&quot;id&quot;</span>).type(GraphQLLong))</span><br><span class="line">            .field(newFieldDefinition().name(<span class="string">&quot;name&quot;</span>).type(GraphQLString))</span><br><span class="line">            .field(newFieldDefinition().name(<span class="string">&quot;age&quot;</span>).type(GraphQLInt))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 定义查询的类型</span></span><br><span class="line"><span class="comment">         * type UserQuery &#123; #定义查询的类型</span></span><br><span class="line"><span class="comment">         *  user : User #指定对象</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">GraphQLObjectType</span> <span class="variable">userQuery</span> <span class="operator">=</span> newObject()</span><br><span class="line">            .name(<span class="string">&quot;userQuery&quot;</span>)</span><br><span class="line">            .field(newFieldDefinition()</span><br><span class="line">                   .name(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                   .argument(GraphQLArgument.newArgument()</span><br><span class="line">                            .name(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">                             .type(<span class="string">&quot;GraphQLLong&quot;</span>)</span><br><span class="line">                            )</span><br><span class="line">                   .type(userType)</span><br><span class="line">                   .dataFetcher(</span><br><span class="line">                       Environment-&gt;&#123;</span><br><span class="line">                            <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> Environment.getArgument(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                            <span class="comment">//查询数据库</span></span><br><span class="line">                            <span class="comment">//TODO</span></span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(id,<span class="string">&quot;张三&quot;</span>,id.intValue()+<span class="number">10</span>);</span><br><span class="line">                        &#125;)</span><br><span class="line">                  )</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 定义Schema</span></span><br><span class="line"><span class="comment">         * schema &#123; #定义查询</span></span><br><span class="line"><span class="comment">         *  query: UserQuery</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">GraphQLSchema</span> <span class="variable">graphQLSchema</span> <span class="operator">=</span> GraphQLSchema.newSchema()</span><br><span class="line">            .query(userQuery)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建GraphQL查询器</span></span><br><span class="line">        <span class="type">GraphQL</span> <span class="variable">graphQL</span> <span class="operator">=</span> GraphQL.newGraphQL(graphQLSchema).build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询结果</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">&quot;&#123;user(id:100)&#123;id,name,age&#125;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">ExecutionResult</span> <span class="variable">executionResult</span> <span class="operator">=</span> graphQL.execute(query);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印错误</span></span><br><span class="line">        System.out.println(<span class="string">&quot;错误：&quot;</span> + executionResult.getErrors());</span><br><span class="line">        <span class="comment">// 打印数据</span></span><br><span class="line">        System.out.println(<span class="string">&quot;结果：&quot;</span> +(Object) executionResult.toSpecification());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-SDL构建Schema"><a href="#3-SDL构建Schema" class="headerlink" title="3. SDL构建Schema"></a>3. SDL构建Schema</h4><blockquote><p>SDL通过插件将GraphQL定义文件转换为java</p></blockquote><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">schema</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="symbol">query</span><span class="punctuation">:</span> UserQuery</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserQuery<span class="punctuation">&#123;</span></span><br><span class="line">    user<span class="punctuation">(</span><span class="symbol">id</span><span class="punctuation">:</span>ID<span class="punctuation">)</span><span class="punctuation">:</span> User</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="symbol">id</span><span class="punctuation">:</span> ID<span class="punctuation">!</span></span><br><span class="line">    <span class="symbol">name</span><span class="punctuation">:</span> String</span><br><span class="line">    <span class="symbol">age</span><span class="punctuation">:</span> Int</span><br><span class="line">    <span class="symbol">card</span><span class="punctuation">:</span> Card</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Card <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="symbol">cardNumber</span><span class="punctuation">:</span>String<span class="punctuation">!</span></span><br><span class="line">    <span class="symbol">userId</span><span class="punctuation">:</span> ID</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLSDLDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">/* 1. 读取资源，进行解析 */</span></span><br><span class="line">        <span class="comment">//资源名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;user.graphql&quot;</span>;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileContent</span> <span class="operator">=</span> IOUtils.toString(GraphQLSDLDemo.class.getClassLoader().getResource(fileName),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">TypeDefinitionRegistry</span> <span class="variable">tyRegistry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchemaParser</span>().parse(fileContent);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 2. 数据查询 */</span></span><br><span class="line">        <span class="type">RuntimeWiring</span> <span class="variable">wiring</span> <span class="operator">=</span> RuntimeWiring.newRuntimeWiring()</span><br><span class="line">                .type(<span class="string">&quot;UserQuery&quot;</span>,builder -&gt;</span><br><span class="line">                        builder.dataFetcher(<span class="string">&quot;user&quot;</span>, Environment-&gt;&#123;</span><br><span class="line">                            <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> Long.parseLong(Environment.getArgument(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                            <span class="type">Card</span> <span class="variable">card</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Card</span>(<span class="string">&quot;number_&quot;</span>+id,id);</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(id,<span class="string">&quot;张三_&quot;</span>+id,id.intValue()+<span class="number">10</span>,card);</span><br><span class="line">                        &#125;)</span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 3. 生成schema */</span></span><br><span class="line">        <span class="type">GraphQLSchema</span> <span class="variable">graphQLSchema</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchemaGenerator</span>().makeExecutableSchema(tyRegistry,wiring);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 4. 根据schema对象生成GraphQL对象 */</span></span><br><span class="line">        <span class="type">GraphQL</span> <span class="variable">graphQL</span> <span class="operator">=</span> GraphQL.newGraphQL(graphQLSchema).build();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">&quot;&#123;user(id:100)&#123;id,name,age,card&#123;cardNumber&#125;&#125;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">ExecutionResult</span> <span class="variable">executionResult</span> <span class="operator">=</span> graphQL.execute(query);</span><br><span class="line"></span><br><span class="line">        System.out.println(executionResult.toSpecification());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210321165322279.png" alt="image-20210321165322279"></p><h3 id="id查询房源接口"><a href="#id查询房源接口" class="headerlink" title="id查询房源接口"></a>id查询房源接口</h3><p><img src="/posts/1207943057/image-20210322110918002.png" alt="image-20210322110918002"></p><h4 id="dubbo服务提供方"><a href="#dubbo服务提供方" class="headerlink" title="dubbo服务提供方"></a>dubbo服务提供方</h4><h5 id="HouseResourcesService——Spring服务的Interface"><a href="#HouseResourcesService——Spring服务的Interface" class="headerlink" title="HouseResourcesService——Spring服务的Interface"></a>HouseResourcesService——Spring服务的Interface</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> HouseResources <span class="title function_">queryHouseResourcesById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><h5 id="HouseResourcesServiceImpl——Spring服务的实现"><a href="#HouseResourcesServiceImpl——Spring服务的实现" class="headerlink" title="HouseResourcesServiceImpl——Spring服务的实现"></a>HouseResourcesServiceImpl——Spring服务的实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> HouseResources <span class="title function_">queryHouseResourcesById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (HouseResources) <span class="built_in">super</span>.queryById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ApiHouseResourcesService——dubbo服务提供方接口"><a href="#ApiHouseResourcesService——dubbo服务提供方接口" class="headerlink" title="ApiHouseResourcesService——dubbo服务提供方接口"></a>ApiHouseResourcesService——dubbo服务提供方接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 实现通过id查询 房源</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @Param id 房源id</span></span><br><span class="line"><span class="comment">    * @return</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">HouseResources <span class="title function_">queryHouseResourcesById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><h5 id="ApiHaokeResourcesImpl——dubbo服务提供方实现"><a href="#ApiHaokeResourcesImpl——dubbo服务提供方实现" class="headerlink" title="ApiHaokeResourcesImpl——dubbo服务提供方实现"></a>ApiHaokeResourcesImpl——dubbo服务提供方实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> HouseResources <span class="title function_">queryHouseResourcesById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> houseResourcesService.queryHouseResourcesById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="dubbo服务消费方"><a href="#dubbo服务消费方" class="headerlink" title="dubbo服务消费方"></a>dubbo服务消费方</h4><p><strong>HouseResourceService</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reference(version = &quot;$&#123;dubbo.service.version&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> ApiHouseResourcesService apiHouseResourcesService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 根据id查询房源数据</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @Param id</span></span><br><span class="line"><span class="comment">    * @Return</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line"><span class="keyword">public</span> HouseResources <span class="title function_">queryHouseResourcesById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">    <span class="comment">//调用dubbo服务查询数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.apiHouseResourcesService.queryHouseResourcesById(id);</span><br></pre></td></tr></table></figure><h4 id="GraphQL接口"><a href="#GraphQL接口" class="headerlink" title="GraphQL接口"></a>GraphQL接口</h4><h5 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>bintray-andimarek-graphql-java<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>bintray<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://dl.bintray.com/andimarek/graphql-java<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--导入graphql依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.graphql-java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>graphql-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="GraphQL定义"><a href="#GraphQL定义" class="headerlink" title="GraphQL定义"></a>GraphQL定义</h5><p>haoke.graphql</p><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">schema</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="symbol">query</span><span class="punctuation">:</span> HaokeQuery</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HaokeQuery<span class="punctuation">&#123;</span>       </span><br><span class="line">	<span class="comment"># 通过Id查询房源信息</span></span><br><span class="line">    HouseResources<span class="punctuation">(</span><span class="symbol">id</span><span class="punctuation">:</span>ID<span class="punctuation">)</span><span class="punctuation">:</span> HouseResources</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HouseResources<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="symbol">id</span><span class="punctuation">:</span>ID<span class="punctuation">!</span></span><br><span class="line">    <span class="symbol">title</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">estateId</span><span class="punctuation">:</span>ID</span><br><span class="line">    <span class="symbol">buildingNum</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">buildingUnit</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">buildingFloorNum</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">rent</span><span class="punctuation">:</span>Int</span><br><span class="line">    <span class="symbol">rentMethod</span><span class="punctuation">:</span>Int</span><br><span class="line">    <span class="symbol">paymentMethod</span><span class="punctuation">:</span>Int</span><br><span class="line">    <span class="symbol">houseType</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">coveredArea</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">useArea</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">floor</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">orientation</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">decoration</span><span class="punctuation">:</span>Int</span><br><span class="line">    <span class="symbol">facilities</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">pic</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">houseDesc</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">contact</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">mobile</span><span class="punctuation">:</span>String</span><br><span class="line">    <span class="symbol">time</span><span class="punctuation">:</span>Int</span><br><span class="line">    <span class="symbol">propertyCost</span><span class="punctuation">:</span>String</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="GraphQL组件"><a href="#GraphQL组件" class="headerlink" title="GraphQL组件"></a>GraphQL组件</h5><p>graphql —— Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//将GraphQL对象注入IoC容器，并完成GraphQL的初始化</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLProvider</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> GraphQL graphQL;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HouseResourceService houseResourceService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span><span class="comment">//在IoC容器初始化时运行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="comment">//导入graphql脚本</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> ResourceUtils.getFile(<span class="string">&quot;classpath:haoke.graphql&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化graphql</span></span><br><span class="line">        <span class="built_in">this</span>.graphQL = GraphQL.newGraphQL(<span class="comment">//schema &#123; query: HaokeQuery&#125;</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SchemaGenerator</span>().makeExecutableSchema(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">SchemaParser</span>().parse(file),<span class="comment">//TypeDefinitionRegistry</span></span><br><span class="line">                        RuntimeWiring.newRuntimeWiring()<span class="comment">//RuntimeWiring</span></span><br><span class="line">                                .type(<span class="string">&quot;HaokeQuery&quot;</span>,builder -&gt;</span><br><span class="line">                                        builder.dataFetcher(<span class="string">&quot;HouseResources&quot;</span>, Environment-&gt;&#123;</span><br><span class="line">                                            <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> Long.parseLong(Environment.getArgument(<span class="string">&quot;id&quot;</span>));</span><br><span class="line"></span><br><span class="line">                                            <span class="keyword">return</span> <span class="built_in">this</span>.houseResourceService.queryHouseResourcesById(id);</span><br><span class="line">                                        &#125;)</span><br><span class="line">                                        )</span><br><span class="line">                                .build()</span><br><span class="line">                )</span><br><span class="line">        ).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    GraphQL <span class="title function_">graphQL</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.graphQL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="暴露接口"><a href="#暴露接口" class="headerlink" title="暴露接口"></a>暴露接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;graphql&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GraphQL graphQL;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">graphql</span><span class="params">(<span class="meta">@RequestParam(&quot;query&quot;)</span>String query)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.graphQL.execute(query).toSpecification();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p><img src="/posts/1207943057/image-20210322111758197-1623733053892.png" alt="image-20210322111758197"></p><h3 id="GraphQL组件获取的优化"><a href="#GraphQL组件获取的优化" class="headerlink" title="GraphQL组件获取的优化"></a>GraphQL组件获取的优化</h3><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p><img src="/posts/1207943057/image-20210322114358743.png" alt="image-20210322114358743"></p><p>每当增加查询时，都需要修改该方法</p><blockquote><p>改进思路</p></blockquote><ol><li>编写接口</li><li>所有实现查询的逻辑都实现该接口</li><li>在GraphQLProvider中使用该接口的实现类进行处理</li><li>以后新增查询逻辑只需增加实现类即可</li></ol><h4 id="1-编写MyDataFetcher接口"><a href="#1-编写MyDataFetcher接口" class="headerlink" title="1. 编写MyDataFetcher接口"></a>1. 编写MyDataFetcher接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.graphql;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> graphql.schema.DataFetchingEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyDataFetcher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询名称</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">fieldName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 具体实现数据查询的逻辑</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> environment</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">dataFetcher</span><span class="params">(DataFetchingEnvironment environment)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-实现MyDataFetcher"><a href="#2-实现MyDataFetcher" class="headerlink" title="2. 实现MyDataFetcher"></a>2. 实现MyDataFetcher</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseResourcesDataFetcher</span> <span class="keyword">implements</span> <span class="title class_">MyDataFetcher</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HouseResourceService houseResourceService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fieldName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HouseResources&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">dataFetcher</span><span class="params">(DataFetchingEnvironment environment)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> Long.parseLong(environment.getArgument(<span class="string">&quot;id&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.houseResourceService.queryHouseResourcesById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-修改GraphQLProvider"><a href="#3-修改GraphQLProvider" class="headerlink" title="3. 修改GraphQLProvider"></a>3. 修改GraphQLProvider</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.graphQL = GraphQL.newGraphQL(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">SchemaGenerator</span>().makeExecutableSchema(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SchemaParser</span>().parse(file),<span class="comment">//TypeDefinitionRegistry</span></span><br><span class="line">        RuntimeWiring.newRuntimeWiring()<span class="comment">//RuntimeWiring</span></span><br><span class="line">        .type(<span class="string">&quot;HaokeQuery&quot;</span>,builder -&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (MyDataFetcher myDataFetcher : myDataFetchers) &#123;</span><br><span class="line">                builder.dataFetcher(</span><br><span class="line">                    myDataFetcher.fieldName(),</span><br><span class="line">                    Environment-&gt;myDataFetcher.dataFetcher(Environment)</span><br><span class="line">                 );</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> builder;</span><br><span class="line">        &#125;</span><br><span class="line">     )</span><br><span class="line">     .build()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="房源接口-GraphQL"><a href="#房源接口-GraphQL" class="headerlink" title="房源接口(GraphQL)"></a>房源接口(GraphQL)</h2><h3 id="首页轮播广告"><a href="#首页轮播广告" class="headerlink" title="首页轮播广告"></a>首页轮播广告</h3><h4 id="1-数据结构"><a href="#1-数据结构" class="headerlink" title="1. 数据结构"></a>1. 数据结构</h4><p>请求地址：</p><p><img src="/posts/1207943057/image-20210324162901912.png" alt="image-20210324162901912"></p><p>响应：</p><p><img src="/posts/1207943057/image-20210324162830267.png" alt></p><p>所以，数据只需要返回图片链接即可</p><h4 id="2-数据表设计"><a href="#2-数据表设计" class="headerlink" title="2. 数据表设计"></a>2. 数据表设计</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">use haoke;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_ad` (</span><br><span class="line">`id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`type` <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;广告类型&#x27;</span>,</span><br><span class="line">`title` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;描述&#x27;</span>,</span><br><span class="line">`url` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片URL地址&#x27;</span>,</span><br><span class="line">`created` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`updated` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;广告表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_ad` (`id`, `type`, `title`, `url`, `created`, `updated`) <span class="keyword">VALUES</span> (</span><br><span class="line"><span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;UniCity万科天空之城&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;https://haoke-1257323542.cos.ap-beijing.myqcloud.com/ad-swipes/1.jpg&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;2021-3-24 16:36:11&#x27;</span>,<span class="string">&#x27;2021-3-24 16:36:16&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_ad` (`id`, `type`, `title`, `url`, `created`, `updated`) <span class="keyword">VALUES</span> (</span><br><span class="line"><span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;天和尚海庭前&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;https://haoke-1257323542.cos.ap-beijing.myqcloud.com/ad-swipes/2.jpg&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;2021-3-24 16:36:43&#x27;</span>,<span class="string">&#x27;2021-3-24 16:36:37&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_ad` (`id`, `type`, `title`, `url`, `created`, `updated`) <span class="keyword">VALUES</span> (</span><br><span class="line"><span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;[奉贤 南桥] 光语著&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;https://haoke-1257323542.cos.ap-beijing.myqcloud.com/ad-swipes/3.jpg&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;2021-3-24 16:38:32&#x27;</span>,<span class="string">&#x27;2021-3-24 16:38:26&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_ad` (`id`, `type`, `title`, `url`, `created`, `updated`) <span class="keyword">VALUES</span> (</span><br><span class="line"><span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;[上海周边 嘉兴] 融创海逸长洲&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;https://haoke-1257323542.cos.ap-beijing.myqcloud.com/ad-swipes/4.jpg&#x27;</span>, </span><br><span class="line"><span class="string">&#x27;2021-3-24 16:39:10&#x27;</span>,<span class="string">&#x27;2021-3-24 16:39:13&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="3-实现查询接口"><a href="#3-实现查询接口" class="headerlink" title="3. 实现查询接口"></a>3. 实现查询接口</h4><p><code>dubbo服务提供方</code></p><h5 id="1-创建工程"><a href="#1-创建工程" class="headerlink" title="1. 创建工程"></a>1. 创建工程</h5><p><img src="/posts/1207943057/image-20210325112409709.png" alt></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--haoke-manage-dubbo-server-ad-interface--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--haoke-manage-dubbo-server-ad-service--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-ad-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="2-appplication-properties"><a href="#2-appplication-properties" class="headerlink" title="2.appplication.properties"></a>2.appplication.properties</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Spring boot application</span></span><br><span class="line"><span class="attr">spring.application.name</span> = <span class="string">haoke-manage-dubbo-server-ad</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 数据库</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://8.140.130.91:3306/myhome\</span></span><br><span class="line"><span class="string">  ?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;autoReconnect=true&amp;allowMultiQueries=true</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># hikari设置</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.maximum-pool-size</span>=<span class="string">60</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.idle-timeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.connection-timeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.validation-timeout</span>=<span class="string">3000</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.login-timeout</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">spring.datasource.hikari.max-lifetime</span>=<span class="string">60000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 服务的扫描包</span></span><br><span class="line"><span class="attr">dubbo.scan.basePackages</span> = <span class="string">com.haoke.server.api</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 应用名称</span></span><br><span class="line"><span class="attr">dubbo.application.name</span> = <span class="string">dubbo-provider-ad</span></span><br><span class="line"><span class="attr">dubbo.service.version</span> = <span class="string">1.0.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 协议以及端口</span></span><br><span class="line"><span class="attr">dubbo.protocol.name</span> = <span class="string">dubbo</span></span><br><span class="line"><span class="attr">dubbo.protocol.port</span> = <span class="string">21880</span></span><br><span class="line"><span class="comment"># zk注册中心</span></span><br><span class="line"><span class="attr">dubbo.registry.address</span> = <span class="string">zookeeper://8.140.130.91:2181</span></span><br><span class="line"><span class="attr">dubbo.registry.client</span> = <span class="string">zkclient</span></span><br></pre></td></tr></table></figure><h5 id="3-Dao层"><a href="#3-Dao层" class="headerlink" title="3.Dao层"></a>3.Dao层</h5><h6 id="POJO-1"><a href="#POJO-1" class="headerlink" title="POJO"></a>POJO</h6><p><img src="/posts/1207943057/image-20210325115643885.png" alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_ad&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ad</span> <span class="keyword">extends</span> <span class="title class_">BasePojo</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">493439243433085768L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//广告类型</span></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line">    <span class="comment">//描述</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//&#x27;图片URL地址</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApiAdService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询广告数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 广告类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page 页数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize 每页显示的数据条数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PageInfo&lt;Ad&gt; <span class="title function_">queryAdList</span><span class="params">(Integer type, Integer page, Integer pageSize)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="AdMapper"><a href="#AdMapper" class="headerlink" title="AdMapper"></a>AdMapper</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Ad&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><h6 id="MybatisPlusConfig"><a href="#MybatisPlusConfig" class="headerlink" title="MybatisPlusConfig"></a>MybatisPlusConfig</h6><p>分页配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.haoke.server.mapper&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>();</span><br><span class="line">        paginationInnerInterceptor.setDbType(DbType.MYSQL);</span><br><span class="line"></span><br><span class="line">        interceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-Service层"><a href="#4-Service层" class="headerlink" title="4.Service层"></a>4.Service层</h5><p>实现业务</p><p><img src="/posts/1207943057/image-20210325133234793-16487887911294.png" alt></p><p>编写接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdService</span> &#123;</span><br><span class="line">    PageInfo&lt;Ad&gt; <span class="title function_">queryAdList</span><span class="params">(Ad ad, Integer page, Integer pageSize)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.service.AdService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.service.BaseServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AdService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;Ad&gt; <span class="title function_">queryAdList</span><span class="params">(Ad ad, Integer page, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="type">QueryWrapper</span> <span class="variable">queryWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">        queryWrapper.orderByDesc(<span class="string">&quot;updated&quot;</span>);</span><br><span class="line">        <span class="comment">//按广告的类型查询</span></span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;type&quot;</span>,ad.getType());</span><br><span class="line"></span><br><span class="line">        <span class="type">IPage</span> <span class="variable">iPage</span> <span class="operator">=</span> <span class="built_in">super</span>.queryPageList(queryWrapper,page,pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(Long.valueOf(iPage.getTotal()).intValue(),page,pageSize,iPage.getRecords());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5-dubbo服务实现类"><a href="#5-dubbo服务实现类" class="headerlink" title="5.dubbo服务实现类"></a>5.dubbo服务实现类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApiAdService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询广告数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 广告类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page 页数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize 每页显示的数据条数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PageInfo&lt;Ad&gt; <span class="title function_">queryAdList</span><span class="params">(Integer type, Integer page, Integer pageSize)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.service.AdService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(version = &quot;$&#123;dubbo.service.version&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiAdServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ApiAdService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdService adService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;Ad&gt; <span class="title function_">queryAdList</span><span class="params">(Integer type, Integer page, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="type">Ad</span> <span class="variable">ad</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ad</span>();</span><br><span class="line">        ad.setType(type);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.adService.queryAdList(ad,page,pageSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="6-编写启动类"><a href="#6-编写启动类" class="headerlink" title="6.编写启动类"></a>6.编写启动类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.WebApplicationType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdDubboProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(AdDubboProvider.class)</span><br><span class="line">                .web(WebApplicationType.NONE)<span class="comment">//非web应用</span></span><br><span class="line">                .run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-API实现-Dubbo消费方"><a href="#4-API实现-Dubbo消费方" class="headerlink" title="4.API实现(Dubbo消费方)"></a>4.API实现(Dubbo消费方)</h4><h5 id="1-导入依赖-1"><a href="#1-导入依赖-1" class="headerlink" title="1. 导入依赖"></a>1. 导入依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ad依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-ad-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="2-编写WebResult"><a href="#2-编写WebResult" class="headerlink" title="2. 编写WebResult"></a>2. 编写WebResult</h5><p><img src="/posts/1207943057/image-20210325140008394.png" alt="image-20210325140008394"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnore;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebResult</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> status;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> WebResult <span class="title function_">ok</span><span class="params">(List&lt;?&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebResult</span>(<span class="number">200</span>, <span class="string">&quot;成功&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> WebResult <span class="title function_">ok</span><span class="params">(List&lt;?&gt; list, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebResult</span>(<span class="number">200</span>, msg, list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">        data.put(<span class="string">&quot;list&quot;</span>, <span class="built_in">this</span>.list);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getMeta</span><span class="params">()</span> &#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; meta = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">        meta.put(<span class="string">&quot;msg&quot;</span>, <span class="built_in">this</span>.msg);</span><br><span class="line">        meta.put(<span class="string">&quot;status&quot;</span>, <span class="built_in">this</span>.status);</span><br><span class="line">        <span class="keyword">return</span> meta;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-编写Service"><a href="#3-编写Service" class="headerlink" title="3.编写Service"></a>3.编写Service</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.haoke.api.vo.WebResult;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.api.ApiAdService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference(version = &quot;1.0.0&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ApiAdService apiAdService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;Ad&gt; <span class="title function_">queryAdList</span><span class="params">(Integer type, Integer page, Integer pageSize)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.apiAdService.queryAdList(type, page, pageSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-Controller"><a href="#4-Controller" class="headerlink" title="4.Controller"></a>4.Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haoke.api.service.AdService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.api.vo.WebResult;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.CrossOrigin;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ad&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span><span class="comment">//允许跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdService adService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 首页广告位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> WebResult <span class="title function_">queryIndexad</span><span class="params">()</span>&#123;</span><br><span class="line">        PageInfo&lt;Ad&gt; pageInfo = <span class="built_in">this</span>.adService.queryAdList(<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Ad&gt; ads = pageInfo.getRecords();</span><br><span class="line">        List&lt;Map&lt;String,Object&gt;&gt; data = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Ad ad : ads) &#123;</span><br><span class="line">            Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            map.put(<span class="string">&quot;original&quot;</span>,ad.getUrl());</span><br><span class="line">            data.add(map);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> WebResult.ok(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h5><p><img src="/posts/1207943057/image-20210325152651651.png" alt="image-20210325152651651"></p><h4 id="5-整合前端系统"><a href="#5-整合前端系统" class="headerlink" title="5. 整合前端系统"></a>5. 整合前端系统</h4><p>修改home.js文件中请求地址</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> swipe = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&#x27;http://127.0.0.1:9091/ad&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(data.<span class="property">data</span>.<span class="property">list</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210325153833335.png" alt="image-20210325153833335"></p><p>跨域问题：</p><p><img src="/posts/1207943057/image-20210325154405802.png" alt="image-20210325154405802"></p><p><img src="/posts/1207943057/image-20210325154518654.png" alt="image-20210325154518654"></p><h4 id="6-广告的GraphQL接口"><a href="#6-广告的GraphQL接口" class="headerlink" title="6. 广告的GraphQL接口"></a>6. 广告的GraphQL接口</h4><h5 id="1-目标数据结构"><a href="#1-目标数据结构" class="headerlink" title="1. 目标数据结构"></a>1. 目标数据结构</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;list&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;original&quot;</span>: <span class="string">&quot;http://itcast-haoke.oss-cnqingdao.aliyuncs.com/images/2018/11/26/15432030275359146.jpg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;original&quot;</span>: <span class="string">&quot;http://itcast-haoke.oss-cnqingdao.aliyuncs.com/images/2018/11/26/15432029946721854.jpg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;original&quot;</span>: <span class="string">&quot;http://itcast-haoke.oss-cnqingdao.aliyuncs.com/images/2018/11/26/1543202958579877.jpg&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-graphql定义语句"><a href="#2-graphql定义语句" class="headerlink" title="2. graphql定义语句"></a>2. graphql定义语句</h5><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> HaokeQuery<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">#分页查询房源信息-应用于前台房源信息</span></span><br><span class="line">    HouseResourcesList<span class="punctuation">(</span><span class="symbol">page</span><span class="punctuation">:</span>Int, <span class="symbol">pageSize</span><span class="punctuation">:</span>Int<span class="punctuation">)</span><span class="punctuation">:</span>TableResult</span><br><span class="line">    <span class="comment"># 通过Id查询房源信息</span></span><br><span class="line">    HouseResources<span class="punctuation">(</span><span class="symbol">id</span><span class="punctuation">:</span>ID<span class="punctuation">)</span><span class="punctuation">:</span> HouseResources</span><br><span class="line"></span><br><span class="line">    <span class="comment">#首页广告图-应用于前台首页</span></span><br><span class="line">    <span class="symbol">IndexAdList</span><span class="punctuation">:</span> IndexAdResult</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IndexAdResult<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="symbol">list</span><span class="punctuation">:</span><span class="punctuation">[</span>IndexAdResultData<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IndexAdResultData<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="symbol">original</span><span class="punctuation">:</span> String</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="3-根据GraphQL结构编写VO"><a href="#3-根据GraphQL结构编写VO" class="headerlink" title="3. 根据GraphQL结构编写VO"></a>3. 根据GraphQL结构编写VO</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.vo.ad.index;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexAdResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IndexAdResultData&gt; list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.vo.ad.index;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexAdResultData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String original;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-IndexAdDataFetcher"><a href="#4-IndexAdDataFetcher" class="headerlink" title="4. IndexAdDataFetcher"></a>4. IndexAdDataFetcher</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.graphql.myDataFetcherImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haoke.api.graphql.MyDataFetcher;</span><br><span class="line"><span class="keyword">import</span> com.haoke.api.service.AdService;</span><br><span class="line"><span class="keyword">import</span> com.haoke.api.vo.WebResult;</span><br><span class="line"><span class="keyword">import</span> com.haoke.api.vo.ad.index.IndexAdResult;</span><br><span class="line"><span class="keyword">import</span> com.haoke.api.vo.ad.index.IndexAdResultData;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.pojo.Ad;</span><br><span class="line"><span class="keyword">import</span> com.haoke.server.vo.PageInfo;</span><br><span class="line"><span class="keyword">import</span> graphql.schema.DataFetchingEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexAdDataFetcher</span> <span class="keyword">implements</span> <span class="title class_">MyDataFetcher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdService adService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fieldName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;IndexAdList&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">dataFetcher</span><span class="params">(DataFetchingEnvironment environment)</span> &#123;</span><br><span class="line">        PageInfo&lt;Ad&gt; pageInfo = <span class="built_in">this</span>.adService.queryAdList(<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Ad&gt; ads = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">        List&lt;IndexAdResultData&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Ad ad : ads) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">IndexAdResultData</span>(ad.getUrl()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IndexAdResult</span>(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5-测试"><a href="#5-测试" class="headerlink" title="5. 测试"></a>5. 测试</h5><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> 	IndexAdList<span class="punctuation">&#123;</span></span><br><span class="line">    list<span class="punctuation">&#123;</span></span><br><span class="line">      original</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210325212209112.png" alt="image-20210325212209112"></p><h4 id="7-GraphQL客户端"><a href="#7-GraphQL客户端" class="headerlink" title="7. GraphQL客户端"></a>7. GraphQL客户端</h4><p><img src="/posts/1207943057/image-20210325213959837.png" alt="image-20210325213959837"></p><p>参考文档：<a target="_blank" rel="noopener" href="https://www.apollographql.com/docs/react/get-started/">https://www.apollographql.com/docs/react/get-started/</a></p><h5 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1. 安装依赖"></a>1. 安装依赖</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @apollo/client graphql</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210325213654529.png" alt="image-20210325213654529"></p><h5 id="2-创建客户端"><a href="#2-创建客户端" class="headerlink" title="2. 创建客户端"></a>2. 创建客户端</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApolloClient</span>, gql &#125; <span class="keyword">from</span> <span class="string">&#x27;@apollo/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title class_">ApolloClient</span>(&#123;</span><br><span class="line">  <span class="attr">uri</span>: <span class="string">&#x27;http://127.0.0.1:9091/graphql&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="3-定义查询"><a href="#3-定义查询" class="headerlink" title="3. 定义查询"></a>3. 定义查询</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义查询</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">GET_INDEX_ADS</span> = gql`<span class="language-graphql"></span></span><br><span class="line"><span class="language-graphql"><span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-graphql">IndexAdList<span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-graphql">list<span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-graphql">original</span></span><br><span class="line"><span class="language-graphql"><span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-graphql"><span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-graphql"><span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-graphql">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> swipe = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    client.<span class="title function_">query</span>(&#123;<span class="attr">query</span>: <span class="variable constant_">GET_INDEX_ADS</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span></span><br><span class="line">                                              <span class="title function_">resolve</span>(result.<span class="property">data</span>.<span class="property">IndexAdList</span>.<span class="property">list</span>));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="4-测试"><a href="#4-测试" class="headerlink" title="4. 测试"></a>4. 测试</h5><p><img src="/posts/1207943057/image-20210325215219807.png" alt="image-20210325215219807"></p><p>两个问题：</p><ol><li>GraphQL服务没有支持cross,Controller上标注@CrossOrigin</li><li>Apollo Client发起的数据请求为POST请求，现在实现的GraphQL仅仅实现了GET请求处理</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> graphql.GraphQL;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;graphql&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@CrossOrigin</span><span class="comment">//添加跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GraphQL graphQL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">MAPPER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">graphql</span><span class="params">(<span class="meta">@RequestParam(&quot;query&quot;)</span>String query)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.graphQL.execute(query).toSpecification();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">postGraphql</span><span class="params">(<span class="meta">@RequestBody</span> String json)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">JsonNode</span> <span class="variable">jsonNode</span> <span class="operator">=</span> MAPPER.readTree(json);</span><br><span class="line">            <span class="keyword">if</span>(jsonNode.has(<span class="string">&quot;query&quot;</span>))&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> jsonNode.get(<span class="string">&quot;query&quot;</span>).asText();</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.graphQL.execute(query).toSpecification();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    Map&lt;String,Object&gt; error = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        error.put(<span class="string">&quot;status&quot;</span>,<span class="number">500</span>);</span><br><span class="line">        error.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;查询出错&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210325220325732.png" alt="image-20210325220325732"></p><h3 id="房源信息列表"><a href="#房源信息列表" class="headerlink" title="房源信息列表"></a>房源信息列表</h3><h4 id="1-查询语句定义"><a href="#1-查询语句定义" class="headerlink" title="1. 查询语句定义"></a>1. 查询语句定义</h4><p><strong>haoke.graphql</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">schema &#123;</span><br><span class="line">    query: HaokeQuery</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type HaokeQuery&#123;</span><br><span class="line">    #分页查询房源信息-应用于前台房源信息</span><br><span class="line">    HouseResourcesList(page:Int, pageSize:Int):TableResult</span><br><span class="line">    # 通过Id查询房源信息</span><br><span class="line">    HouseResources(id:ID): HouseResources</span><br><span class="line"></span><br><span class="line">    #首页广告图-应用于前台首页</span><br><span class="line">    IndexAdList: IndexAdResult</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type HouseResources&#123;</span><br><span class="line">    id:ID!</span><br><span class="line">    title:String</span><br><span class="line">    estateId:ID</span><br><span class="line">    buildingNum:String</span><br><span class="line">    buildingUnit:String</span><br><span class="line">    buildingFloorNum:String</span><br><span class="line">    rent:Int</span><br><span class="line">    rentMethod:Int</span><br><span class="line">    paymentMethod:Int</span><br><span class="line">    houseType:String</span><br><span class="line">    coveredArea:String</span><br><span class="line">    useArea:String</span><br><span class="line">    floor:String</span><br><span class="line">    orientation:String</span><br><span class="line">    decoration:Int</span><br><span class="line">    facilities:String</span><br><span class="line">    pic:String</span><br><span class="line">    houseDesc:String</span><br><span class="line">    contact:String</span><br><span class="line">    mobile:String</span><br><span class="line">    time:Int</span><br><span class="line">    propertyCost:String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type TableResult&#123;</span><br><span class="line">    list: [HouseResources]</span><br><span class="line">    pagination: Pagination</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Pagination&#123;</span><br><span class="line">    current:Int</span><br><span class="line">    pageSize:Int</span><br><span class="line">    total:Int</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-DataFetcher"><a href="#2-DataFetcher" class="headerlink" title="2.DataFetcher"></a>2.DataFetcher</h4><p><strong>HouseResourcesListDataFetcher</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseResourcesListDataFetcher</span> <span class="keyword">implements</span> <span class="title class_">MyDataFetcher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HouseResourceService houseResourceService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fieldName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HouseResourcesList&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">dataFetcher</span><span class="params">(DataFetchingEnvironment environment)</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">page</span> <span class="operator">=</span> environment.getArgument(<span class="string">&quot;page&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(page == <span class="literal">null</span>)&#123;</span><br><span class="line">            page = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pageSize</span> <span class="operator">=</span> environment.getArgument(<span class="string">&quot;pageSize&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(pageSize == <span class="literal">null</span>)&#123;</span><br><span class="line">            pageSize = <span class="number">5</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.houseResourceService.queryList(<span class="literal">null</span>, page, pageSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210322134830161.png" alt="image-20210322134830161"></p><h4 id="3-GraphQL参数"><a href="#3-GraphQL参数" class="headerlink" title="3.GraphQL参数"></a>3.GraphQL参数</h4><p>问题分析：上述 <code>首页轮播广告查询接口</code> 中的参数是固定的</p><p><img src="/posts/1207943057/image-20210327101345725.png" alt="image-20210327101345725"></p><p>实际应用中要实现根据前端的请求参数设置参数查询</p><p><a target="_blank" rel="noopener" href="https://graphql.cn/learn/queries/#variables">https://graphql.cn/learn/queries/#variables</a></p><p>一种办法使直接将参数动态的设置到请求体(POST)或URL(GET)中，缺点就是可以直接通过修改查询字符串来自行获取数据。</p><p>GraphQL 拥有一级方法将动态值提取到查询之外，然后作为分离的字典传进去。这些动态值即称为<strong>变量</strong>。</p><p><img src="/posts/1207943057/image-20210327101912684.png" alt="image-20210327101912684"></p><h4 id="前台系统发送的参数分析"><a href="#前台系统发送的参数分析" class="headerlink" title="前台系统发送的参数分析"></a>前台系统发送的参数分析</h4><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> hk<span class="punctuation">(</span><span class="variable">$id</span>:ID<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line"> 	HouseResources<span class="punctuation">(</span><span class="symbol">id</span><span class="punctuation">:</span><span class="variable">$id</span>)<span class="punctuation">&#123;</span></span><br><span class="line">    id</span><br><span class="line">    title</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210327102625196.png" alt="image-20210327102625196"></p><p><img src="/posts/1207943057/image-20210327102534537.png" alt="image-20210327102534537"></p><p>GraphQL发送的数据如上，后端需处理请求并返回相应的数据</p><h4 id="4-后端处理参数"><a href="#4-后端处理参数" class="headerlink" title="4. 后端处理参数"></a>4. 后端处理参数</h4><p><img src="/posts/1207943057/image-20210327104220902-16487887782013.png" alt></p><p>由GraphQL的调用流程可知，传入到后端的GraphQL字符串最终会被构造成一个 <code>ExecutionInput</code> 对象</p><p><img src="/posts/1207943057/image-20210327103900120.png" alt></p><p><strong>GraphQLController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;graphql&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@CrossOrigin</span><span class="comment">//添加跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphQLController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GraphQL graphQL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">MAPPER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">graphql</span><span class="params">(<span class="meta">@RequestParam(&quot;query&quot;)</span>String query,</span></span><br><span class="line"><span class="params">                                      <span class="meta">@RequestParam(value = &quot;variables&quot;,required = false)</span> String variablesJSON,</span></span><br><span class="line"><span class="params">                                      <span class="meta">@RequestParam(value = &quot;operationName&quot;,required = false)</span> String operationName)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//反序列化，将JSON字符串转化为Map对象</span></span><br><span class="line">            Map&lt;String, Object&gt; variables = MAPPER.readValue(variablesJSON, MAPPER.getTypeFactory().constructMapType(HashMap.class,String.class,Object.class));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.executeGraphQLQuery(query,operationName,variables);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; error = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        error.put(<span class="string">&quot;status&quot;</span>,<span class="number">500</span>);</span><br><span class="line">        error.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;查询出错&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">postGraphql</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String,Object&gt; map)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;query&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> == query)&#123;</span><br><span class="line">                query = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">operationName</span> <span class="operator">=</span> (String) map.get(<span class="string">&quot;operationName&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> == operationName)&#123;</span><br><span class="line">                operationName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Map</span> <span class="variable">variables</span> <span class="operator">=</span> (Map) map.get(<span class="string">&quot;variables&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(variables == <span class="literal">null</span>)&#123;</span><br><span class="line">                variables = Collections.EMPTY_MAP;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.executeGraphQLQuery(query,operationName,variables);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; error = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        error.put(<span class="string">&quot;status&quot;</span>,<span class="number">500</span>);</span><br><span class="line">        error.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;查询出错&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title function_">executeGraphQLQuery</span><span class="params">(String query,String operationName,Map&lt;String,Object&gt; variables)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.graphQL.execute(</span><br><span class="line">                ExecutionInput.newExecutionInput()</span><br><span class="line">                        .query(query)</span><br><span class="line">                        .variables(variables)</span><br><span class="line">                        .operationName(operationName)</span><br><span class="line">                        .build()</span><br><span class="line">        ).toSpecification();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-查询字符串"><a href="#5-查询字符串" class="headerlink" title="5. 查询字符串"></a>5. 查询字符串</h4><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> HouseResourcesList<span class="punctuation">(</span><span class="variable">$pageSize</span>: Int, <span class="variable">$page</span>: Int<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  HouseResourcesList<span class="punctuation">(</span><span class="symbol">pageSize</span><span class="punctuation">:</span> <span class="variable">$pageSize</span>, <span class="symbol">page</span><span class="punctuation">:</span> <span class="variable">$page</span>) <span class="punctuation">&#123;</span></span><br><span class="line">    list <span class="punctuation">&#123;</span></span><br><span class="line">      id</span><br><span class="line">      title</span><br><span class="line">      pic</span><br><span class="line">      title</span><br><span class="line">      coveredArea</span><br><span class="line">      orientation</span><br><span class="line">      floor</span><br><span class="line">      rent</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="string">&quot;pageSize&quot;</span><span class="punctuation">:</span><span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;page&quot;</span><span class="punctuation">:</span><span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210327111113135.png" alt="image-20210327111113135"></p><h4 id="6-改造list-js页面"><a href="#6-改造list-js页面" class="headerlink" title="6. 改造list.js页面"></a>6. 改造list.js页面</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Icon</span>,<span class="title class_">Item</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;semantic-ui-react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;../../common.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApolloClient</span>, gql , <span class="title class_">InMemoryCache</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@apollo/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title class_">ApolloClient</span>(&#123;</span><br><span class="line">  <span class="attr">uri</span>: <span class="string">&#x27;http://127.0.0.1:9091/graphql&#x27;</span>,</span><br><span class="line">  <span class="attr">cache</span>: <span class="keyword">new</span> <span class="title class_">InMemoryCache</span>()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义查询</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">QUERY_LIST</span> = gql`<span class="language-graphql"></span></span><br><span class="line"><span class="language-graphql">  <span class="keyword">query</span> HouseResourcesList<span class="punctuation">(</span><span class="variable">$pageSize</span>: Int, <span class="variable">$page</span>: Int<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-graphql">    HouseResourcesList<span class="punctuation">(</span><span class="symbol">pageSize</span><span class="punctuation">:</span> <span class="variable">$pageSize</span>, <span class="symbol">page</span><span class="punctuation">:</span> <span class="variable">$page</span>) <span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-graphql">      list <span class="punctuation">&#123;</span></span></span><br><span class="line"><span class="language-graphql">        id</span></span><br><span class="line"><span class="language-graphql">        title</span></span><br><span class="line"><span class="language-graphql">        pic</span></span><br><span class="line"><span class="language-graphql">        title</span></span><br><span class="line"><span class="language-graphql">        coveredArea</span></span><br><span class="line"><span class="language-graphql">        orientation</span></span><br><span class="line"><span class="language-graphql">        floor</span></span><br><span class="line"><span class="language-graphql">        rent</span></span><br><span class="line"><span class="language-graphql">      <span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-graphql">    <span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-graphql">  <span class="punctuation">&#125;</span></span></span><br><span class="line"><span class="language-graphql">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HouseList</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">listData</span>: [],</span><br><span class="line">      <span class="attr">typeName</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">loadFlag</span>: <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  goBack = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">goBack</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;query&#125; = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">location</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">typeName</span>: query.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">type</span>: query.<span class="property">type</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">/*axios.post(&#x27;/homes/list&#x27;,&#123;</span></span><br><span class="line"><span class="comment">      home_type: query.type</span></span><br><span class="line"><span class="comment">    &#125;).then(ret=&gt;&#123;</span></span><br><span class="line"><span class="comment">      this.setState(&#123;</span></span><br><span class="line"><span class="comment">        listData: ret.data,</span></span><br><span class="line"><span class="comment">        loadFlag: true</span></span><br><span class="line"><span class="comment">      &#125;)</span></span><br><span class="line"><span class="comment">    &#125;)*/</span></span><br><span class="line">    client.<span class="title function_">query</span>(&#123;<span class="attr">query</span>:<span class="variable constant_">QUERY_LIST</span>,<span class="attr">variables</span>:&#123;<span class="string">&quot;pageSize&quot;</span>:<span class="number">2</span>,<span class="string">&quot;page&quot;</span>:<span class="number">1</span>&#125;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">listData</span>: result.<span class="property">data</span>.<span class="property">HouseResourcesList</span>.<span class="property">list</span>,</span><br><span class="line">        <span class="attr">loadFlag</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> list = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">loadFlag</span>) &#123;</span><br><span class="line">      list = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">listData</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Item</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Item.Image</span> <span class="attr">src</span>=<span class="string">&#123;item.pic.split(</span>&#x27;,&#x27;)[<span class="attr">0</span>]&#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Item.Content</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Item.Header</span>&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">Item.Header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Item.Meta</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#x27;cinema&#x27;</span>&gt;</span>&#123;item.coveredArea&#125; ㎡/&#123;item.orientation&#125;/&#123;item.floor&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Item.Meta</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Item.Description</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  上海</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Item.Description</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Item.Description</span>&gt;</span>&#123;item.rent&#125;<span class="tag">&lt;/<span class="name">Item.Description</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Item.Content</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ( </span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span> = <span class="string">&#x27;house-list&#x27;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span> = <span class="string">&quot;house-list-title&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">onClick</span>=<span class="string">&#123;this.goBack&#125;</span> <span class="attr">name</span> = <span class="string">&#x27;angle left&#x27;</span> <span class="attr">size</span> = <span class="string">&#x27;large&#x27;</span>/&gt;</span>&#123;this.state.typeName&#125; </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span> = <span class="string">&quot;house-list-content&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Item.Group</span> <span class="attr">divided</span> <span class="attr">unstackable</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;list&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Item.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withRouter</span>(<span class="title class_">HouseList</span>);</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210327170512039.png" alt></p><h3 id="更新房源数据"><a href="#更新房源数据" class="headerlink" title="更新房源数据"></a>更新房源数据</h3><p><img src="/posts/1207943057/image-20210328092844152.png" alt="image-20210328092844152"></p><h4 id="1-Controller"><a href="#1-Controller" class="headerlink" title="1. Controller"></a>1. Controller</h4><blockquote><p>haoke-manage-api-server</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改房源</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> houseResources json数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> HouseResources houseResources)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">bool</span> <span class="operator">=</span> <span class="built_in">this</span>.houseResourceService.update(houseResources);</span><br><span class="line">        <span class="keyword">if</span> (bool) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NO_CONTENT).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-Service"><a href="#2-Service" class="headerlink" title="2. Service"></a>2. Service</h4><blockquote><p>haoke-manage-api-server</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(HouseResources houseResources)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.apiHouseResourcesService.updateHouseResources(houseResources);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-修改dubbo服务"><a href="#3-修改dubbo服务" class="headerlink" title="3. 修改dubbo服务"></a>3. 修改dubbo服务</h4><blockquote><p>haoke-manage-dubbo-server-house-resources-interface</p></blockquote><p><strong>ApiHouserResourcesService</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改房源</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> houseResources</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateHouseResources</span><span class="params">(HouseResources houseResources)</span>;</span><br></pre></td></tr></table></figure><p><strong>实现类ApiHouseResourcesServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改房源</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> houseResources</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateHouseResources</span><span class="params">(HouseResources houseResources)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.houseResourcesService.updateHouseResources(houseResources);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修改业务Service:HouseResourcesServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateHouseResources</span><span class="params">(HouseResources houseResources)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.update(houseResources)==<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>BaseServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 更新数据</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">update</span><span class="params">(T record)</span> &#123;</span><br><span class="line">    record.setUpdated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.mapper.updateById(record);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写后台页面"><a href="#编写后台页面" class="headerlink" title="编写后台页面"></a>编写后台页面</h4><h5 id="1-修改房源列表页"><a href="#1-修改房源列表页" class="headerlink" title="1. 修改房源列表页"></a>1. 修改房源列表页</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">render</span>: <span class="function">(<span class="params">text, record</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.handleUpdateModalVisible(true, record)&#125;&gt;查看<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Divider</span> <span class="attr">type</span>=<span class="string">&quot;vertical&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* 弹窗组件 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">EditResource</span> <span class="attr">record</span>=<span class="string">&#123;record&#125;</span> <span class="attr">reload</span>=<span class="string">&#123;this.reload.bind(this)&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Divider</span> <span class="attr">type</span>=<span class="string">&quot;vertical&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">),</span><br><span class="line">    </span><br><span class="line">  <span class="title function_">reload</span>(<span class="params"></span>)&#123;<span class="comment">// 刷新当前页面</span></span><br><span class="line">    <span class="keyword">const</span> &#123; dispatch &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;houseResource/fetch&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210328100647147.png" alt></p><h5 id="2-EditResource-js"><a href="#2-EditResource-js" class="headerlink" title="2. EditResource.js"></a>2. EditResource.js</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Card</span>, <span class="title class_">Checkbox</span>, <span class="title class_">Form</span>, <span class="title class_">Input</span>, <span class="title class_">Modal</span>, <span class="title class_">Select</span>&#125; <span class="keyword">from</span> <span class="string">&quot;antd&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">&quot;dva&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PicturesWall</span> <span class="keyword">from</span> <span class="string">&quot;../Utils/PicturesWall&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FormItem</span> = <span class="title class_">Form</span>.<span class="property">Item</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">InputGroup</span> = <span class="title class_">Input</span>.<span class="property">Group</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CheckboxGroup</span> = <span class="title class_">Checkbox</span>.<span class="property">Group</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">TextArea</span> &#125; = <span class="title class_">Input</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">  <span class="attr">labelCol</span>: &#123;</span><br><span class="line">    <span class="attr">xs</span>: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">    <span class="attr">sm</span>: &#123; <span class="attr">span</span>: <span class="number">7</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">wrapperCol</span>: &#123;</span><br><span class="line">    <span class="attr">xs</span>: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">    <span class="attr">sm</span>: &#123; <span class="attr">span</span>: <span class="number">12</span> &#125;,</span><br><span class="line">    <span class="attr">md</span>: &#123; <span class="attr">span</span>: <span class="number">10</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> paymentMethod = [</span><br><span class="line">  <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;付一押一&quot;</span>,</span><br><span class="line">  <span class="string">&quot;付三押一&quot;</span>,</span><br><span class="line">  <span class="string">&quot;付六押一&quot;</span>,</span><br><span class="line">  <span class="string">&quot;年付押一&quot;</span>,</span><br><span class="line">  <span class="string">&quot;其他&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> decoration = [</span><br><span class="line">  <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;精装&quot;</span>,</span><br><span class="line">  <span class="string">&quot;简装&quot;</span>,</span><br><span class="line">  <span class="string">&quot;毛坯&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rentMethod = [</span><br><span class="line">  <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;整租&quot;</span>,</span><br><span class="line">  <span class="string">&quot;合租&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> time = [</span><br><span class="line">  <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;上午&quot;</span>,</span><br><span class="line">  <span class="string">&quot;中午&quot;</span>,</span><br><span class="line">  <span class="string">&quot;下午&quot;</span>,</span><br><span class="line">  <span class="string">&quot;晚上&quot;</span>,</span><br><span class="line">  <span class="string">&quot;全天&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> facilities = [</span><br><span class="line">  <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;水&quot;</span>,</span><br><span class="line">  <span class="string">&quot;电&quot;</span>,</span><br><span class="line">  <span class="string">&quot;煤气/天然气&quot;</span>,</span><br><span class="line">  <span class="string">&quot;暖气&quot;</span>,</span><br><span class="line">  <span class="string">&quot;有线电视&quot;</span>,</span><br><span class="line">  <span class="string">&quot;宽带&quot;</span>,</span><br><span class="line">  <span class="string">&quot;电梯&quot;</span>,</span><br><span class="line">  <span class="string">&quot;车位/车库&quot;</span>,</span><br><span class="line">  <span class="string">&quot;地下室/储藏室&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isChinese</span>(<span class="params">temp</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> re=<span class="regexp">/^[\u3220-\uFA29]+$/</span>;</span><br><span class="line">  <span class="keyword">if</span> (re.<span class="title function_">test</span>(temp))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span> ;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_">connect</span>()</span><br><span class="line">@<span class="title class_">Form</span>.<span class="title function_">create</span>()<span class="comment">/* 只有标注了 @Form.create() Form中的元素才可被封装 */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EditResource</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====传来的信息=====&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">record</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>=&#123;</span><br><span class="line">      <span class="attr">visible</span>:<span class="literal">false</span>,</span><br><span class="line">      <span class="attr">pics</span>:<span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 显示编辑弹窗 */</span></span><br><span class="line">  showModal = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">visible</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 隐藏编辑弹窗 */</span></span><br><span class="line">  handleCancel = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">visible</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleSave = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; dispatch, form, record &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    form.<span class="title function_">validateFieldsAndScroll</span>(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        <span class="comment">// 房源id</span></span><br><span class="line">        values.<span class="property">id</span> = record.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 看房时间</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_">isChinese</span>(values.<span class="property">time</span>))&#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; time.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(time[i]==values.<span class="property">time</span>)</span><br><span class="line">              values.<span class="property">time</span>=i;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 支付方式</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_">isChinese</span>(values.<span class="property">paymentMethod</span>))&#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; paymentMethod.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(paymentMethod[i]==values.<span class="property">paymentMethod</span>)</span><br><span class="line">              values.<span class="property">paymentMethod</span>=i;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// rentMethod</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_">isChinese</span>(values.<span class="property">rentMethod</span>))&#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; rentMethod.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(rentMethod[i]==values.<span class="property">rentMethod</span>)</span><br><span class="line">              values.<span class="property">rentMethod</span>=i;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// decoration</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_">isChinese</span>(values.<span class="property">decoration</span>))&#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; decoration.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(decoration[i]==values.<span class="property">decoration</span>)</span><br><span class="line">              values.<span class="property">decoration</span>=i;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(values.<span class="property">floor_1</span> &amp;&amp; values.<span class="property">floor_2</span>)&#123;</span><br><span class="line">          values.<span class="property">floor</span> = <span class="string">`<span class="subst">$&#123;values.floor_1  &#125;</span>/<span class="subst">$&#123;  values.floor_2&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 周边设施</span></span><br><span class="line">        <span class="keyword">if</span>(values.<span class="property">facilities</span>)&#123;</span><br><span class="line">          values.<span class="property">facilities</span> = values.<span class="property">facilities</span>.<span class="title function_">join</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 楼栋信息</span></span><br><span class="line">        values.<span class="property">buildingNum</span> = record.<span class="property">buildingNum</span>;</span><br><span class="line">        values.<span class="property">buildingUnit</span> = record.<span class="property">buildingUnit</span>;</span><br><span class="line">        values.<span class="property">buildingFloorNum</span> = record.<span class="property">buildingFloorNum</span>;</span><br><span class="line">        <span class="keyword">delete</span> values.<span class="property">building</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 照片</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">pics</span>.<span class="property">size</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">          values.<span class="property">pic</span> = [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">pics</span>].<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          values.<span class="property">pic</span> = record.<span class="property">pic</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====提交的信息=====&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(values)</span><br><span class="line">        <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;house/updateHouseForm&#x27;</span>,</span><br><span class="line">          <span class="attr">payload</span>: values,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">handleCancel</span>();</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">reload</span>();</span><br><span class="line">        &#125;,<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleFileList = <span class="function">(<span class="params">obj</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> pics = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">    obj.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, k</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(v.<span class="property">response</span>)&#123;</span><br><span class="line">        pics.<span class="title function_">add</span>(v.<span class="property">response</span>.<span class="property">name</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(v.<span class="property">url</span>)&#123;</span><br><span class="line">        pics.<span class="title function_">add</span>(v.<span class="property">url</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      pics</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;record&#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      <span class="attr">form</span>: &#123; getFieldDecorator &#125;</span><br><span class="line">    &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;this.showModal()&#125;&#125;&gt;编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">title</span>=<span class="string">&quot;编辑&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width</span>=<span class="string">&#123;750&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">visible</span>=<span class="string">&#123;this.state.visible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onOk</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;this.handleSave()&#125;&#125;</span></span><br><span class="line"><span class="language-xml">          onCancel=&#123;()=&gt;&#123;this.handleCancel()&#125;&#125;</span></span><br><span class="line"><span class="language-xml">          destroyOnClose</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">overflowY:</span>&#x27;<span class="attr">auto</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Form</span> <span class="attr">hideRequiredMark</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginTop:</span> <span class="attr">8</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Card</span> <span class="attr">bordered</span>=<span class="string">&#123;false&#125;</span> <span class="attr">title</span>=<span class="string">&quot;出租信息&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;房源信息&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;title&#x27;,&#123;initialValue:record.title  ,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27; &#125;&#125; <span class="attr">disabled</span>=<span class="string">&#123;false&#125;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;联系人&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;contact&#x27;,&#123;initialValue:record.contact  ,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27; &#125;&#125; /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;联系方式&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;mobile&#x27;,&#123;initialValue:record.mobile  ,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27; &#125;&#125; /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;看房时间&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;time&#x27;,&#123;initialValue:time[record.time],rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)</span></span><br><span class="line"><span class="language-xml">                  (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">onSelect</span>=<span class="string">&#123;record.time&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">30</span>%&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>上午<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>中午<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>下午<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span>&gt;</span>晚上<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>&gt;</span>全天<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  )&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;租金&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">InputGroup</span> <span class="attr">compact</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;getFieldDecorator(&#x27;rent&#x27;,&#123;initialValue:record.rent ,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">50</span>%&#x27; &#125;&#125; <span class="attr">addonAfter</span>=<span class="string">&quot;元/月&quot;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">InputGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;物业费&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">InputGroup</span> <span class="attr">compact</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;getFieldDecorator(&#x27;propertyCost&#x27;,&#123;initialValue:record.propertyCost ,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">50</span>%&#x27; &#125;&#125; <span class="attr">addonAfter</span>=<span class="string">&quot;元/月&quot;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">InputGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;支付方式&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;paymentMethod&#x27;,&#123;initialValue:paymentMethod[record.paymentMethod],rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)</span></span><br><span class="line"><span class="language-xml">                  (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">onSelect</span>=<span class="string">&#123;record.paymentMethod&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">50</span>%&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>付一押一<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>付三押一<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>付六押一<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span>&gt;</span>年付押一<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>&gt;</span>其它<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  )&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;租赁方式&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;rentMethod&#x27;,&#123;initialValue:rentMethod[record.rentMethod],rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)</span></span><br><span class="line"><span class="language-xml">                  (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">50</span>%&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>整租<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>合租<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  )&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Card</span> <span class="attr">bordered</span>=<span class="string">&#123;false&#125;</span> <span class="attr">title</span>=<span class="string">&quot;房源信息&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;建筑面积&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">InputGroup</span> <span class="attr">compact</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;getFieldDecorator(&#x27;coveredArea&#x27;,&#123;initialValue:record.coveredArea,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">40</span>%&#x27; &#125;&#125; <span class="attr">addonAfter</span>=<span class="string">&quot;平米&quot;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">InputGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;使用面积&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">InputGroup</span> <span class="attr">compact</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;getFieldDecorator(&#x27;useArea&#x27;,&#123;initialValue:record.useArea,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">40</span>%&#x27; &#125;&#125; <span class="attr">addonAfter</span>=<span class="string">&quot;平米&quot;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">InputGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;楼栋&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">InputGroup</span> <span class="attr">compact</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;getFieldDecorator(&#x27;building&#x27;,&#123;initialValue:`$&#123;record.buildingNum&#125;栋$&#123;record.buildingUnit&#125;单元$&#123;record.buildingFloorNum&#125;号`,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">disabled</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">55</span>%&#x27; &#125;&#125; /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">InputGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;楼层&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">InputGroup</span> <span class="attr">compact</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;getFieldDecorator(&#x27;floor_1&#x27;,&#123;initialValue:record.floor.toString().split(&#x27;/&#x27;)[0],rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">disabled</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">45</span>%&#x27; &#125;&#125; <span class="attr">addonBefore</span>=<span class="string">&quot;第&quot;</span> <span class="attr">addonAfter</span>=<span class="string">&quot;层&quot;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                    &#123;getFieldDecorator(&#x27;floor_2&#x27;,&#123;initialValue:record.floor.toString().split(&#x27;/&#x27;)[1],rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">disabled</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">45</span>%&#x27;&#125;&#125; <span class="attr">addonBefore</span>=<span class="string">&quot;总&quot;</span> <span class="attr">addonAfter</span>=<span class="string">&quot;层&quot;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">InputGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;朝向&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;orientation&#x27;,&#123;initialValue:record.orientation,rules:[&#123; required: true, message:&quot;此项为必填项&quot;&#125;]&#125;)</span></span><br><span class="line"><span class="language-xml">                  (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">disabled</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">20</span>%&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;南&quot;</span>&gt;</span>南<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;北&quot;</span>&gt;</span>北<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;东&quot;</span>&gt;</span>东<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;西&quot;</span>&gt;</span>西<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  )&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;户型&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">InputGroup</span> <span class="attr">compact</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;getFieldDecorator(&#x27;houseType&#x27;,&#123;initialValue:record.houseType ,rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)(<span class="tag">&lt;<span class="name">Input</span> <span class="attr">disabled</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">55</span>%&#x27; &#125;&#125; /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">InputGroup</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;装修&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;decoration&#x27;,&#123;initialValue:decoration[record.decoration],rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)</span></span><br><span class="line"><span class="language-xml">                  (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">35</span>%&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>精装<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>简装<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>毛坯<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  )&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;配套设施&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;facilities&#x27;,&#123;initialValue:record.facilities.split(&#x27;,&#x27;),rules:[&#123; required: true, message:&quot;此项为必填项&quot; &#125;]&#125;)</span></span><br><span class="line"><span class="language-xml">                  (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">CheckboxGroup</span> <span class="attr">options</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">水</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">1</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">电</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">2</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">煤气</span>/<span class="attr">天然气</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">3</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">暖气</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">4</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">有线电视</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">5</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">宽带</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">6</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">电梯</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">7</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">车位</span>/<span class="attr">车库</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">8</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                      &#123; <span class="attr">label:</span> &#x27;<span class="attr">地下室</span>/<span class="attr">储藏室</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">9</span>&#x27; &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    /&gt;</span></span></span><br><span class="line"><span class="language-xml">                  )&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Card</span> <span class="attr">bordered</span>=<span class="string">&#123;false&#125;</span> <span class="attr">title</span>=<span class="string">&quot;图片信息&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;房源描述&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  &#123;getFieldDecorator(&#x27;houseDesc&#x27;,&#123;initialValue:record.houseDesc,rules:[&#123; required: false&#125;]&#125;)</span></span><br><span class="line"><span class="language-xml">                  (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">TextArea</span> <span class="attr">autosize</span>=<span class="string">&#123;&#123;</span> <span class="attr">minRows:</span> <span class="attr">4</span>, <span class="attr">maxRows:</span> <span class="attr">10</span> &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">                  )&#125;</span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">span</span>&gt;</span>请勿填写联系方式或与房源无关信息以及图片、链接或名牌、优秀、顶级、全网首发、零距离、回报率等词汇。<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FormItem</span> &#123;<span class="attr">...formItemLayout</span>&#125; <span class="attr">label</span>=<span class="string">&quot;上传室内图&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">PicturesWall</span> <span class="attr">value</span>=<span class="string">&#123;record.pic&#125;</span> <span class="attr">handleFileList</span>=<span class="string">&#123;this.handleFileList.bind(this)&#125;</span> <span class="attr">fileList</span>=<span class="string">&#123;record.pic&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">EditResource</span>;</span><br></pre></td></tr></table></figure><h5 id="3-修改提交逻辑"><a href="#3-修改提交逻辑" class="headerlink" title="3. 修改提交逻辑"></a>3. 修改提交逻辑</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; routerRedux &#125; <span class="keyword">from</span> <span class="string">&#x27;dva/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addHouseResource,updateHouseResource &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/haoke/haoke&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">&#x27;house&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">effects</span>: &#123;</span><br><span class="line">    *<span class="title function_">submitHouseForm</span>(<span class="params">&#123; payload &#125;, &#123; call &#125;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;page model&quot;</span>)</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">call</span>(addHouseResource, payload);</span><br><span class="line">      message.<span class="title function_">success</span>(<span class="string">&#x27;提交成功&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    *<span class="title function_">updateHouseForm</span>(<span class="params">&#123; payload &#125;, &#123; call &#125;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;uodateHouseForm&quot;</span>)</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">call</span>(updateHouseResource, payload);</span><br><span class="line">      message.<span class="title function_">success</span>(<span class="string">&#x27;提交成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">reducers</span>: &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="4-修改service逻辑"><a href="#4-修改service逻辑" class="headerlink" title="4. 修改service逻辑"></a>4. 修改service逻辑</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">addHouseResource</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">&#x27;/haoke/house/resources&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: params</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateHouseResource</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params)</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">&#x27;/haoke/house/resources&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: params</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5-窗口销毁"><a href="#5-窗口销毁" class="headerlink" title="5. 窗口销毁"></a>5. 窗口销毁</h5><p><img src="/posts/1207943057/image-20210329200213549.png" alt="image-20210329200213549"></p><p>关闭之后要销毁，否则影响下一项更新操作</p><h2 id="数据库连接问题"><a href="#数据库连接问题" class="headerlink" title="数据库连接问题"></a>数据库连接问题</h2><h3 id="HikariPool-1-Connection-is-not-available-request-timed-out-after"><a href="#HikariPool-1-Connection-is-not-available-request-timed-out-after" class="headerlink" title="HikariPool-1 - Connection is not available, request timed out after"></a>HikariPool-1 - Connection is not available, request timed out after</h3><p>JDBC超时，Hikari设置了最长请求时间为30s，涉及多线程问题，原因还不清楚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">  	<span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">60</span></span><br><span class="line">      <span class="attr">data-source-properties:</span></span><br><span class="line">        <span class="attr">setIdleTimeout:</span> <span class="number">60000</span></span><br><span class="line">        <span class="attr">setConnectionTimeout:</span> <span class="number">60000</span></span><br><span class="line">        <span class="attr">setValidationTimeout:</span> <span class="number">3000</span></span><br><span class="line">        <span class="attr">setLoginTimeout:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">setMaxLifetime:</span> <span class="number">60000</span></span><br></pre></td></tr></table></figure><h1 id="抽取common工程"><a href="#抽取common工程" class="headerlink" title="抽取common工程"></a>抽取common工程</h1><p>分析：</p><ul><li>多个dubbo服务，需要抽取公共的类、方法到common工程中</li><li>实现独立的dubbo服务，便于后期的扩展和维护</li></ul><p>在dubbo服务提供方的工程中(<code>haoke-manage-dubbo-server</code>)，将BasePOJO、BaseServiceImpl、vo.PageInfo移至该工程；导入公有依赖</p><p>其他工程，依赖此工程，并将自己工程中的相关类删除</p><p><img src="/posts/1207943057/image-20210324210335332.png" alt="image-20210324210335332"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.haoke.manage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>haoke-manage-dubbo-server-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="图像存储"><a href="#图像存储" class="headerlink" title="图像存储"></a>图像存储</h1><p>实现图片上传功能，以供其他服务使用</p><ul><li>图片存储解决方案的分析</li><li>阿里云OSS存储方案的实现</li><li>本地存储方案的实现</li></ul><p>开发一个图片上传服务，需要有存储的支持，那么我们的解决方案有以下几种 ：</p><ul><li>直接将图片保存到服务的硬盘<ul><li>优点：开发便捷，成本低</li><li>缺点：扩容困难</li></ul></li><li>使用分布式文件系统进行存储<ul><li>优点：容器实现扩容</li><li>缺点：开发复杂度大</li></ul></li><li>使用第三方的存储服务<ul><li>优点：开发简单，免维护</li><li>缺点：付费</li></ul></li></ul><h2 id="PicUploadResult-VO"><a href="#PicUploadResult-VO" class="headerlink" title="PicUploadResult(VO)"></a>PicUploadResult(VO)</h2><p>vo：服务提供方封装的返回数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.vo;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PicUploadResult</span> &#123;</span><br><span class="line">    <span class="comment">// 文件唯一标识</span></span><br><span class="line">    <span class="keyword">private</span> String fid;</span><br><span class="line">    <span class="comment">// 文件名</span></span><br><span class="line">    <span class="keyword">private</span> String fname;</span><br><span class="line">    <span class="comment">// 状态有：uploading done error removed</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">// 服务端响应内容，如：&#x27;&#123;&quot;status&quot;: &quot;success&quot;&#125;&#x27;</span></span><br><span class="line">    <span class="keyword">private</span> String response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="本地文件系统存储"><a href="#本地文件系统存储" class="headerlink" title="本地文件系统存储"></a>本地文件系统存储</h2><h3 id="1-编写Service"><a href="#1-编写Service" class="headerlink" title="1. 编写Service"></a>1. 编写Service</h3><p><code>PicUploadFileSystemService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span><span class="comment">//Spring框架</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PicUploadFileSystemService</span> &#123;</span><br><span class="line">    <span class="comment">// 允许上传的格式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] IMAGE_TYPE </span><br><span class="line">        = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123; <span class="string">&quot;.bmp&quot;</span>, <span class="string">&quot;.jpg&quot;</span>,<span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.png&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PicUploadResult <span class="title function_">upload</span><span class="params">(MultipartFile uploadFile)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 校验图片格式,属于图片，则允许上传</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLegal</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (String type : IMAGE_TYPE) &#123;</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.endsWithIgnoreCase(</span><br><span class="line">                	uploadFile.getOriginalFilename(),</span><br><span class="line">                    type)) &#123;</span><br><span class="line">                isLegal = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// 封装Result对象，并且将文件的byte数组放置到result对象中</span></span><br><span class="line">        <span class="type">PicUploadResult</span> <span class="variable">fileUploadResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PicUploadResult</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//不允许上传，返回结果设置设为 error</span></span><br><span class="line">        <span class="keyword">if</span> (!isLegal) &#123;</span><br><span class="line">            fileUploadResult.setStatus(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> fileUploadResult;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> uploadFile.getOriginalFilename();</span><br><span class="line">        <span class="comment">// 文件新路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> getFilePath(fileName);</span><br><span class="line">        <span class="comment">// 生成图片的绝对引用地址</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">picUrl</span> <span class="operator">=</span> StringUtils.replace(</span><br><span class="line">          StringUtils.substringAfter(filePath,<span class="string">&quot;F:\\haoke-upload&quot;</span>),</span><br><span class="line">     	        <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        fileUploadResult.setName(<span class="string">&quot;http://image.haoke.com&quot;</span> + picUrl);</span><br><span class="line">        </span><br><span class="line">        <span class="type">File</span> <span class="variable">newFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line">        <span class="comment">// 写文件到磁盘</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            uploadFile.transferTo(newFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//上传失败</span></span><br><span class="line">            fileUploadResult.setStatus(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> fileUploadResult;</span><br><span class="line">        &#125; </span><br><span class="line">        fileUploadResult.setStatus(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">        fileUploadResult.setUid(String.valueOf(System.currentTimeMillis()));</span><br><span class="line">        <span class="keyword">return</span> fileUploadResult;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getFilePath</span><span class="params">(String sourceFileName)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">baseFolder</span> <span class="operator">=</span> </span><br><span class="line">            <span class="string">&quot;F:\\haoke-upload&quot;</span> + </span><br><span class="line">            File.separator + </span><br><span class="line">            <span class="string">&quot;images&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Date</span> <span class="variable">nowDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="comment">// yyyy/MM/dd</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileFolder</span> <span class="operator">=</span> baseFolder + </span><br><span class="line">            File.separator + </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DateTime</span>(nowDate).toString(<span class="string">&quot;yyyy&quot;</span>) + </span><br><span class="line">            File.separator + </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DateTime</span>(nowDate).toString(<span class="string">&quot;MM&quot;</span>) +</span><br><span class="line">            File.separator + </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DateTime</span>(nowDate).toString(<span class="string">&quot;dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileFolder);</span><br><span class="line">        <span class="keyword">if</span> (!file.isDirectory()) &#123;</span><br><span class="line">            <span class="comment">// 如果目录不存在，则创建目录</span></span><br><span class="line">            file.mkdirs();</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// 生成新的文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DateTime</span>(nowDate).toString(<span class="string">&quot;yyyyMMddhhmmssSSSS&quot;</span>) + </span><br><span class="line">            RandomUtils.nextInt(<span class="number">100</span>, <span class="number">9999</span>) + </span><br><span class="line">            <span class="string">&quot;.&quot;</span> + </span><br><span class="line">            StringUtils.substringAfterLast(sourceFileName, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> fileFolder + File.separator + fileName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-修改Controller中的引用"><a href="#2-修改Controller中的引用" class="headerlink" title="2. 修改Controller中的引用"></a>2. 修改Controller中的引用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;pic/upload&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PicUploadController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PicUploadFileSystemService picUploadService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> uploadFile</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> PicUploadResult <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile uploadFile)</span></span><br><span class="line">        <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.picUploadService.upload(uploadFile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-启动服务，测试接口"><a href="#3-启动服务，测试接口" class="headerlink" title="3. 启动服务，测试接口"></a>3. 启动服务，测试接口</h3><p><img src="/posts/1207943057/image-20210318225539186.png" alt="image-20210318225539186"></p><p>生成的链接是url链接，需要通过nginx进行访问映射</p><h3 id="4-搭建nginx进行访问图片"><a href="#4-搭建nginx进行访问图片" class="headerlink" title="4. 搭建nginx进行访问图片"></a>4. 搭建nginx进行访问图片</h3><h4 id="修改nginx配置文件"><a href="#修改nginx配置文件" class="headerlink" title="修改nginx配置文件"></a>修改nginx配置文件</h4><p>nginx目录/conf/nginx.conf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  image.haoke.com;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-Server $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">        	root  E:\idea\graduateProject\code\upload;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="修改本机hosts环境"><a href="#修改本机hosts环境" class="headerlink" title="修改本机hosts环境"></a>修改本机hosts环境</h4><p><strong>没有修改C:\Windows\System32\drivers\etc\hosts的权限</strong></p><ol><li><p>打开C:\Windows\System32\drivers\etc\文件，找到hosts,然后分配所有权限。</p></li><li><p>找到上面提的hosts文件，打开文件直接再保存原来路径下</p></li><li><p>SwitchHosts!文件右击鼠标，点击管理员启动。</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 开发环境</span><br><span class="line">127.0.0.1 manage.haoke.com</span><br><span class="line">127.0.0.1 image.haoke.com</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210318225008858.png" alt="image-20210318225008858"></p><h5 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd nginx目录</span><br><span class="line"></span><br><span class="line">start nginx.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止nginx</span></span><br><span class="line">nginx -s stop</span><br></pre></td></tr></table></figure><h3 id="5-访问链接，测试"><a href="#5-访问链接，测试" class="headerlink" title="5. 访问链接，测试"></a>5. 访问链接，测试</h3><p><img src="/posts/1207943057/image-20210318231205448.png" alt></p><h2 id="腾讯云COS"><a href="#腾讯云COS" class="headerlink" title="腾讯云COS"></a>腾讯云COS</h2><ol><li>在腾讯云 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/cos5">对象存储控制台</a> 开通腾讯云对象存储（COS）服务。</li><li>在腾讯云 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/cos5">对象存储控制台</a> 创建一个 Bucket。</li><li>在访问管理控制台中的 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/cam/capi">API 密钥管理</a> 页面里获取 APPID，并创建 SecretId、SecretKey。</li></ol><p><img src="/posts/1207943057/image-20210319094707779.png" alt></p><h3 id="1-导入依赖-2"><a href="#1-导入依赖-2" class="headerlink" title="1. 导入依赖"></a>1. 导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入腾讯云COS依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cos_api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.37<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入配置自动注入--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> org.springframework.boot <span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> spring-boot-configuration-processor <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span> true <span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-编写配置文件"><a href="#2-编写配置文件" class="headerlink" title="2. 编写配置文件"></a>2. 编写配置文件</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 子用户id</span></span><br><span class="line"><span class="attr">tencent.cos.appid</span>=<span class="string">100018187662</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#子用户key:id,key</span></span><br><span class="line"><span class="attr">tencent.cos.secret-id</span>=<span class="string">AKIDlNkW6P8TLwNZXExxg9MIcaQMSKwHn32l</span></span><br><span class="line"><span class="attr">tencent.cos.secret-key</span>=<span class="string">b3YEbhkX5MNK2VhfNULXZKG3cwzrW2HH</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 容器名</span></span><br><span class="line"><span class="attr">tencent.cos.bucket-name</span>=<span class="string">haoke-1257323542</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 容器所属区</span></span><br><span class="line"><span class="attr">tencent.cos.region-id</span>=<span class="string">ap-beijing</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 文件前缀</span></span><br><span class="line"><span class="attr">tencent.cos.base-url</span>=<span class="string">https://haoke-1257323542.cos.ap-beijing.myqcloud.com</span></span><br></pre></td></tr></table></figure><h3 id="3-CosConfig"><a href="#3-CosConfig" class="headerlink" title="3. CosConfig"></a>3. CosConfig</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qcloud.cos.COSClient;</span><br><span class="line"><span class="keyword">import</span> com.qcloud.cos.ClientConfig;</span><br><span class="line"><span class="keyword">import</span> com.qcloud.cos.auth.BasicCOSCredentials;</span><br><span class="line"><span class="keyword">import</span> com.qcloud.cos.auth.COSCredentials;</span><br><span class="line"><span class="keyword">import</span> com.qcloud.cos.region.Region;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(value = &#123;&quot;classpath:tencent.properties&quot;&#125;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;tencent.cos&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CosConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line">    <span class="keyword">private</span> String secretId;</span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">    <span class="keyword">private</span> String regionId;</span><br><span class="line">    <span class="keyword">private</span> String baseUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> COSClient <span class="title function_">cosClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 初始化用户身份信息</span></span><br><span class="line">        <span class="type">COSCredentials</span> <span class="variable">cred</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicCOSCredentials</span>(<span class="built_in">this</span>.secretId, <span class="built_in">this</span>.secretKey);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 设置 bucket 的地域, COS 地域的简称请参照 https://cloud.tencent.com/document/product/436/6224</span></span><br><span class="line">        <span class="type">ClientConfig</span> <span class="variable">clientConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientConfig</span>(<span class="keyword">new</span> <span class="title class_">Region</span>(<span class="built_in">this</span>.regionId));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 生成cos客户端</span></span><br><span class="line">        <span class="type">COSClient</span> <span class="variable">cosClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">COSClient</span>(cred,clientConfig);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  cosClient;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-编写Service"><a href="#4-编写Service" class="headerlink" title="4. 编写Service"></a>4. 编写Service</h3><p><code>PicUploadTencentService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PicUploadTencentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 允许上传的格式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] IMAGE_TYPE</span><br><span class="line">            = <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;.bmp&quot;</span>, <span class="string">&quot;.jpg&quot;</span>,<span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.png&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> COSClient cosClient;<span class="comment">//COS客户端</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CosConfig cosConfig;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PicUploadResult <span class="title function_">upload</span><span class="params">(MultipartFile uploadFile)</span> &#123;</span><br><span class="line">        <span class="comment">// 校验图片格式</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLegal</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (String type : IMAGE_TYPE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.endsWithIgnoreCase(</span><br><span class="line">                    uploadFile.getOriginalFilename(),type)) &#123;</span><br><span class="line">                <span class="comment">//如果文件名的后缀为上述图片类型，则为合法文件，可以上传</span></span><br><span class="line">                isLegal = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 封装Result对象，并且将文件的byte数组放置到result对象中</span></span><br><span class="line">        <span class="type">PicUploadResult</span> <span class="variable">fileUploadResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PicUploadResult</span>();</span><br><span class="line">        <span class="keyword">if</span>(!isLegal)&#123;</span><br><span class="line">            fileUploadResult.setStatus(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> fileUploadResult;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 文件新路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> uploadFile.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> getFilePath(fileName);</span><br><span class="line">        String[] filename = filePath.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">localFile</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以字节流上传到腾讯云COS</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            localFile=File.createTempFile(filename[<span class="number">0</span>], filename[<span class="number">1</span>]);</span><br><span class="line">            uploadFile.transferTo(localFile);</span><br><span class="line">            localFile.deleteOnExit();</span><br><span class="line"></span><br><span class="line">            cosClient.putObject(</span><br><span class="line">                    cosConfig.getBucketName(),</span><br><span class="line">                    filePath,</span><br><span class="line">                    localFile</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//上传失败</span></span><br><span class="line">            fileUploadResult.setStatus(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> fileUploadResult;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        cosClient.shutdown();</span><br><span class="line">        <span class="comment">//返回给前端的对象</span></span><br><span class="line">        fileUploadResult.setStatus(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">        fileUploadResult.setName(<span class="built_in">this</span>.cosConfig.getBaseUrl() + filePath);</span><br><span class="line">        fileUploadResult.setUid(String.valueOf(System.currentTimeMillis()));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fileUploadResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getFilePath</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="type">DateTime</span> <span class="variable">dateTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;images/&quot;</span> +</span><br><span class="line">                dateTime.toString(<span class="string">&quot;yyyy&quot;</span>)+</span><br><span class="line">                <span class="string">&quot;/&quot;</span> + dateTime.toString(<span class="string">&quot;MM&quot;</span>) + <span class="string">&quot;/&quot;</span> +</span><br><span class="line">                dateTime.toString(<span class="string">&quot;dd&quot;</span>) + <span class="string">&quot;/&quot;</span> +</span><br><span class="line">                System.currentTimeMillis() +</span><br><span class="line">                RandomUtils.nextInt(<span class="number">100</span>, <span class="number">9999</span>) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">                StringUtils.substringAfterLast(fileName, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-Controller"><a href="#5-Controller" class="headerlink" title="5. Controller"></a>5. Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;pic/upload&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PicUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PicUploadTencentService picUploadTencentService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*@Autowired</span></span><br><span class="line"><span class="comment">    private PicUploadFileSystemService picUploadService;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uploadFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> PicUploadResult <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile uploadFile)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//return this.picUploadService.upload(uploadFile);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.picUploadTencentService.upload(uploadFile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210319181738866.png" alt="image-20210319181738866"></p><h2 id="图像上传前后端整合"><a href="#图像上传前后端整合" class="headerlink" title="图像上传前后端整合"></a>图像上传前后端整合</h2><h3 id="1-修改PicturesWall-js"><a href="#1-修改PicturesWall-js" class="headerlink" title="1. 修改PicturesWall.js"></a>1. 修改PicturesWall.js</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Upload</span></span><br><span class="line">    action=<span class="string">&quot;/haoke/pic/upload&quot;</span></span><br><span class="line">    listType=<span class="string">&quot;picture-card&quot;</span></span><br><span class="line">    fileList=&#123;fileList&#125;</span><br><span class="line">    onPreview=&#123;<span class="variable language_">this</span>.<span class="property">handlePreview</span>&#125;</span><br><span class="line">    onChange=&#123;<span class="variable language_">this</span>.<span class="property">handleChange</span>&#125;</span><br><span class="line">    &gt;</span><br></pre></td></tr></table></figure><h3 id="2-修改AddResources-js"><a href="#2-修改AddResources-js" class="headerlink" title="2. 修改AddResources.js"></a>2. 修改AddResources.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">handleFileList = <span class="function">(<span class="params">obj</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> pics = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">    obj.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, k</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(v.<span class="property">response</span>)&#123;</span><br><span class="line">            pics.<span class="title function_">add</span>(v.<span class="property">response</span>.<span class="property">name</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        pics</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改表单提交逻辑中的图片数据"><a href="#修改表单提交逻辑中的图片数据" class="headerlink" title="修改表单提交逻辑中的图片数据"></a>修改表单提交逻辑中的图片数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">values.<span class="property">pic</span> = [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">pics</span>].<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h3><p><img src="/posts/1207943057/image-20210319214954890.png" alt="image-20210319214954890"></p><h1 id="为接口添加缓存功能"><a href="#为接口添加缓存功能" class="headerlink" title="为接口添加缓存功能"></a>为接口添加缓存功能</h1><ul><li>缓存分析</li><li>docker搭建redis集群</li><li>为接口添加缓存逻辑</li><li>拦截器放行特定请求</li></ul><h2 id="缓存分析"><a href="#缓存分析" class="headerlink" title="缓存分析"></a>缓存分析</h2><p>在接口服务中，每一次都进行数据库查询，那么必然会给数据库造成很大的并发压力。所以需要为接口添加缓存</p><p>项目使用 Redis ，并且使用Redis的集群，Api使用 Spring-Data-Redis</p><p>所以缓存逻辑应该加载api服务处</p><h2 id="Docker搭建Redis集群"><a href="#Docker搭建Redis集群" class="headerlink" title="Docker搭建Redis集群"></a>Docker搭建Redis集群</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用于显示或设置网络设备</span></span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210329211330395.png" alt="image-20210329211330395"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull redis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name redis-node01 -v /data/redis-data/node01:/data -p 6379:6379 redis --cluster-enabled yes --cluster-config-file nodes-node-01.conf</span><br><span class="line"></span><br><span class="line">docker create --name redis-node02 -v /data/redis-data/node02:/data -p 6380:6379 redis --cluster-enabled yes --cluster-config-file nodes-node-02.conf</span><br><span class="line"></span><br><span class="line">docker create --name redis-node03 -v /data/redis-data/node03:/data -p 6381:6379 redis --cluster-enabled yes --cluster-config-file nodes-node-03.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动容器</span></span><br><span class="line">docker start redis-node01 redis-node02 redis-node03</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开始组建集群</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入redis-node01进行操作</span></span><br><span class="line">docker exec -it redis-node01 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">组建集群</span></span><br><span class="line">redis-cli --cluster create 172.17.0.1:6379 172.17.0.1:6380 172.17.0.1:6381 --cluster-replicas 0</span><br></pre></td></tr></table></figure><h3 id="组建集群出现连接不到redis节点问题"><a href="#组建集群出现连接不到redis节点问题" class="headerlink" title="组建集群出现连接不到redis节点问题"></a>组建集群出现连接不到redis节点问题</h3><p><img src="/posts/1207943057/image-20210329212642988.png" alt="image-20210329212642988"></p><p>但可以单独连接到每个节点</p><p><img src="/posts/1207943057/image-20210329213347984.png" alt="image-20210329213347984"></p><h3 id="使用redis-docker容器的ip地址"><a href="#使用redis-docker容器的ip地址" class="headerlink" title="使用redis-docker容器的ip地址"></a>使用redis-docker容器的ip地址</h3><blockquote><p>172.17.0.1 是主机分配给docker容器的地址</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止容器</span></span><br><span class="line">docker stop redis-node01 redis-node02 redis-node03</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除容器</span></span><br><span class="line">docker rm redis-node01 redis-node02 redis-node03 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除redis目录</span></span><br><span class="line">rm -rf /data/redis-data</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name redis-node01 -v /data/redis-data/node01:/data -p 6379:6379 redis --cluster-enabled yes --cluster-config-file nodes-node-01.conf</span><br><span class="line"></span><br><span class="line">docker create --name redis-node02 -v /data/redis-data/node02:/data -p 6380:6379 redis --cluster-enabled yes --cluster-config-file nodes-node-02.conf</span><br><span class="line"></span><br><span class="line">docker create --name redis-node03 -v /data/redis-data/node03:/data -p 6381:6379 redis --cluster-enabled yes --cluster-config-file nodes-node-03.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动容器</span></span><br><span class="line">docker start redis-node01 redis-node02 redis-node03</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看容器的ip地址</span></span><br><span class="line">docker inspect redis-node01 -&gt; 172.17.0.3</span><br><span class="line">docker inspect redis-node02 -&gt; 172.17.0.5</span><br><span class="line">docker inspect redis-node03 -&gt; 172.17.0.6</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入redis-node01进行操作</span></span><br><span class="line">docker exec -it redis-node01 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">组建集群(注意端口的变化)</span></span><br><span class="line">redis-cli --cluster create 172.17.0.3:6379 172.17.0.4:6379 172.17.0.5:6379 --cluster-replicas 0</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210329214229212.png" alt="image-20210329214229212"></p><p><img src="/posts/1207943057/image-20210329214247804.png" alt="image-20210329214247804"></p><p><img src="/posts/1207943057/image-20210329214259863.png" alt="image-20210329214259863"></p><p>集群组建成功：</p><p><img src="/posts/1207943057/image-20210329214354855.png" alt="image-20210329214354855"></p><p><strong>查看集群信息</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@03adb7fdf0e0:/data# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; CLUSTER NODES</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210329214600149.png" alt="image-20210329214600149"></p><h4 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h4><p>集群中结点的ip地址是docker容器分配的，在客户端无法访问</p><h3 id="解决方案-使用host网络进行集群搭建"><a href="#解决方案-使用host网络进行集群搭建" class="headerlink" title="解决方案:使用host网络进行集群搭建"></a>解决方案:使用host网络进行集群搭建</h3><p>docker网络类型</p><ul><li>None:不为容器配置任何网络功能，没有网络 —net=none</li><li>Container:与另一个运行中的容器共享Network Namespace，—net=container:containerID</li><li>Host:与主机共享Network Namespace，—net=host</li><li><p>Bridge:Docker设计的NAT网络模型（默认类型）</p><p><strong>Host模式</strong> 创建的容器没有自己独立的网络命名空间，是和物理机共享一个Network Namespace，并且共享物理机的所有端口与IP。但是它将容器直接暴露在公共网络中，是有安全隐患的</p></li></ul><p><img src="/posts/1207943057/image-20210329214817311.png" alt><br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止容器</span></span><br><span class="line">docker stop redis-node01 redis-node02 redis-node03</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除容器</span></span><br><span class="line">docker rm redis-node01 redis-node02 redis-node03</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除redis目录</span></span><br><span class="line">rm -rf /data/redis-data</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建容器</span></span><br><span class="line">docker create --name redis-node01 --net host -v /data/redis-data/node01:/data redis --cluster-enabled yes --cluster-announce-ip 8.140.130.91 --cluster-announce-bus-port 16379  --cluster-config-file nodes-node-01.conf --port 6379</span><br><span class="line"></span><br><span class="line">docker create --name redis-node02 --net host -v /data/redis-data/node02:/data redis --cluster-enabled yes --cluster-announce-ip 8.140.130.91 --cluster-announce-bus-port 16380 --cluster-config-file nodes-node-02.conf --port 6380</span><br><span class="line"></span><br><span class="line">docker create --name redis-node03 --net host -v /data/redis-data/node03:/data redis --cluster-enabled yes --cluster-announce-ip 8.140.130.91 --cluster-announce-bus-port 16381 --cluster-config-file nodes-node-03.conf --port 6381</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动容器</span></span><br><span class="line">docker start redis-node01 redis-node02 redis-node03</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入redis-node01容器进行操作</span></span><br><span class="line">docker exec -it redis-node01 /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">8.140.130.91是主机的ip地址</span></span><br><span class="line">redis-cli --cluster create 8.140.130.91:6379 8.140.130.91:6380 8.140.130.91:6381 --cluster-replicas 0</span><br></pre></td></tr></table></figure><p></p><p>—name：容器名</p><p>-v /data/redis-data/node01:/data：容器配置文件映射到本机路径</p><p>-p 6380:6379：端口映射</p><p>—cluster-enabled yes：启用集群</p><p>—cluster-config-file nodes-node-01.conf：本节点配置文件</p><p>—cluster-announce-ip 8.140.130.91：集群公网ip</p><p>—cluster-announce-bus-port 16379： 集群的总线端口</p><p>若不设置集群公网Ip及总线端口，则会出现</p><p><code>JedisClusterMaxAttemptsException: No more cluster attempts left.</code></p><p><img src="/posts/1207943057/image-20210329220126931.png" alt></p><p>查看集群信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">CLUSTER NODES</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210330091711876.png" alt="image-20210330091711876"></p><p>测试集群</p><p><img src="/posts/1207943057/image-20210330092907260.png" alt></p><h2 id="测试集群"><a href="#测试集群" class="headerlink" title="测试集群"></a>测试集群</h2><h3 id="1-导入依赖-3"><a href="#1-导入依赖-3" class="headerlink" title="1.导入依赖"></a>1.导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--redis依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-redis配置文件"><a href="#2-redis配置文件" class="headerlink" title="2. redis配置文件"></a>2. redis配置文件</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis集群配置</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.max-wait</span> = <span class="string">5000</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.max-Idle</span> = <span class="string">100</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.min-Idle</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">spring.redis.timeout</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">spring.redis.cluster.nodes</span> = <span class="string">8.140.130.91:6379,8.140.130.91:6380,8.140.130.91:6381</span></span><br><span class="line"><span class="attr">spring.redis.cluster.max-redirects</span>=<span class="string">5</span></span><br></pre></td></tr></table></figure><h3 id="3-Bean注入"><a href="#3-Bean注入" class="headerlink" title="3. Bean注入"></a>3. Bean注入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 读取集群配置文件 */</span></span><br><span class="line"><span class="meta">@PropertySource(value = &quot;classpath:application.properties&quot;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.redis.cluster&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClusterConfigurationProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; nodes;</span><br><span class="line">    <span class="keyword">private</span> Integer maxRedirects;<span class="comment">//集群节点最大重定向数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-注册Redis连接工厂"><a href="#4-注册Redis连接工厂" class="headerlink" title="4. 注册Redis连接工厂"></a>4. 注册Redis连接工厂</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40091033/article/details/106682199">https://blog.csdn.net/qq_40091033/article/details/106682199</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisClusterConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.jedis.JedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*redis集群工厂*/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisClusterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ClusterConfigurationProperties clusterProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisConnectionFactory <span class="title function_">connectionFactory</span><span class="params">()</span> &#123;<span class="comment">//redis连接工厂</span></span><br><span class="line">        <span class="type">RedisClusterConfiguration</span> <span class="variable">redisClusterConfiguration</span></span><br><span class="line">                <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisClusterConfiguration</span>(clusterProperties.getNodes());</span><br><span class="line">        redisClusterConfiguration.setMaxRedirects(clusterProperties.getMaxRedirects());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JedisConnectionFactory</span>(redisClusterConfiguration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String,String&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, String&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);<span class="comment">//设置redis连接工厂</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());<span class="comment">//key序列化</span></span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());<span class="comment">//value序列化</span></span><br><span class="line">        redisTemplate.afterPropertiesSet();<span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.HostAndPort;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisCluster;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRedis</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">this</span>.redisTemplate.opsForValue().set(<span class="string">&quot;key_&quot;</span> + i, <span class="string">&quot;value_&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; keys = <span class="built_in">this</span>.redisTemplate.keys(<span class="string">&quot;key_*&quot;</span>);<span class="comment">//选择所有的键</span></span><br><span class="line">        <span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) <span class="built_in">this</span>.redisTemplate.opsForValue().get(key);</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入redis-node01容器进行操作</span></span><br><span class="line">docker exec -it redis-node01 /bin/bash</span><br><span class="line"></span><br><span class="line">redis-cli -c -p 6379</span><br></pre></td></tr></table></figure><p><img src="/posts/1207943057/image-20210330200516377.png" alt></p><h2 id="添加缓存逻辑"><a href="#添加缓存逻辑" class="headerlink" title="添加缓存逻辑"></a>添加缓存逻辑</h2><p>实现缓存有2种方式：</p><ol><li>每个接口单独控制缓存逻辑</li><li>统一控制缓存逻辑</li></ol><p><strong>判断redis缓存是否命中</strong>：若是POST请求，需从输入流中读取返回的数据，然而redis未命中，放行请求后，由于输入流只能读取一次，输入流已被销毁，无法读取到请求参数，查询不到数据，所以需要使用包装request解决多次读取输入流中的数据</p><p><strong>生成redis缓存</strong>：读取返回的结果，由AOP思想，处理控制器返回的请求</p><h3 id="判断redis是否命中"><a href="#判断redis是否命中" class="headerlink" title="判断redis是否命中"></a>判断redis是否命中</h3><h4 id="采取拦截器进行缓存命中"><a href="#采取拦截器进行缓存命中" class="headerlink" title="采取拦截器进行缓存命中"></a>采取拦截器进行缓存命中</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断请求方式，PUT,DELETE,无需缓存,拦截器放行</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.equalsIgnoreCase(request.getMethod(),<span class="string">&quot;GET&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span>(!StringUtils.equalsIgnoreCase(request.getRequestURI(),<span class="string">&quot;/graphql&quot;</span>))</span><br><span class="line">                <span class="comment">//POST请求有可能是GraphQL查询，也要做拦截，不放行</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过缓存做命中，查询redisKey</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="built_in">this</span>.redisTemplate.opsForValue().get(createRedisKey(request));</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(data))&#123;</span><br><span class="line">            <span class="comment">//缓存未命中，则放行请求</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//若缓存命中，将data中的数据返回</span></span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json; charset=utf-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createRedisKey</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">paramStr</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(parameterMap.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//URI中没有参数，则是POST的GraphQL请求，需要从请求体中获取数据</span></span><br><span class="line">            paramStr += IOUtils.toString(request.getInputStream(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"># 对于POST请求，由于在拦截器中读取了输入流中的数据，在request中的输入流只能读取一次，请求进去的Controller时，输入流已关闭，导致获取不到数据</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            paramStr += mapper.writeValueAsString(request.getParameterMap());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> <span class="string">&quot;WEB_DATA_&quot;</span> + DigestUtils.md5Hex(paramStr);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisKey;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="将拦截器注册到WEB容器中"><a href="#将拦截器注册到WEB容器中" class="headerlink" title="将拦截器注册到WEB容器中"></a>将拦截器注册到WEB容器中</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisInterceptor redisInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将自定义interceptor注册到Web容器中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//所有请求都要经过拦截器</span></span><br><span class="line">        registry.addInterceptor(redisInterceptor).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试拦截器"><a href="#测试拦截器" class="headerlink" title="测试拦截器"></a>测试拦截器</h4><p><img src="/posts/1207943057/image-20210331085258567.png" alt="image-20210331085258567"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paramStr = &quot;/graphql&#123;&quot;query&quot;:&quot;query HouseResourcesList($pageSize: Int, $page: Int) &#123;\n  HouseResourcesList(pageSize: $pageSize, page: $page) &#123;\n    list &#123;\n      id\n      title\n      pic\n      title\n      coveredArea\n      orientation\n      floor\n      rent\n    &#125;\n  &#125;\n&#125;&quot;,&quot;variables&quot;:&#123;&quot;pageSize&quot;:2,&quot;page&quot;:1&#125;,&quot;operationName&quot;:&quot;HouseResourcesList&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>参数串形成的md5为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redisKey = WEB_DATA_822d7e70c286f68877cb6759b04498d4</span><br></pre></td></tr></table></figure><p>由于Redis中没有键为 redisKey ，所以获取到的 data = null</p><p><img src="/posts/1207943057/image-20210330225920792.png" alt="image-20210330225920792"></p><p>然而，由于在拦截器中读取了输入流的数据，在request中的输入流只能读取一次，请求进去Controller时，输入流中已经没有数据了，导致获取不到数据。</p><h4 id="通过包装request解决"><a href="#通过包装request解决" class="headerlink" title="通过包装request解决"></a>通过包装request解决</h4><p>对HttpServetRequest进行包装</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ReadListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletInputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequestWrapper;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 包装 HttpServletRequest</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServletRequestWrapper</span> <span class="keyword">extends</span> <span class="title class_">HttpServletRequestWrapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span>[] body;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Construct a wrapper for the specified request.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request The request to be wrapped</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyServletRequestWrapper</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">super</span>(request);</span><br><span class="line">        body = IOUtils.toByteArray(<span class="built_in">super</span>.getInputStream());<span class="comment">//将输入流读入到wrapper的成员变量中</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BufferedReader <span class="title function_">getReader</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(getInputStream()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletInputStream <span class="title function_">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestBodyCachingInputStream</span>(body);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">RequestBodyCachingInputStream</span> <span class="keyword">extends</span> <span class="title class_">ServletInputStream</span> &#123;</span><br><span class="line">        <span class="comment">//返回一个带有缓存功能的输入流</span></span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span>[] body;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">lastIndexRetrieved</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">private</span> ReadListener listener;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">RequestBodyCachingInputStream</span><span class="params">(<span class="type">byte</span>[] body)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.body = body;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="keyword">if</span> (isFinished()) &#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> body[lastIndexRetrieved + <span class="number">1</span>];</span><br><span class="line">            lastIndexRetrieved++;</span><br><span class="line">            <span class="keyword">if</span> (isFinished() &amp;&amp; listener != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    listener.onAllDataRead();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    listener.onError(e);</span><br><span class="line">                    <span class="keyword">throw</span> e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFinished</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> lastIndexRetrieved == body.length - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isReady</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// This implementation will never block</span></span><br><span class="line">            <span class="comment">// We also never need to call the readListener from this method, as this method will never return false</span></span><br><span class="line">            <span class="keyword">return</span> isFinished();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setReadListener</span><span class="params">(ReadListener readListener)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (listener == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;listener cann not be null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.listener != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;listener has been set&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.listener = listener;</span><br><span class="line">            <span class="keyword">if</span> (!isFinished()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    listener.onAllDataRead();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    listener.onError(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    listener.onAllDataRead();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    listener.onError(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">available</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="keyword">return</span> body.length - lastIndexRetrieved - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            lastIndexRetrieved = body.length - <span class="number">1</span>;</span><br><span class="line">            body = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用过滤器对请求进行替换</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 替换Request对象</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestReplaceFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    <span class="comment">//继承该类，保证过滤器仅过滤一次请求</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(request <span class="keyword">instanceof</span> MyServletRequestWrapper)) &#123;</span><br><span class="line">            request = <span class="keyword">new</span> <span class="title class_">MyServletRequestWrapper</span>(request);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可见，request已经替换成了自定义的wrapper</p><p><img src="/posts/1207943057/image-20210331091627323.png" alt="image-20210331091627323"></p><p>进入 <code>GraphQLControll</code> ,发现此时请求中包含数据</p><h3 id="生成缓存"><a href="#生成缓存" class="headerlink" title="生成缓存"></a>生成缓存</h3><blockquote><p>不能通过拦截器生成缓存，因为拦截器中拿不到Controller返回的数据</p></blockquote><p>通过Spring AOP实现,在结果被处理前进行拦截，拦截的逻辑自己实现，这样就可以实现拿到结果数据进行写入缓存的操作了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.haoke.api.controller.GraphQLController;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.MethodParameter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServletServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.ResponseBodyAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyResponseBodyAdvice</span> <span class="keyword">implements</span> <span class="title class_">ResponseBodyAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 选择要横切的响应</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(MethodParameter returnType, Class converterType)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 对所有查询进行横切，</span></span><br><span class="line"><span class="comment">        * 如 GET请求，POST的GraphQLL</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="keyword">if</span>(returnType.hasMethodAnnotation(GetMapping.class))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(returnType.hasMethodAnnotation(PostMapping.class) &amp;&amp;</span><br><span class="line">                StringUtils.equals(GraphQLController.class.getName(),returnType.getExecutable().getDeclaringClass().getName()))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 横切通知</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">beforeBodyWrite</span><span class="params">(Object body,</span></span><br><span class="line"><span class="params">                                  MethodParameter returnType,</span></span><br><span class="line"><span class="params">                                  MediaType selectedContentType,</span></span><br><span class="line"><span class="params">                                  Class selectedConverterType,</span></span><br><span class="line"><span class="params">                                  ServerHttpRequest request, ServerHttpResponse response)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> RedisInterceptor.createRedisKey(((ServletServerHttpRequest) request).getServletRequest());</span><br><span class="line"></span><br><span class="line">            String redisValue;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(body <span class="keyword">instanceof</span> String)&#123;</span><br><span class="line">                redisValue = (String) body;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                redisValue = mapper.writeValueAsString(body);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.redisTemplate.opsForValue().set(redisKey,redisValue,Duration.ofHours(<span class="number">1</span>));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.getStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> body;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试-3"><a href="#测试-3" class="headerlink" title="测试"></a>测试</h4><p>第二次查询同一数据，发现命中</p><p><img src="/posts/1207943057/image-20210331094542994.png" alt="image-20210331094542994"></p><p>查看服务器端集群</p><p><img src="/posts/1207943057/image-20210331094609925.png" alt="image-20210331094609925"></p><h2 id="整合前端"><a href="#整合前端" class="headerlink" title="整合前端"></a>整合前端</h2><h3 id="命中时跨域处理"><a href="#命中时跨域处理" class="headerlink" title="命中时跨域处理"></a>命中时跨域处理</h3><h3 id="mock的数据都是OPTIONS请求，不能拦截"><a href="#mock的数据都是OPTIONS请求，不能拦截" class="headerlink" title="mock的数据都是OPTIONS请求，不能拦截"></a>mock的数据都是OPTIONS请求，不能拦截</h3><p><img src="/posts/1207943057/image-20210331100535360.png" alt="image-20210331100535360"></p><p>讲解中有这部分内容，但我的mock都是GET请求，所以没有这种情况，仅做记录</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haoke.api.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * 对于mock的请求，讲解中出现错误，解决方案为放行所有的mock请求</span></span><br><span class="line"><span class="comment">        * 但我的问题是mock请求会被存入redis缓存，所以需要放行 请求参数带mock的 GET请求</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.equalsIgnoreCase(request.getMethod(), <span class="string">&quot;OPTIONS&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(request.getRequestURI().startsWith(<span class="string">&quot;/mock&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断请求方式，PUT,DELETE,无需缓存,拦截器放行</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.equalsIgnoreCase(request.getMethod(),<span class="string">&quot;GET&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span>(!StringUtils.equalsIgnoreCase(request.getRequestURI(),<span class="string">&quot;/graphql&quot;</span>))</span><br><span class="line">                <span class="comment">//POST请求有可能是GraphQL查询，也要做拦截，不放行</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过缓存做命中，查询redisKey</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="built_in">this</span>.redisTemplate.opsForValue().get(createRedisKey(request));</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(data))&#123;</span><br><span class="line">            <span class="comment">//缓存未命中，则放行请求</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//若缓存命中，将data中的数据返回</span></span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json; charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 支持跨域</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;GET,POST,PUT,DELETE,OPTIONS&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Content-Type,X-Token&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        response.getWriter().write(data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createRedisKey</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">paramStr</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(parameterMap.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//URI中没有参数，则是POST的GraphQL请求，需要从请求体中获取数据</span></span><br><span class="line">            paramStr += IOUtils.toString(request.getInputStream(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            paramStr += mapper.writeValueAsString(request.getParameterMap());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> <span class="string">&quot;WEB_DATA_&quot;</span> + DigestUtils.md5Hex(paramStr);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisKey;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------<i class="fa fa-hand-peace-o"></i>本文结束-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者 </strong>AmosTian</li><li class="post-copyright-link"><strong>本文链接 </strong><a href="https://amostian.github.io/posts/1207943057/" title="毕设项目后台">https://amostian.github.io/posts/1207943057/</a></li><li class="post-copyright-license"><strong>版权声明 </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E5%BC%80%E5%8F%91/" rel="tag"><i class="fa fa-tags"></i> 开发</a> <a href="/tags/Java%E9%A1%B9%E7%9B%AE/" rel="tag"><i class="fa fa-tags"></i> Java项目</a> <a href="/tags/%E6%AF%95%E8%AE%BE%E9%A1%B9%E7%9B%AE/" rel="tag"><i class="fa fa-tags"></i> 毕设项目</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/4129633176/" rel="prev" title="Dubbo"><i class="fa fa-chevron-left"></i> Dubbo</a></div><div class="post-nav-item"><a href="/posts/951772556/" rel="next" title="毕设项目前端">毕设项目前端 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F"><span class="nav-text">后台系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84"><span class="nav-text">后台系统架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="nav-text">微服务架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E8%AF%A5%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BC%95%E5%85%A5Dubbo"><span class="nav-text">在该项目中为什么引入Dubbo</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-text">项目结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%B6%E5%B7%A5%E7%A8%8B"><span class="nav-text">父工程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%90%E5%B7%A5%E7%A8%8B"><span class="nav-text">子工程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%94%9F%E4%BA%A7%E6%96%B9"><span class="nav-text">服务生产方</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9"><span class="nav-text">服务消费方</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%BF%E6%BA%90%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="nav-text">房源服务的构建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-text">创建数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#POJO"><span class="nav-text">POJO</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#BasePOJO"><span class="nav-text">BasePOJO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%BF%E6%BA%90POJO"><span class="nav-text">房源POJO</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-MybatisPlus%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%94%9F%E6%88%90POJO"><span class="nav-text">1. MybatisPlus逆向工程生成POJO</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAgenerator%E9%A1%B9%E7%9B%AE"><span class="nav-text">创建generator项目</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BC%96%E5%86%99CodeGenerator"><span class="nav-text">编写CodeGenerator</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="nav-text">运行代码</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%B0%86%E7%94%9F%E6%88%90%E7%9A%84POJO%E6%94%BE%E5%88%B0-com-haoke-dubbo-server-pojo-%E4%B8%8B"><span class="nav-text">2. 将生成的POJO放到 com.haoke.dubbo.server.pojo 下</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%BF%E6%BA%90%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-text">房源服务项目结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%BF%E6%BA%90%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-text">房源业务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%BF%E6%BA%90%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="nav-text">房源业务实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="nav-text">相关配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E6%88%BF%E6%BA%90"><span class="nav-text">新增房源</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9"><span class="nav-text">服务提供方</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Dubbo%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%B9%89"><span class="nav-text">Dubbo服务定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E6%88%BF%E6%BA%90%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="nav-text">新增房源业务实现</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Dao%E5%B1%82"><span class="nav-text">Dao层</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Service%E5%B1%82"><span class="nav-text">Service层</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dubbo%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="nav-text">Dubbo服务实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dubbo%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8"><span class="nav-text">Dubbo服务启动</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%AF%E7%94%A8DubboAdmin"><span class="nav-text">启用DubboAdmin</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2dubbo%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9"><span class="nav-text">查询dubbo服务提供方</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9-1"><span class="nav-text">服务消费方</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="nav-text">添加依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B6%88%E8%B4%B9%E6%96%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">消费方配置文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9-2"><span class="nav-text">服务消费方</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="nav-text">控制层</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F"><span class="nav-text">测试程序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="nav-text">测试接口</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B4%E5%90%88"><span class="nav-text">前后端整合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0model"><span class="nav-text">增加model</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0services"><span class="nav-text">增加services</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E5%9C%B0%E5%9D%80"><span class="nav-text">修改表单提交地址</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="nav-text">通过反向代理解决跨域问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%BF%E6%BA%90%E5%88%97%E8%A1%A8"><span class="nav-text">房源列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%9A%E4%B9%89dubbo%E6%9C%8D%E5%8A%A1"><span class="nav-text">1. 定义dubbo服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Dubbo%E7%94%9F%E4%BA%A7%E6%96%B9"><span class="nav-text">2. Dubbo生产方</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-text">1. 定义数据模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E5%AE%9E%E7%8E%B0"><span class="nav-text">2. 服务提供方实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%88%97%E8%A1%A8%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="nav-text">3. 列表业务实现</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Dao%E5%B1%82-1"><span class="nav-text">Dao层</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Service%E5%B1%82-1"><span class="nav-text">Service层</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Dubbo%E6%B6%88%E8%B4%B9%E6%96%B9"><span class="nav-text">3. Dubbo消费方</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%AE%9A%E4%B9%89vo"><span class="nav-text">1. 定义vo</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9"><span class="nav-text">2. 调用服务提供方</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9%E6%8F%90%E4%BE%9B%E7%BB%99%E5%89%8D%E7%AB%AF%E6%8E%A5%E5%8F%A3"><span class="nav-text">3. 服务消费方提供给前端接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="nav-text">4. 测试接口</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B4%E5%90%88"><span class="nav-text">4. 前后端整合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AF%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-text">1. 修改前端表结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E7%89%87%E5%B1%95%E7%A4%BA%E7%BB%84%E4%BB%B6"><span class="nav-text">2. 自定义图片展示组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-model%E5%B1%82"><span class="nav-text">3. model层</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80"><span class="nav-text">4. 修改数据请求地址</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GraphQL"><span class="nav-text">GraphQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RESTful%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">RESTful存在的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GraphQL%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-text">GraphQL的优势</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E6%8C%89%E9%9C%80%E7%B4%A2%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-text">1. 按需索取数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E4%B8%80%E6%AC%A1%E6%9F%A5%E8%AF%A2%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE"><span class="nav-text">2. 一次查询多个数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-API%E7%9A%84%E6%BC%94%E8%BF%9B%E6%97%A0%E9%9C%80%E5%88%92%E5%88%86%E7%89%88%E6%9C%AC"><span class="nav-text">3. API的演进无需划分版本</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GraphQL%E6%9F%A5%E8%AF%A2%E7%9A%84%E8%A7%84%E8%8C%83"><span class="nav-text">GraphQL查询的规范</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5-Fields"><span class="nav-text">字段 Fields</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0Arguments"><span class="nav-text">参数Arguments</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%AB%E5%90%8D-Aliases"><span class="nav-text">别名 Aliases</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%87%E6%AE%B5-Fragments"><span class="nav-text">片段 Fragments</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GraphQL%E7%9A%84schema%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%A7%84%E8%8C%83"><span class="nav-text">GraphQL的schema和类型规范</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Schema%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84"><span class="nav-text">Schema定义结构</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%A0%87%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="nav-text">标量类型</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="nav-text">枚举类型</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3-interface"><span class="nav-text">接口 interface</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GraphQL%E7%9A%84Java%E5%AE%9E%E7%8E%B0"><span class="nav-text">GraphQL的Java实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-text">1. 导入依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="nav-text">2. 安装插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Java-API%E5%AE%9E%E7%8E%B0"><span class="nav-text">Java API实现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8C%89%E9%9C%80%E8%BF%94%E5%9B%9E"><span class="nav-text">按需返回</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="nav-text">查询参数的设置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-SDL%E6%9E%84%E5%BB%BASchema"><span class="nav-text">3. SDL构建Schema</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#id%E6%9F%A5%E8%AF%A2%E6%88%BF%E6%BA%90%E6%8E%A5%E5%8F%A3"><span class="nav-text">id查询房源接口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#dubbo%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9"><span class="nav-text">dubbo服务提供方</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#HouseResourcesService%E2%80%94%E2%80%94Spring%E6%9C%8D%E5%8A%A1%E7%9A%84Interface"><span class="nav-text">HouseResourcesService——Spring服务的Interface</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#HouseResourcesServiceImpl%E2%80%94%E2%80%94Spring%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">HouseResourcesServiceImpl——Spring服务的实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ApiHouseResourcesService%E2%80%94%E2%80%94dubbo%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E6%8E%A5%E5%8F%A3"><span class="nav-text">ApiHouseResourcesService——dubbo服务提供方接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ApiHaokeResourcesImpl%E2%80%94%E2%80%94dubbo%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E5%AE%9E%E7%8E%B0"><span class="nav-text">ApiHaokeResourcesImpl——dubbo服务提供方实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dubbo%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9"><span class="nav-text">dubbo服务消费方</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GraphQL%E6%8E%A5%E5%8F%A3"><span class="nav-text">GraphQL接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#GraphQL%E5%AE%9A%E4%B9%89"><span class="nav-text">GraphQL定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#GraphQL%E7%BB%84%E4%BB%B6"><span class="nav-text">GraphQL组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9A%B4%E9%9C%B2%E6%8E%A5%E5%8F%A3"><span class="nav-text">暴露接口</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GraphQL%E7%BB%84%E4%BB%B6%E8%8E%B7%E5%8F%96%E7%9A%84%E4%BC%98%E5%8C%96"><span class="nav-text">GraphQL组件获取的优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-text">问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%BC%96%E5%86%99MyDataFetcher%E6%8E%A5%E5%8F%A3"><span class="nav-text">1. 编写MyDataFetcher接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%9E%E7%8E%B0MyDataFetcher"><span class="nav-text">2. 实现MyDataFetcher</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E4%BF%AE%E6%94%B9GraphQLProvider"><span class="nav-text">3. 修改GraphQLProvider</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%BF%E6%BA%90%E6%8E%A5%E5%8F%A3-GraphQL"><span class="nav-text">房源接口(GraphQL)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A6%96%E9%A1%B5%E8%BD%AE%E6%92%AD%E5%B9%BF%E5%91%8A"><span class="nav-text">首页轮播广告</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">1. 数据结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="nav-text">2. 数据表设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%AE%9E%E7%8E%B0%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3"><span class="nav-text">3. 实现查询接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="nav-text">1. 创建工程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-appplication-properties"><span class="nav-text">2.appplication.properties</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Dao%E5%B1%82"><span class="nav-text">3.Dao层</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#POJO-1"><span class="nav-text">POJO</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#AdMapper"><span class="nav-text">AdMapper</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#MybatisPlusConfig"><span class="nav-text">MybatisPlusConfig</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-Service%E5%B1%82"><span class="nav-text">4.Service层</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-dubbo%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-text">5.dubbo服务实现类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-%E7%BC%96%E5%86%99%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="nav-text">6.编写启动类</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-API%E5%AE%9E%E7%8E%B0-Dubbo%E6%B6%88%E8%B4%B9%E6%96%B9"><span class="nav-text">4.API实现(Dubbo消费方)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-1"><span class="nav-text">1. 导入依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E7%BC%96%E5%86%99WebResult"><span class="nav-text">2. 编写WebResult</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E7%BC%96%E5%86%99Service"><span class="nav-text">3.编写Service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-Controller"><span class="nav-text">4.Controller</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%95%B4%E5%90%88%E5%89%8D%E7%AB%AF%E7%B3%BB%E7%BB%9F"><span class="nav-text">5. 整合前端系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%B9%BF%E5%91%8A%E7%9A%84GraphQL%E6%8E%A5%E5%8F%A3"><span class="nav-text">6. 广告的GraphQL接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E7%9B%AE%E6%A0%87%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">1. 目标数据结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-graphql%E5%AE%9A%E4%B9%89%E8%AF%AD%E5%8F%A5"><span class="nav-text">2. graphql定义语句</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E6%A0%B9%E6%8D%AEGraphQL%E7%BB%93%E6%9E%84%E7%BC%96%E5%86%99VO"><span class="nav-text">3. 根据GraphQL结构编写VO</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-IndexAdDataFetcher"><span class="nav-text">4. IndexAdDataFetcher</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-%E6%B5%8B%E8%AF%95"><span class="nav-text">5. 测试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-GraphQL%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-text">7. GraphQL客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="nav-text">1. 安装依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%88%9B%E5%BB%BA%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-text">2. 创建客户端</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2"><span class="nav-text">3. 定义查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E6%B5%8B%E8%AF%95"><span class="nav-text">4. 测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%BF%E6%BA%90%E4%BF%A1%E6%81%AF%E5%88%97%E8%A1%A8"><span class="nav-text">房源信息列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E5%AE%9A%E4%B9%89"><span class="nav-text">1. 查询语句定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-DataFetcher"><span class="nav-text">2.DataFetcher</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-GraphQL%E5%8F%82%E6%95%B0"><span class="nav-text">3.GraphQL参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%8F%91%E9%80%81%E7%9A%84%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90"><span class="nav-text">前台系统发送的参数分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%90%8E%E7%AB%AF%E5%A4%84%E7%90%86%E5%8F%82%E6%95%B0"><span class="nav-text">4. 后端处理参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">5. 查询字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E6%94%B9%E9%80%A0list-js%E9%A1%B5%E9%9D%A2"><span class="nav-text">6. 改造list.js页面</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%88%BF%E6%BA%90%E6%95%B0%E6%8D%AE"><span class="nav-text">更新房源数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Controller"><span class="nav-text">1. Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Service"><span class="nav-text">2. Service</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E4%BF%AE%E6%94%B9dubbo%E6%9C%8D%E5%8A%A1"><span class="nav-text">3. 修改dubbo服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%90%8E%E5%8F%B0%E9%A1%B5%E9%9D%A2"><span class="nav-text">编写后台页面</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E4%BF%AE%E6%94%B9%E6%88%BF%E6%BA%90%E5%88%97%E8%A1%A8%E9%A1%B5"><span class="nav-text">1. 修改房源列表页</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-EditResource-js"><span class="nav-text">2. EditResource.js</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E4%BF%AE%E6%94%B9%E6%8F%90%E4%BA%A4%E9%80%BB%E8%BE%91"><span class="nav-text">3. 修改提交逻辑</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E4%BF%AE%E6%94%B9service%E9%80%BB%E8%BE%91"><span class="nav-text">4. 修改service逻辑</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-%E7%AA%97%E5%8F%A3%E9%94%80%E6%AF%81"><span class="nav-text">5. 窗口销毁</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98"><span class="nav-text">数据库连接问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HikariPool-1-Connection-is-not-available-request-timed-out-after"><span class="nav-text">HikariPool-1 - Connection is not available, request timed out after</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%BD%E5%8F%96common%E5%B7%A5%E7%A8%8B"><span class="nav-text">抽取common工程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BE%E5%83%8F%E5%AD%98%E5%82%A8"><span class="nav-text">图像存储</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PicUploadResult-VO"><span class="nav-text">PicUploadResult(VO)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AD%98%E5%82%A8"><span class="nav-text">本地文件系统存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%BC%96%E5%86%99Service"><span class="nav-text">1. 编写Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BF%AE%E6%94%B9Controller%E4%B8%AD%E7%9A%84%E5%BC%95%E7%94%A8"><span class="nav-text">2. 修改Controller中的引用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="nav-text">3. 启动服务，测试接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%90%AD%E5%BB%BAnginx%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E5%9B%BE%E7%89%87"><span class="nav-text">4. 搭建nginx进行访问图片</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">修改nginx配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%9C%AC%E6%9C%BAhosts%E7%8E%AF%E5%A2%83"><span class="nav-text">修改本机hosts环境</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8nginx"><span class="nav-text">启动nginx</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E8%AE%BF%E9%97%AE%E9%93%BE%E6%8E%A5%EF%BC%8C%E6%B5%8B%E8%AF%95"><span class="nav-text">5. 访问链接，测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%85%BE%E8%AE%AF%E4%BA%91COS"><span class="nav-text">腾讯云COS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-2"><span class="nav-text">1. 导入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">2. 编写配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-CosConfig"><span class="nav-text">3. CosConfig</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%BC%96%E5%86%99Service"><span class="nav-text">4. 编写Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Controller"><span class="nav-text">5. Controller</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E5%83%8F%E4%B8%8A%E4%BC%A0%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B4%E5%90%88"><span class="nav-text">图像上传前后端整合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BF%AE%E6%94%B9PicturesWall-js"><span class="nav-text">1. 修改PicturesWall.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BF%AE%E6%94%B9AddResources-js"><span class="nav-text">2. 修改AddResources.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E9%80%BB%E8%BE%91%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE"><span class="nav-text">修改表单提交逻辑中的图片数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-2"><span class="nav-text">测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BA%E6%8E%A5%E5%8F%A3%E6%B7%BB%E5%8A%A0%E7%BC%93%E5%AD%98%E5%8A%9F%E8%83%BD"><span class="nav-text">为接口添加缓存功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90"><span class="nav-text">缓存分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker%E6%90%AD%E5%BB%BARedis%E9%9B%86%E7%BE%A4"><span class="nav-text">Docker搭建Redis集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%BB%BA%E9%9B%86%E7%BE%A4%E5%87%BA%E7%8E%B0%E8%BF%9E%E6%8E%A5%E4%B8%8D%E5%88%B0redis%E8%8A%82%E7%82%B9%E9%97%AE%E9%A2%98"><span class="nav-text">组建集群出现连接不到redis节点问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8redis-docker%E5%AE%B9%E5%99%A8%E7%9A%84ip%E5%9C%B0%E5%9D%80"><span class="nav-text">使用redis-docker容器的ip地址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">存在的问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-%E4%BD%BF%E7%94%A8host%E7%BD%91%E7%BB%9C%E8%BF%9B%E8%A1%8C%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="nav-text">解决方案:使用host网络进行集群搭建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E9%9B%86%E7%BE%A4"><span class="nav-text">测试集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-3"><span class="nav-text">1.导入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">2. redis配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Bean%E6%B3%A8%E5%85%A5"><span class="nav-text">3. Bean注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B3%A8%E5%86%8CRedis%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82"><span class="nav-text">4. 注册Redis连接工厂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="nav-text">测试类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%BC%93%E5%AD%98%E9%80%BB%E8%BE%91"><span class="nav-text">添加缓存逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%ADredis%E6%98%AF%E5%90%A6%E5%91%BD%E4%B8%AD"><span class="nav-text">判断redis是否命中</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%87%E5%8F%96%E6%8B%A6%E6%88%AA%E5%99%A8%E8%BF%9B%E8%A1%8C%E7%BC%93%E5%AD%98%E5%91%BD%E4%B8%AD"><span class="nav-text">采取拦截器进行缓存命中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E6%8B%A6%E6%88%AA%E5%99%A8%E6%B3%A8%E5%86%8C%E5%88%B0WEB%E5%AE%B9%E5%99%A8%E4%B8%AD"><span class="nav-text">将拦截器注册到WEB容器中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-text">测试拦截器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%8C%85%E8%A3%85request%E8%A7%A3%E5%86%B3"><span class="nav-text">通过包装request解决</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E7%BC%93%E5%AD%98"><span class="nav-text">生成缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-3"><span class="nav-text">测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E5%90%88%E5%89%8D%E7%AB%AF"><span class="nav-text">整合前端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%B8%AD%E6%97%B6%E8%B7%A8%E5%9F%9F%E5%A4%84%E7%90%86"><span class="nav-text">命中时跨域处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mock%E7%9A%84%E6%95%B0%E6%8D%AE%E9%83%BD%E6%98%AFOPTIONS%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%8D%E8%83%BD%E6%8B%A6%E6%88%AA"><span class="nav-text">mock的数据都是OPTIONS请求，不能拦截</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="AmosTian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">AmosTian</p><div class="site-description" itemprop="description">知道的越多，不知道的越多</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">358</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">58</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">74</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/AmosTian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AmosTian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://blog.csdn.net/qq_40479037?type=blog" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_40479037?type&#x3D;blog" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a> </span><span class="links-of-author-item"><a href="mailto:17636679561@163.com" title="E-Mail → mailto:17636679561@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("01/27/2022 15:13:14"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-grav"></i> </span><span class="author" itemprop="copyrightHolder">AmosTian</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">站点总字数 </span><span title="站点总字数">827.2k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">34:38</span></div></div></footer></div><script color="0,0,0" opacity="0.5" zindex="-1" count="150" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'neutral',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}</script><script async src="/js/cursor/fireworks.js"></script><script src="/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,document.body.addEventListener("input",POWERMODE)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"live2d-widget-model-hijiki"},display:{position:"right",width:150,height:300},mobile:{show:!1},log:!1})</script></body></html>