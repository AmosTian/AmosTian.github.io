<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/favicon.png" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa:300,300italic,400,400italic,700,700italic|Ma Shan Zheng:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"amostian.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="[TOC]"><meta property="og:type" content="article"><meta property="og:title" content="Ceph文档-存储集群-综述"><meta property="og:url" content="https://amostian.github.io/posts/2576505843/index.html"><meta property="og:site_name" content="AmosTian"><meta property="og:description" content="[TOC]"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240530154245821.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240530154320271.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240530154127201.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240722230832618.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240626123901295.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240626124009748.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240612101340851.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240612103506831.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240612144055954.png"><meta property="og:image" content="https://amostian.github.io/posts/2576505843/image-20240612144554759.png"><meta property="article:published_time" content="2024-06-18T01:50:11.000Z"><meta property="article:modified_time" content="2024-10-04T11:27:52.430Z"><meta property="article:author" content="AmosTian"><meta property="article:tag" content="分布式存储"><meta property="article:tag" content="分布式"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://amostian.github.io/posts/2576505843/image-20240530154245821.png"><link rel="canonical" href="https://amostian.github.io/posts/2576505843/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Ceph文档-存储集群-综述 | AmosTian</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">AmosTian</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">65</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">82</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">216</span></a></li><li class="menu-item menu-item-essay"><a href="/categories/%E9%9A%8F%E7%AC%94/" rel="section"><i class="fa fa-fw fa-pied-piper"></i>随笔</a></li><li class="menu-item menu-item-dynamic-resume"><a href="/dynamic-resume/" rel="section"><i class="fa fa-fw fa-cog"></i>动态简历</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/AmosTian" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://amostian.github.io/posts/2576505843/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="AmosTian"><meta itemprop="description" content="知道的越多，不知道的越多"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="AmosTian"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Ceph文档-存储集群-综述</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间 2024-06-18 09:50:11" itemprop="dateCreated datePublished" datetime="2024-06-18T09:50:11+08:00">2024-06-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间 2024-10-04 19:27:52" itemprop="dateModified" datetime="2024-10-04T19:27:52+08:00">2024-10-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a> </span>> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">分布式存储</span></a></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数 </span><span title="本文字数">5.2k字 </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>13 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>[TOC]</p><span id="more"></span><h2 id="存储设备"><a href="#存储设备" class="headerlink" title="存储设备"></a>存储设备</h2><p>在一个Ceph存储集群中，有多个Ceph进程</p><p><strong>OSDs</strong></p><p>OSD进程存储Ceph集群中的大部分数据（用户数据+元数据+集群数据）。</p><p>通常每个OSD由单个存储设备支撑，如传统的硬盘HDD或固态盘SSD。OSDs也支持设备组合，如：占用大量存储空间的用户数据用HDD存储，元数据可以用SSD或SSD的分区存储</p><p>集群中OSD数量通常是 $f(数据量,每个存储设备容量,数据冗余等级,数据冗余类型(副本或纠删码))$</p><p><strong>Mons</strong></p><p>mon进程管理关键的集群状态，包括集群节点和节点身份认证信息。</p><p>小型集群仅需几GB的空间保存监控数据库的信息；大型集群，监控数据库的大小能达到数十乃至几百GB</p><p><strong>MGRs</strong></p><p>MGR进程与Mon进程一起运行，提供额外的监控，并为外部监控和管理系统提供接口</p><h3 id="OSD存储后端"><a href="#OSD存储后端" class="headerlink" title="OSD存储后端"></a>OSD存储后端</h3><p>OSD有两种方式管理当前节点存储的数据</p><ul><li>L版本 12.2.z 开始，默认的后端为BlueStore</li><li>L版之前，只有FileStore后端</li></ul><h4 id="BlueStore"><a href="#BlueStore" class="headerlink" title="BlueStore"></a>BlueStore</h4><p>BlueStore专为管理 Ceph OSD 工作负载的磁盘数据而设计。BlueStore 的设计基于十年来支持和管理 Filestore OSD 的经验。Bluestore的关键特征</p><ul><li>直接管理存储设备。使用原始块设备或分区。这避免了可能限制性能或增加复杂性的抽象干预层（例如 XFS 等本地文件系统）。</li><li>使用 RocksDB 进行元数据管理。嵌入 RocksDB 的键/值数据库是为了管理内部元数据，包括对象名称到磁盘上块位置的映射</li><li>原始数据和元数据校验和。默认情况下，写入 BlueStore 的所有数据和元数据都受到一个或多个校验和的保护。未经验证，不会从磁盘读取任何数据或元数据或将其返回给用户。</li><li>内联压缩。数据在写入磁盘之前可以选择进行压缩。</li><li>多设备元数据分层。 BlueStore 允许将其内部日志（预写日志）写入单独的高速设备（如 SSD、NVMe 或 NVDIMM），以提高性能。如果有大量更快的存储设备可用，则内部元数据可以存储在更快的设备上。</li><li>高效的写时复制。 RBD 和 CephFS 快照依赖于 BlueStore 中高效实现的写时复制克隆机制。这将为常规的多副本模式和纠删码池（依靠克隆来实现高效的两阶段提交）带来高效的 I/O。</li></ul><p>For more information, see <a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/configuration/bluestore-config-ref/">BlueStore Configuration Reference</a> and <a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/operations/bluestore-migration/">BlueStore Migration</a>.</p><h4 id="FILESTORE"><a href="#FILESTORE" class="headerlink" title="FILESTORE"></a>FILESTORE</h4><p>filestore是Ceph 存储对象的传统方法。依赖于标准文件系统（通常是 XFS）以及键/值数据库（传统上是 LevelDB，现在是 RocksDB）来存储某些元数据。</p><p>FileStore 经过充分测试并在生产中广泛使用。然而，由于其总体设计以及对传统文件系统进行对象数据存储的依赖，它存在许多性能缺陷。</p><p>尽管 FileStore 能够在大多数 POSIX 兼容文件系统（包括 btrfs 和 ext4）上运行，但我们建议仅将 XFS 文件系统与 Ceph 一起使用。</p><ul><li>btrfs 和 ext4 都有已知的错误和缺陷，使用它们可能会导致数据丢失。默认情况下，所有 Ceph 配置工具都使用 XFS。</li></ul><p>For more information, see <a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/configuration/filestore-config-ref/">Filestore Config Reference</a>.</p><h2 id="Ceph-配置"><a href="#Ceph-配置" class="headerlink" title="Ceph 配置"></a>Ceph 配置</h2><p>当Ceph服务启动后，初始化进程会激活一组在后台运行的守护进程，Ceph对象存储集群至少需要运行三类进程</p><ul><li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/glossary/#term-Ceph-Monitor">Ceph Monitor</a> (<code>ceph-mon</code>)</li><li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/glossary/#term-Ceph-Manager">Ceph Manager</a> (<code>ceph-mgr</code>)</li><li><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/glossary/#term-Ceph-OSD-Daemon">Ceph OSD Daemon</a> (<code>ceph-osd</code>)</li></ul><p>支持Ceph文件系统的集群还需要运行一个 <a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/glossary/#term-Ceph-Metadata-Server">Ceph Metadata Server</a> (<code>ceph-mds</code>)</p><p>支持 Ceph 对象存储的集群需要运行 Ceph RADOS Gateway daemons (<code>radosgw</code>).</p><p>每个守护进程都有许多参数配置项，每个参数配置项都有默认值，调整这些配置项的值会调整系统的行为。<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/configuration/ceph-conf/#:~:text=these%20configuration%20options.-,Make%20sure%20to%20understand%20the%20consequences%20before%20overriding%20the%20default%20values%2C%20as%20it%20is%20possible%20to%20significantly%20degrade%20the%20performance%20and%20stability%20of%20your%20cluster.,-Remember%20that%20default">修改参数配置项的值会显著影响集群的性能和稳定性</a> 。需要注意的是，参数配置项的默认值会随着版本迁移发生变化。</p><p>每个参数配置项与一个或若干个Ceph进程相关，且只能指定一个值。</p><p>参数配置项的值随守护进程类型变化而变化，甚至<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/configuration/ceph-conf/#confval-mon_host:~:text=However%2C%20the%20values%20for%20a%20configuration%20option%20can%20vary%20across%20daemon%20types%2C%20and%20can%20vary%20even%20across%20different%20daemons%20of%20the%20same%20type.">同一类型的不同进程也可能取不同的值</a></p><p>参数配置项存储在Mon节点的配置数据库（configuration database）或本地的配置文件中</p><h3 id="参数名"><a href="#参数名" class="headerlink" title="参数名"></a>参数名</h3><p>Ceph的每个参数配置项都有唯一名称 <code>name</code> ，由小写字符用 <code>_</code> 组成</p><p>命令行识别参数名时，<code>_</code> 和 <code>-</code> 时通用的，如 <code>--mon-host</code> 与 <code>--mon_host</code> 等价</p><p>当参数名出现在配置文件中时，也可用空格替换 <code>_</code> 和 <code>-</code> 。</p><p>建议使用 <code>_</code></p><h3 id="参数值"><a href="#参数值" class="headerlink" title="参数值"></a>参数值</h3><h4 id="元变量"><a href="#元变量" class="headerlink" title="元变量"></a>元变量</h4><p>元变量是被Ceph识别的参数配置值，Ceph在应用配置值时展开元变量。</p><p>元变量有：</p><p><strong>$cluster</strong> ：ceph集群名，一般用于同一组硬件上运行多个集群</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Example</span><br><span class="line"><span class="meta prompt_">/etc/ceph/$</span><span class="language-bash">cluster.keyring</span></span><br><span class="line"></span><br><span class="line">Default</span><br><span class="line">ceph</span><br></pre></td></tr></table></figure><p><strong>$type</strong> ：进程类型，如：mds，osd，mon</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">/var/lib/ceph/$</span><span class="language-bash"><span class="built_in">type</span></span></span><br></pre></td></tr></table></figure><p><strong>$id</strong> ：进程或客户端的唯一标识id，如：<code>osd.0</code> 的id 为 <code>0</code> ，<code>mds.a</code> 的id为 <code>a</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example</span><br><span class="line"><span class="meta prompt_">/var/lib/ceph/$</span><span class="language-bash"><span class="built_in">type</span>/<span class="variable">$cluster</span>-<span class="variable">$id</span></span></span><br></pre></td></tr></table></figure><p><strong>$host</strong> ：返回主机名</p><p><strong>$name</strong> ：进程类型与id的拼接变量</p><p>等价于 <code>$type.$id</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example</span><br><span class="line"><span class="meta prompt_">/var/run/ceph/$</span><span class="language-bash">cluster-<span class="variable">$name</span>.asok</span></span><br></pre></td></tr></table></figure><p><strong>$pid</strong> ：返回进程的id</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example</span><br><span class="line"><span class="meta prompt_">/var/run/ceph/$</span><span class="language-bash">cluster-<span class="variable">$name</span>-<span class="variable">$pid</span>.asok</span></span><br></pre></td></tr></table></figure><h3 id="配置源"><a href="#配置源" class="headerlink" title="配置源"></a>配置源</h3><p>Ceph进程在启动时的第一项工作是 依次从 命令行、环境变量、本地配置文件 解析参数配置项</p><p>接下来，各进程会与monitor集群交互以获取整个集群的集中存储配置(centrally-stored configuration)，在获取完整的参数配置视图后，才开始启动守护进程</p><p>每个 Ceph 守护进程获取参数配置的配置源，按优先级从低到高排序为：</p><ul><li>Ceph源码编译时的默认值</li><li>monitor集群的集中配置数据库（configuration database）</li><li>本机上的配置文件</li><li>环境变量</li><li>命令行参数</li><li>管理员运行时在线修改 <code>ceph config set &lt;who&gt; &lt;name&gt; &lt;value&gt;</code></li></ul><h4 id="SKIPPING-MONITOR-CONFIG"><a href="#SKIPPING-MONITOR-CONFIG" class="headerlink" title="SKIPPING MONITOR CONFIG"></a><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/configuration/ceph-conf/#skipping-monitor-config">SKIPPING MONITOR CONFIG</a></h4><p>The option <code>--no-mon-config</code> can be passed in any command in order to skip the step that retrieves configuration information from the cluster’s monitors. Skipping this retrieval step can be useful in cases where configuration is managed entirely via configuration files, or when maintenance activity needs to be done but the monitor cluster is down.</p><h4 id="引导参数"><a href="#引导参数" class="headerlink" title="引导参数"></a>引导参数</h4><p>引导参数（BOOTSTRAP OPTIONS）是影响与mon节点交互、身份验证、检索集群存储配置能力的参数</p><p>因此，这些参数需要存储在节点本地，并通过本地配置文件设置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mon_host: str类型</span><br><span class="line"></span><br><span class="line">由逗号、空格或分号分隔的 IP 地址或主机名列表。主机名通过 DNS 解析。所有 A 和 AAAA 记录都包含在搜索列表中。</span><br><span class="line"></span><br><span class="line">mon_host_override</span><br><span class="line">Ceph 进程首次与 Ceph 集群建立通信时最初联系的监视器列表，覆盖已知的mon节点列表</span><br><span class="line">主要用于调试</span><br></pre></td></tr></table></figure><ul><li>mon_dns_srv_name</li><li>mon_data，osd_data，mds_data，mgr_data，osd_data，mds_data，mgr_data和一些类似的参数：定义本进程数据存储在哪个本地目录中</li><li>keyring，keyfile，key：指定向mon进行身份验证的凭据，默认的keyring是相应的data目录</li></ul><p>通常，集群创建好后，<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/configuration/ceph-conf/#confval-mon_host:~:text=In%20most%20cases%2C%20there%20is%20no%20reason%20to%20modify%20the%20default%20values%20of%20these%20options">引导参数不需要修改</a>。</p><h3 id="Ceph配置文件"><a href="#Ceph配置文件" class="headerlink" title="Ceph配置文件"></a>Ceph配置文件</h3><blockquote><p>配置文件在参数配置源中的优先级在 “源码编译默认值” 和 “configuration database” 的优先级之上</p></blockquote><p>Ceph进程在启动时，会依次从以下位置搜索 <strong>Ceph配置文件</strong>：</p><ol><li><code>$CEPH_CONF</code> (that is, the path following the <code>$CEPH_CONF</code> environment variable)</li><li><code>-c path/path</code> (that is, the <code>-c</code> command line argument)</li><li><code>/etc/ceph/$cluster.conf</code></li><li><code>~/.ceph/$cluster.conf</code></li><li><code>./$cluster.conf</code> (that is, in the current working directory)</li><li>On FreeBSD systems only, <code>/usr/local/etc/ceph/$cluster.conf</code></li></ol><p>配置文件基于 <code>ini</code> 的语法风格，能添加注释内容，用 <code>#</code> 或 <code>;</code> 开头，如</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;--A number (<span class="comment">#) sign number sign (#) precedes a comment.</span></span></span><br><span class="line">; A comment may be anything.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Comments always follow a semi-colon semicolon (;) or a pound sign (<span class="comment">#) on each line.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The end of the line terminates a comment.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">We recommend that you provide comments <span class="keyword">in</span> your configuration file(s).</span></span><br></pre></td></tr></table></figure><h4 id="配置分块"><a href="#配置分块" class="headerlink" title="配置分块"></a>配置分块</h4><p>Ceph配置文件被分为多个部分，显式指定适用的进程。每个部分必须以有效的参数配置块名开始，如</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">debug_ms = 0</span><br><span class="line"></span><br><span class="line">[osd]</span><br><span class="line">debug_ms = 1</span><br><span class="line"></span><br><span class="line">[osd.1]</span><br><span class="line">debug_ms = 10</span><br><span class="line"></span><br><span class="line">[osd.2]</span><br><span class="line">debug_ms = 10</span><br></pre></td></tr></table></figure><p><strong>global</strong></p><p>影响ceph存储集群中的所有进程和客户端</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_file = /var/log/ceph/$cluster-$type.$id.log</span><br></pre></td></tr></table></figure><p><strong>mon</strong></p><p>影响所有 ceph-mon 守护进程，并覆盖 global 中的相同设置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mon_cluster_log_to_syslog = true</span><br></pre></td></tr></table></figure><p><strong>mgr</strong></p><p>影响所有 ceph-mgr守护进程，并覆盖 global 中的相同设置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mgr_stats_period = 10</span><br></pre></td></tr></table></figure><p><strong>osd</strong></p><p>影响所有 ceph-osd 守护进程，并覆盖 global 中的相同设置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">osd_op_queue = wpq</span><br></pre></td></tr></table></figure><p><strong>mds</strong></p><p>影响所有 ceph-mds守护进程，并覆盖 global 中的相同设置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mds_cache_memory_limit = 10G</span><br></pre></td></tr></table></figure><p><strong>client</strong></p><p>影响所有的Ceph客户端，如：CephFS、Ceph RBD、Ceph RGW</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">object_inflight_ops = 512</span><br></pre></td></tr></table></figure><p>还可以指定单独的守护程序或客户端名称。例如，mon.foo、osd.123 和 client.smith 都是有效的节名称。</p><ul><li>任何给定的守护程序将从全局部分、守护程序或客户端类型部分以及共享其名称的部分中获取其设置。</li><li>最具体部分中的设置优先：例如，如果在同一源（即在同一配置文件中）的 global、mon 和 mon.foo 中指定了相同的选项，则将使用 mon.foo 的设置。</li><li>若在同一部分中指定了同一配置选项的多个值，则最后指定的值优先。</li><li>节点本地的配置文件始终优于mon节点的 configuration database 中的值</li></ul><h4 id="配置文件中的参数配置值"><a href="#配置文件中的参数配置值" class="headerlink" title="配置文件中的参数配置值"></a>配置文件中的参数配置值</h4><p>对于字符串类型的参数配置项，字符串值太长以至于一行无法容纳，可以用 <code>\</code> 在行尾表示连续行。这种情况下，参数配置的值是由 <code>\</code> 连接的多行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">foo = long long ago\</span><br><span class="line">long ago</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">foo= <span class="string">&quot;long long ago long ago&quot;</span></span></span><br></pre></td></tr></table></figure><p>每行尾也能添加注释</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">obscure_one = difficult to explain # I will try harder in next release</span><br><span class="line">simpler_one = nothing to explain</span><br></pre></td></tr></table></figure><p>当一个参数配置值包含空格时，则应当括在 <code>&#39;&#39;</code> 或 <code>&quot;&quot;</code> 内</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">line = &quot;to be, or not to be&quot;</span><br></pre></td></tr></table></figure><p>在参数配置值中，有四个转义字符 <code>=</code> ，<code>#</code> ，<code>;</code> 和 <code>[</code> ，用 <code>\</code> 进行转义</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">secret = &quot;i love \# and \[&quot;</span><br></pre></td></tr></table></figure><h4 id="参数配置值类型"><a href="#参数配置值类型" class="headerlink" title="参数配置值类型"></a>参数配置值类型</h4><p><strong>int</strong></p><p>64-bit有符号整数，以B为单位</p><p>支持SI后缀，如：K,M,G,T,P,E($10^3,10^6,…$)</p><p>当为阈值类的参数配置项赋为负数时，表明该参数配置项是无限制的</p><p><strong>uint</strong></p><p>64-bit无符号整数，大于0</p><p><strong>str</strong></p><p>UTF-8编码的字符串，特定的字符串不允许</p><p><strong>boolean</strong></p><p><strong>size</strong></p><p>64-bit 无符号整数，支持SI前缀和IEC前缀，以B为单位</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example</span><br><span class="line">1Ki, 1K, 1KiB and 1B.</span><br></pre></td></tr></table></figure><p><strong>sec</strong></p><p><strong>无符号整数</strong> 时间间隔，以秒为单位，</p><ul><li>second: <code>s</code>, <code>sec</code>, <code>second</code>, <code>seconds</code></li><li>minute: <code>m</code>, <code>min</code>, <code>minute</code>, <code>minutes</code></li><li>hour: <code>hs</code>, <code>hr</code>, <code>hour</code>, <code>hours</code></li><li>day: <code>d</code>, <code>day</code>, <code>days</code></li><li>week: <code>w</code>, <code>wk</code>, <code>week</code>, <code>weeks</code></li><li>month: <code>mo</code>, <code>month</code>, <code>months</code></li><li>year: <code>y</code>, <code>yr</code>, <code>year</code>, <code>years</code></li></ul><p><strong>addr</strong></p><p>A single address, optionally prefixed with <code>v1</code>, <code>v2</code> or <code>any</code> for the messenger protocol. If no prefix is specified, the <code>v2</code> protocol is used.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1:1.2.3.4:567, v2:1.2.3.4:567, 1.2.3.4:567, 2409:8a1e:8fb6:aa20:1260:4bff:fe92:18f5::567, [::1]:6789</span><br></pre></td></tr></table></figure><p><strong>addrvec</strong></p><p>A set of addresses separated by “,”. The addresses can be optionally quoted with <code>[</code> and <code>]</code>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example</span><br><span class="line">[v1:1.2.3.4:567,v2:1.2.3.4:568], v1:1.2.3.4:567,v1:1.2.3.14:567 [2409:8a1e:8fb6:aa20:1260:4bff:fe92:18f5::567], [2409:8a1e:8fb6:aa20:1260:4bff:fe92:18f5::568]</span><br></pre></td></tr></table></figure><p><strong>uuid</strong></p><p>The string format of a uuid defined by <a target="_blank" rel="noopener" href="https://www.ietf.org/rfc/rfc4122.txt">RFC4122</a>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Example</span><br><span class="line">f81d4fae-7dec-11d0-a765-00a0c91e6bf6</span><br></pre></td></tr></table></figure><h3 id="参数配置数据库"><a href="#参数配置数据库" class="headerlink" title="参数配置数据库"></a>参数配置数据库</h3><p>mon集群管理整个集群共享的一个参数配置项数据库，可以简化整个系统的配置管理，大多数参数配置项都存储在该数据库中</p><p>仅有一些引导参数需要存储在本地配置文件中，涉及与mon节点的交互、本节点的身份验证和获取配置信息的能力</p><p>大多数情况，仅与 <code>mon_host</code> 相关的参数，可以通过DNS记录避免</p><h4 id="sections-和-masks"><a href="#sections-和-masks" class="headerlink" title="sections 和 masks"></a>sections 和 masks</h4><p>存储在mon集群的Configuration Database中的参数配置项可以分为 <code>[global]</code> 、<code>[进程类型]</code> 、<code>[指定的进程]</code> 多个 section。与 <code>$cluster.conf</code> 配置文件的section无区别</p><p>与配置文件的不同在于，Configuration Database中的参数配项置能与掩码关联，使管理员确保参数配置值的修改值影响特定的进程或客户端</p><ul><li><code>type:location</code> ，<code>type</code> 是CRUSH的属性，如 <code>rack</code> 或 <code>host</code> ，<code>location</code> 是该类型的值，如 <code>host:foo</code> 将限制该配置项只影响主机名为 <code>foo</code> 上的进程</li><li><code>class:device-class</code> ，<code>device-class</code> 是CRUSH设备类型（ <code>hdd</code> 或 <code>ssd</code> ）的名称，如：<code>class:ssd</code> 将限制该配置项只影响物理设备为SSD的OSD</li></ul><p>在 <code>ceph config set &lt;who&gt; &lt;name&gt; &lt;value&gt;</code> 修改参数配置值时，<code>&lt;who&gt;</code>可以是 <code>&lt;section.daemon-name&gt;</code> 、 <code>&lt;section&gt;/&lt;mask&gt;</code> 、<code>&lt;section&gt;</code> 、<code>&lt;mask&gt;</code></p><h4 id="参数值查看指令"><a href="#参数值查看指令" class="headerlink" title="参数值查看指令"></a>参数值查看指令</h4><p>请注意，<code>ceph config set &lt;who&gt; &lt;option&gt; &lt;value&gt;</code> 和 <code>ceph config get &lt;who&gt; &lt;option&gt;</code> 命令返回的值可能并不同步。<strong>后者可能显示编译时默认值</strong>。</p><p><code>ceph config get &lt;who&gt; &lt;option&gt;</code> ：导出mon节点参数配置数据库中<who>的参数配置值，若不在configuraion database中，则显示编译时默认值</who></p><p><strong>并不显示全部参数及配置值</strong></p><p>为了确定配置选项是否存在于监视器配置数据库中，请运行 <code>ceph config dump</code> 命令。</p><p><code>ceph config dump</code> ：导出mon节点的<strong>本地参数配置数据库</strong></p><p><img src="/posts/2576505843/image-20240530154245821.png" alt="image-20240530154245821"></p><p><code>ceph config get &lt;who&gt;</code></p><p>导出mon节点参数配置数据库中<who>指定的内容</who></p><p><img src="/posts/2576505843/image-20240530154320271.png" alt="image-20240530154320271"></p><p><code>ceph config show &lt;who&gt;</code> ：导出正在运行的守护进程的本地配置。</p><p>这些设置可能与存储在mon中的设置不同，如果有本地配置文件在使用，或者选项在命令行或运行时被覆盖。输出中会显示选项值的来源。</p><p><img src="/posts/2576505843/image-20240530154127201.png" alt="image-20240530154127201"></p><p><code>ceph config assimilate-conf -i &lt;input file&gt; -o &lt;output file&gt;</code></p><ul><li><p>从输入文件中提取一个配置文件，并将所有有效的参数配置项移动到监视器配置数据库中</p></li><li><p>任何无法识别、无效或无法由监视器控制的设置将返回在输出文件中存储的缩写配置文件</p></li><li>便于<strong>配置文件的迁移</strong></li></ul><h4 id="help"><a href="#help" class="headerlink" title="help"></a>help</h4><p>通过 <code>help</code> 指令，获取指定参数配置项的帮助</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ceph config help &lt;option&gt;</span><br><span class="line">ceph config help log_file</span><br><span class="line"></span><br><span class="line">ceph config help log_file -f json-pretty</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://docs.ceph.com/en/quincy/rados/configuration/ceph-conf/#SECTIONS%20AND%20MASKS:~:text=The%20level%20property%20can%20be%20basic%2C%20advanced%2C%20or%20dev.%20The%20dev%20options%20are%20intended%20for%20use%20by%20developers%2C%20generally%20for%20testing%20purposes%2C%20and%20are%20not%20recommended%20for%20use%20by%20operators.">参数配置项的 <code>level</code> 属性有三种取值，<code>basic</code> ，<code>advanced</code> 和 <code>dev</code> 。<code>dev</code> 类型的参数配置项旨在供开发者使用，通常称用于测试目的，并不推荐用户修改</a></p><p>也可以使用 <code>ceph daemon &lt;name&gt; config help [option]</code> 从特定的运行中的守护进程查询参数配置项</p><h3 id="参数配置值的修改"><a href="#参数配置值的修改" class="headerlink" title="参数配置值的修改"></a>参数配置值的修改</h3><h4 id="运行时可修改参数配置项"><a href="#运行时可修改参数配置项" class="headerlink" title="运行时可修改参数配置项"></a>运行时可修改参数配置项</h4><p><strong>参数修改后 <code>set</code> 和 <code>get</code> 同步，但 <code>show</code> 并不同步</strong></p><p>通过 <code>ceph config show</code> 查看运行中进程的参数配置值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看 `osd.0` 进程的运行时参数配置值</span></span><br><span class="line">ceph config show osd.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个特定参数配置项的参数配置值</span></span><br><span class="line">ceph config show osd.0 debug_osd</span><br></pre></td></tr></table></figure><p>二者输出一致，只不过格式不一样</p><ul><li><p>带默认值查看参数配置值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ceph config show-with-defaults osd.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">参数名	参数值</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">		  参数配置源</span></span><br></pre></td></tr></table></figure><p><img src="/posts/2576505843/image-20240722230832618.png" alt="image-20240722230832618"></p></li><li><p>在本地主机上通过管理套接字连接到正在运行的守护进程来查看守护进程的所有设置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ceph daemon mon.node01 config show</span><br><span class="line">输出是json格式的 &quot;参数名&quot;: &quot;参数值&quot;</span><br><span class="line"></span><br><span class="line">root@node01:/home# ceph daemon mon.node01 config show | grep mon_allow_pool_delete</span><br><span class="line">    &quot;mon_allow_pool_delete&quot;: &quot;true&quot;,</span><br></pre></td></tr></table></figure></li></ul><p>要查看非默认设置，并查看每个值来自何处（例如，配置文件、监视器或覆盖）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@node01:/home# ceph daemon mon.node01 config diff | grep -C 4 &#x27;mon_allow_pool_delete&#x27;       </span><br><span class="line">        &quot;log_to_stderr&quot;: &#123;</span><br><span class="line">            &quot;default&quot;: true,</span><br><span class="line">            &quot;final&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;mon_allow_pool_delete&quot;: &#123;</span><br><span class="line">            &quot;default&quot;: false,</span><br><span class="line">            &quot;override&quot;: true,</span><br><span class="line">            &quot;final&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>要查看单个设置的值，请运行以下命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph daemon osd.0 config get debug_osd</span><br></pre></td></tr></table></figure><h4 id="运行时持久化修改"><a href="#运行时持久化修改" class="headerlink" title="运行时持久化修改"></a>运行时持久化修改</h4><p><strong>重启必须在所有主机上本地运行</strong> <code>systemctl &#123; start | stop | restart&#125; ceph.target</code> 只管理本机服务</p><p><code>ceph config set &lt;who&gt; option_name option_value</code> ，修改参数配置数据库中的值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若需要在指定OSD上打开最详细的调试日志级别</span></span><br><span class="line">ceph config set osd.123 debug_ms 20</span><br></pre></td></tr></table></figure><ul><li>此指令 <code>&lt;who&gt;</code> 不能使用通配符 <code>.*</code> ，但可以在非本机上修改其他主机配置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@node01:~# cephadm shell ceph daemon osd.0 config show | grep osd_op_num_shards_ssd</span><br><span class="line">Inferring fsid b5b8c73c-3364-11ef-9424-cb387dad71a6</span><br><span class="line">Inferring config /var/lib/ceph/b5b8c73c-3364-11ef-9424-cb387dad71a6/mon.node01/config</span><br><span class="line">Using ceph image with id &#x27;ff4519c9e0a2&#x27; and tag &#x27;v17.2.7&#x27; created on 2024-05-22 00:09:44 +0800 CST</span><br><span class="line">quay.io/ceph/ceph@sha256:d26c11e20773704382946e34f0d3d2c0b8bb0b7b37d9017faa9dc11a0196c7d9</span><br><span class="line">    &quot;osd_op_num_shards_ssd&quot;: &quot;8&quot;,</span><br><span class="line">root@node01:~# ceph config get osd.0 osd_op_num_shards_ssd</span><br><span class="line">8</span><br><span class="line">root@node01:~# ceph config set global osd_op_num_shards_ssd 10</span><br><span class="line">root@node01:~# ceph config get osd.0 osd_op_num_shards_ssd</span><br><span class="line">10</span><br><span class="line">root@node01:~# cephadm shell ceph daemon osd.0 config show | grep osd_op_num_shards_ssd</span><br><span class="line">Inferring fsid b5b8c73c-3364-11ef-9424-cb387dad71a6</span><br><span class="line">Inferring config /var/lib/ceph/b5b8c73c-3364-11ef-9424-cb387dad71a6/mon.node01/config</span><br><span class="line">Using ceph image with id &#x27;ff4519c9e0a2&#x27; and tag &#x27;v17.2.7&#x27; created on 2024-05-22 00:09:44 +0800 CST</span><br><span class="line">quay.io/ceph/ceph@sha256:d26c11e20773704382946e34f0d3d2c0b8bb0b7b37d9017faa9dc11a0196c7d9</span><br><span class="line">    &quot;osd_op_num_shards_ssd&quot;: &quot;8&quot;,</span><br><span class="line">root@node01:~# ceph config get osd.1 osd_op_num_shards_ssd</span><br><span class="line">10</span><br><span class="line"></span><br><span class="line">root@node01:~# systemctl restart ceph.target</span><br><span class="line"></span><br><span class="line">root@node01:~# ceph config get osd.1 osd_op_num_shards_ssd</span><br><span class="line">10</span><br><span class="line">root@node01:~# cephadm shell ceph daemon osd.0 config show | grep osd_op_num_shards_ssd</span><br><span class="line">Inferring fsid b5b8c73c-3364-11ef-9424-cb387dad71a6</span><br><span class="line">Inferring config /var/lib/ceph/b5b8c73c-3364-11ef-9424-cb387dad71a6/mon.node01/config</span><br><span class="line">Using ceph image with id &#x27;ff4519c9e0a2&#x27; and tag &#x27;v17.2.7&#x27; created on 2024-05-22 00:09:44 +0800 CST</span><br><span class="line">quay.io/ceph/ceph@sha256:d26c11e20773704382946e34f0d3d2c0b8bb0b7b37d9017faa9dc11a0196c7d9</span><br><span class="line">    &quot;osd_op_num_shards_ssd&quot;: &quot;10&quot;,</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@node01:~# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     b5b8c73c-3364-11ef-9424-cb387dad71a6</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 2 daemons, quorum node01,node02 (age 5m)</span><br><span class="line">    mgr: node01.ohhfsw(active, since 5m), standbys: node02.owpknt</span><br><span class="line">    osd: 2 osds: 2 up (since 5m), 2 in (since 100m)</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   1 pools, 1 pgs</span><br><span class="line">    objects: 2 objects, 577 KiB</span><br><span class="line">    usage:   583 MiB used, 39 GiB / 40 GiB avail</span><br><span class="line">    pgs:     1 active+clean</span><br><span class="line"> </span><br><span class="line">root@node01:~# ceph config set global osd_op_num_shards_ssd 8</span><br><span class="line">root@node01:~# cephadm shell ceph daemon osd.0 config show | grep osd_op_num_shards_ssd</span><br><span class="line">Inferring fsid b5b8c73c-3364-11ef-9424-cb387dad71a6</span><br><span class="line">Inferring config /var/lib/ceph/b5b8c73c-3364-11ef-9424-cb387dad71a6/mon.node01/config</span><br><span class="line">Using ceph image with id &#x27;ff4519c9e0a2&#x27; and tag &#x27;v17.2.7&#x27; created on 2024-05-22 00:09:44 +0800 CST</span><br><span class="line">quay.io/ceph/ceph@sha256:d26c11e20773704382946e34f0d3d2c0b8bb0b7b37d9017faa9dc11a0196c7d9</span><br><span class="line">    &quot;osd_op_num_shards_ssd&quot;: &quot;10&quot;,</span><br><span class="line">root@node01:~# ceph config get osd.0 osd_op_num_shards_ssd</span><br><span class="line">8</span><br><span class="line">root@node01:~# ceph config get osd.1 osd_op_num_shards_ssd</span><br><span class="line">8</span><br><span class="line">root@node01:~# systemctl restart ceph.target</span><br><span class="line"></span><br><span class="line">root@node01:~# cephadm shell ceph daemon osd.0 config show | grep osd_op_num_shards_ssd</span><br><span class="line">Inferring fsid b5b8c73c-3364-11ef-9424-cb387dad71a6</span><br><span class="line">Inferring config /var/lib/ceph/b5b8c73c-3364-11ef-9424-cb387dad71a6/mon.node01/config</span><br><span class="line">Using ceph image with id &#x27;ff4519c9e0a2&#x27; and tag &#x27;v17.2.7&#x27; created on 2024-05-22 00:09:44 +0800 CST</span><br><span class="line">quay.io/ceph/ceph@sha256:d26c11e20773704382946e34f0d3d2c0b8bb0b7b37d9017faa9dc11a0196c7d9</span><br><span class="line">    &quot;osd_op_num_shards_ssd&quot;: &quot;8&quot;,</span><br><span class="line">root@node01:~# ceph config get osd.0 osd_op_num_shards_ssd</span><br><span class="line">8</span><br><span class="line">root@node01:~# ceph config get osd.1 osd_op_num_shards_ssd</span><br><span class="line">8</span><br></pre></td></tr></table></figure><p><img src="/posts/2576505843/image-20240626123901295.png" alt="image-20240626123901295"></p><p>等一会，ceph -s 为OK</p><p><img src="/posts/2576505843/image-20240626124009748.png" alt="image-20240626124009748"></p><h4 id="临时修改"><a href="#临时修改" class="headerlink" title="临时修改"></a>临时修改</h4><p>Ceph允许运行时修改进程的参数配置值，如增加或减少日志输出的数量，启动或禁用调试设置，运行时优化</p><p>通过使用 Ceph CLI 命令行接口（CLI）中的 <code>tell</code> 或 <code>daemon</code> 接口可以临时设置选项。</p><p>在守护进程重新启动时恢复为持久配置的值。</p><p>两种临时修改方法</p><p><strong>从任何主机，用以下形式的命令发送消息给守护进程:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph tell &lt;name&gt; config set &lt;option&gt; &lt;value&gt;</span><br><span class="line">ceph tell osd.123 config set debug_osd 20</span><br></pre></td></tr></table></figure><p><code>ceph tell</code> 的 <code>&lt;name&gt;</code> 接收通配符，例如，要调整所有OSD守护进程的调试级别，命令格式如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph tell osd.* config set debug_osd 20</span><br></pre></td></tr></table></figure><p><strong>ceph daemon 相关的指令，需要<who>所在的主机上，通过 /var/run/ceph 套接字连接到进程</who></strong></p><ul><li>若使用cephadm部署，则需要在cephadm shell中</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ceph daemon &lt;name&gt; config set &lt;option&gt; &lt;value&gt;</span><br><span class="line">ceph daemon osd.4 config set debug_osd 20</span><br></pre></td></tr></table></figure><p>在 <code>ceph config show</code> 的输出中，这些临时值的 <code>sorce</code> 字段被标注为 <code>override</code></p><p><strong>测试临时修改</strong></p><p>ubuntu：cephadm重启后参数恢复</p><p><img src="/posts/2576505843/image-20240612101340851.png" alt="image-20240612101340851"></p><p>ubuntu：ceph-deploy</p><p><img src="/posts/2576505843/image-20240612103506831.png" alt="image-20240612103506831"></p><p>kylin linux：ceph-deploy 14.2.8</p><p>ceph config set mon.* mon_allow_pool_delete true</p><p>不识别通配符</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ceph01 ~]# ceph config set mon.ceph01 mon_allow_pool_delete false</span><br><span class="line">[root@ceph01 ~]# ceph config set mon.ceph02 mon_allow_pool_delete false</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可识别通配符，但不能修改</span></span><br><span class="line">[root@ceph01 ~]# ceph tell mon.* config set mon_allow_pool_delete true</span><br><span class="line">Invalid command: missing required parameter value(&lt;string&gt;)</span><br><span class="line">config set &lt;who&gt; &lt;name&gt; &lt;value&gt; &#123;--force&#125; :  Set a configuration option for one or more entities</span><br><span class="line">Error EINVAL: invalid command</span><br><span class="line">mon.ceph01: invalid command</span><br><span class="line">Invalid command: missing required parameter value(&lt;string&gt;)</span><br><span class="line">config set &lt;who&gt; &lt;name&gt; &lt;value&gt; &#123;--force&#125; :  Set a configuration option for one or more entities</span><br><span class="line">Error EINVAL: invalid command</span><br><span class="line">mon.ceph02: invalid command</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个可以改成功</span></span><br><span class="line">ceph tell osd.123 config set debug_osd 20</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出运行中进程的参数配置值</span></span><br><span class="line">ceph config show mon.ceph01 | grep mon_allow_pool_delete</span><br><span class="line"></span><br><span class="line">[root@ceph01 ~]# ceph config show mon.ceph01 | grep mon_allow_pool_delete</span><br><span class="line">mon_allow_pool_delete     false                           mon                        </span><br><span class="line">[root@ceph01 ~]# ceph config show mon.ceph02 | grep mon_allow_pool_delete</span><br><span class="line">mon_allow_pool_delete     false                           mon                        </span><br><span class="line">[root@ceph01 ~]# ceph osd pool rm test test --yes-i-really-really-mean-it</span><br><span class="line">Error EPERM: pool deletion is disabled; you must first set the mon_allow_pool_delete config option to true before you can destroy a pool</span><br><span class="line">[root@ceph01 ~]# ceph tell mon.* injectargs &#x27;--mon_allow_pool_delete=true&#x27;</span><br><span class="line">mon.ceph01: injectargs:mon_allow_pool_delete = &#x27;true&#x27; </span><br><span class="line">mon.ceph02: injectargs:mon_allow_pool_delete = &#x27;true&#x27; </span><br><span class="line">[root@ceph01 ~]# ceph config show mon.ceph01 | grep mon_allow_pool_delete</span><br><span class="line">mon_allow_pool_delete     true                            override mon[false]      </span><br><span class="line">[root@ceph01 ~]# ceph config show mon.ceph02 | grep mon_allow_pool_delete</span><br><span class="line">mon_allow_pool_delete     true                            override mon[false]</span><br><span class="line">[root@ceph01 ~]# ceph osd pool rm test test --yes-i-really-really-mean-it</span><br><span class="line">pool &#x27;test&#x27; removed</span><br></pre></td></tr></table></figure><p>由于只重启了ceph01主机，所以只有ceph01的参数恢复，但由于指令是在ceph01上执行的，所以删除池指令不会生效</p><p><img src="/posts/2576505843/image-20240612144055954.png" alt="image-20240612144055954"></p><p>使用空格代替会有错，所以建议使用 <code>=</code></p><p><img src="/posts/2576505843/image-20240612144554759.png" alt="image-20240612144554759"></p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------<i class="fa fa-hand-peace-o"></i>本文结束-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者 </strong>AmosTian</li><li class="post-copyright-link"><strong>本文链接 </strong><a href="https://amostian.github.io/posts/2576505843/" title="Ceph文档-存储集群-综述">https://amostian.github.io/posts/2576505843/</a></li><li class="post-copyright-license"><strong>版权声明 </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" rel="tag"><i class="fa fa-tags"></i> 分布式存储</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tags"></i> 分布式</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/1468221792/" rel="prev" title="Ceph文档-简介"><i class="fa fa-chevron-left"></i> Ceph文档-简介</a></div><div class="post-nav-item"><a href="/posts/2576505842/" rel="next" title="Ceph文档-存储集群-综述">Ceph文档-存储集群-综述 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87"><span class="nav-text">存储设备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OSD%E5%AD%98%E5%82%A8%E5%90%8E%E7%AB%AF"><span class="nav-text">OSD存储后端</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#BlueStore"><span class="nav-text">BlueStore</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FILESTORE"><span class="nav-text">FILESTORE</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ceph-%E9%85%8D%E7%BD%AE"><span class="nav-text">Ceph 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E5%90%8D"><span class="nav-text">参数名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E5%80%BC"><span class="nav-text">参数值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%83%E5%8F%98%E9%87%8F"><span class="nav-text">元变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%BA%90"><span class="nav-text">配置源</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SKIPPING-MONITOR-CONFIG"><span class="nav-text">SKIPPING MONITOR CONFIG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%AF%BC%E5%8F%82%E6%95%B0"><span class="nav-text">引导参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ceph%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">Ceph配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%88%86%E5%9D%97"><span class="nav-text">配置分块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E5%80%BC"><span class="nav-text">配置文件中的参数配置值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="nav-text">参数配置值类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">参数配置数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sections-%E5%92%8C-masks"><span class="nav-text">sections 和 masks</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E5%80%BC%E6%9F%A5%E7%9C%8B%E6%8C%87%E4%BB%A4"><span class="nav-text">参数值查看指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#help"><span class="nav-text">help</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E5%80%BC%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="nav-text">参数配置值的修改</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8F%AF%E4%BF%AE%E6%94%B9%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-text">运行时可修改参数配置项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%AE%E6%94%B9"><span class="nav-text">运行时持久化修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E4%BF%AE%E6%94%B9"><span class="nav-text">临时修改</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="AmosTian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">AmosTian</p><div class="site-description" itemprop="description">知道的越多，不知道的越多</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">216</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">65</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">82</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/AmosTian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AmosTian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://blog.csdn.net/qq_40479037?type=blog" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_40479037?type&#x3D;blog" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a> </span><span class="links-of-author-item"><a href="mailto:17636679561@163.com" title="E-Mail → mailto:17636679561@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("01/27/2022 15:13:14"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-grav"></i> </span><span class="author" itemprop="copyrightHolder">AmosTian</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">站点总字数 </span><span title="站点总字数">1150.8k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">46:51</span></div></div></footer></div><script color="0,0,0" opacity="0.5" zindex="-1" count="150" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'neutral',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}</script><script>if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }</script><script async src="/js/cursor/fireworks.js"></script><script src="/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,document.body.addEventListener("input",POWERMODE)</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"live2d-widget-model-hijiki"},display:{position:"right",width:150,height:300},mobile:{show:!1},log:!1})</script></body></html>